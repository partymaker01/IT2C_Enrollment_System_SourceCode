{
    "sourceFile": "student/Documents/UploadRequirements.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1748594670018,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1748594670018,
            "name": "Commit-0",
            "content": "<?php\r\nsession_start();\r\ninclude '../../db.php';\r\n\r\n$user_id = $_SESSION['user_id'] ?? 1;\r\n\r\nfunction getBadgeClass($status) {\r\n    switch ($status) {\r\n        case 'Uploaded': return 'badge-uploaded';\r\n        case 'Verified': return 'badge-verified';\r\n        case 'Rejected': return 'badge-rejected';\r\n        case 'Pending':  return 'badge-pending';\r\n        default:         return 'bg-secondary';\r\n    }\r\n}\r\n\r\n$message = '';\r\n\r\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\r\n    $document_type = $_POST['document_type'] ?? '';\r\n    if (empty($document_type)) {\r\n        $message = \"Please select a document type.\";\r\n    } elseif (!isset($_FILES['document_file']) || $_FILES['document_file']['error'] !== UPLOAD_ERR_OK) {\r\n        $message = \"Error uploading file.\";\r\n    } else {\r\n        $file = $_FILES['document_file'];\r\n        $allowed_ext = ['pdf', 'jpg', 'jpeg', 'png'];\r\n        $max_size = 5 * 1024 * 1024; // 5MB\r\n\r\n        $file_ext = strtolower(pathinfo($file['name'], PATHINFO_EXTENSION));\r\n        if (!in_array($file_ext, $allowed_ext)) {\r\n            $message = \"Invalid file type. Only PDF, JPG, PNG allowed.\";\r\n        } elseif ($file['size'] > $max_size) {\r\n            $message = \"File too large. Max size is 5MB.\";\r\n        } else {\r\n            $upload_dir = __DIR__ . '/uploads/' . $user_id;\r\n            if (!is_dir($upload_dir)) {\r\n                mkdir($upload_dir, 0755, true);\r\n            }\r\n\r\n            $new_filename = uniqid() . '.' . $file_ext;\r\n            $target_path = $upload_dir . '/' . $new_filename;\r\n\r\n            if (move_uploaded_file($file['tmp_name'], $target_path)) {\r\n            $stmt = $conn->prepare(\"INSERT INTO uploaded_documents (student_id, document_name, file_path, status, remarks) VALUES (?, ?, ?, 'Uploaded', 'Waiting for verification')\");\r\n            $stmt->bind_param(\"iss\", $user_id, $document_type, $new_filename);\r\n            $stmt->execute();\r\n            $stmt->close();\r\n\r\n            // File preview logic\r\n            $relative_path = 'uploads/' . $user_id . '/' . $new_filename;\r\n            $fileType = mime_content_type($target_path);\r\n            $preview = \"<h5 class='mt-3'>File Preview:</h5>\";\r\n\r\n            if (strpos($fileType, \"image\") !== false) {\r\n                $preview .= \"<img src='$relative_path' style='max-width: 400px;' class='img-thumbnail'>\";\r\n            } elseif ($fileType == \"application/pdf\") {\r\n                $preview .= \"<embed src='$relative_path' type='application/pdf' width='100%' height='500px'>\";\r\n            } else {\r\n                $preview .= \"<p>File uploaded: <a href='$relative_path' target='_blank'>Download</a></p>\";\r\n            }\r\n\r\n            $message = \"Document uploaded successfully.<br>\" . $preview;\r\n            } else {\r\n                $message = \"Failed to move uploaded file.\";\r\n            }\r\n\r\n        }\r\n    }\r\n}\r\n\r\n$uploadedDocuments = [];\r\n$stmt = $conn->prepare(\"SELECT document_name, file_path, upload_date, status, remarks FROM uploaded_documents WHERE student_id = ? ORDER BY upload_date DESC\");\r\n$stmt->bind_param(\"i\", $user_id);\r\n$stmt->execute();\r\n$result = $stmt->get_result();\r\n\r\n$uploadedDocuments = $result->fetch_all(MYSQLI_ASSOC);\r\n$stmt->close();\r\n?>\r\n\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n  <meta charset=\"UTF-8\" />\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\r\n  <title>Upload Requirements - Enrollment System</title>\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\" />\r\n  <link rel=\"icon\" href=\"/IT2C_Enrollment_System_SourceCode/picture/tlgc_pic.jpg\" type=\"image/x-icon\">\r\n  <style>\r\n    body { background-color: #e8f5e9; }\r\n    .navbar { background-color: #2e7d32; }\r\n    .navbar-brand, .nav-link { color: #fff !important; font-weight: 600; letter-spacing: 0.05em; }\r\n    .nav-link:hover { color: #c8e6c9 !important; }\r\n    .badge-uploaded { background-color: #2196f3; }\r\n    .badge-verified { background-color: #43a047; }\r\n    .badge-rejected { background-color: #e53935; }\r\n    .badge-pending { background-color: #fbc02d; color: #000; }\r\n  </style>\r\n</head>\r\n<body>\r\n<nav class=\"navbar navbar-expand-lg\">\r\n    <div class=\"container\">\r\n      <a class=\"navbar-brand\" href=\"/IT2C_Enrollment_System_SourceCode/student//student-dashboard.php\">\r\n        Student Dashboard\r\n      </a>\r\n      <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\" aria-controls=\"navbarNav\" aria-expanded=\"false\" aria-label=\"Toggle navigation\">\r\n        <span class=\"navbar-toggler-icon\"></span>\r\n      </button>\r\n      <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\r\n        <ul class=\"navbar-nav ms-auto\">\r\n          <li class=\"nav-item\"><a class=\"nav-link\" href=\"/IT2C_Enrollment_System_SourceCode/student//student-dashboard.php\" class=\"btn btn-outline-secondary mb-3\">\r\n          <i class=\"bi bi-arrow-left\"></i> Back to Dashboard\r\n          </a>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  </nav>\r\n<div class=\"container my-5\">\r\n  <h2 class=\"text-success mb-4\">Upload Requirements</h2>\r\n\r\n  <?php if ($message): ?>\r\n    <div class=\"alert alert-info\"><?= htmlspecialchars($message) ?></div>\r\n  <?php endif; ?>\r\n\r\n  <div class=\"card shadow-sm mb-4\">\r\n    <div class=\"card-body\">\r\n      <form method=\"post\" enctype=\"multipart/form-data\" id=\"uploadForm\">\r\n        <div class=\"mb-3\">\r\n          <label for=\"documentType\" class=\"form-label\">Select Document Type</label>\r\n          <select class=\"form-select\" id=\"documentType\" name=\"document_type\" required>\r\n            <option value=\"\" disabled selected>Select a document</option>\r\n            <option value=\"3pcs 1x1 picture\">3pcs 1x1 picture</option>\r\n            <option value=\"4pcs Passport size picture\">4pcs Passport size picture</option>\r\n            <option value=\"Form 137 / SF10\">Form 137 / SF10</option>\r\n            <option value=\"Report Card / SF9\">Report Card / SF9</option>\r\n            <option value=\"PSA Birth Certificate\">PSA Birth Certificate</option>\r\n            <option value=\"Diploma (photocopy)\">Diploma (photocopy)</option>\r\n            <option value=\"Certificate of Good Moral\">Certificate of Good Moral</option>\r\n          </select>\r\n        </div>\r\n\r\n        <div class=\"mb-3\">\r\n          <label for=\"documentFile\" class=\"form-label\">Choose File (PDF, JPG, PNG, max 5MB)</label>\r\n          <input class=\"form-control\" type=\"file\" id=\"documentFile\" name=\"document_file\" accept=\".pdf,.jpg,.jpeg,.png\" required />\r\n        </div>\r\n\r\n        <button type=\"submit\" class=\"btn btn-success\">Upload Document</button>\r\n      </form>\r\n    </div>\r\n  </div>\r\n\r\n  <h4>Previously Uploaded Documents</h4>\r\n  <div class=\"table-responsive\">\r\n    <table class=\"table table-striped align-middle\">\r\n      <thead class=\"table-success\">\r\n        <tr>\r\n          <th>Document Type</th>\r\n          <th>Filename</th>\r\n          <th>Upload Date</th>\r\n          <th>Status</th>\r\n          <th>Remarks</th>\r\n          <th>Actions</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        <?php if (!empty($uploadedDocuments)): ?>\r\n          <?php foreach ($uploadedDocuments as $doc): ?>\r\n          <tr>\r\n            <td><?= htmlspecialchars($doc['document_name']) ?></td>\r\n            <td>\r\n              <a href=\"uploads/<?= $user_id ?>/<?= htmlspecialchars($doc['file_path']) ?>\" target=\"_blank\">\r\n                <?= htmlspecialchars($doc['file_path']) ?>\r\n              </a>\r\n            </td>\r\n            <td><?= date('M d, Y', strtotime($doc['upload_date'])) ?></td>\r\n            <td><span class=\"badge <?= getBadgeClass($doc['status']) ?>\"><?= htmlspecialchars($doc['status']) ?></span></td>\r\n            <td><?= htmlspecialchars($doc['remarks']) ?></td>\r\n            <td>\r\n              <button class=\"btn btn-sm btn-outline-primary\" disabled>Re-upload</button>\r\n              <a href=\"uploads/<?= $user_id ?>/<?= htmlspecialchars($doc['file_path']) ?>\" target=\"_blank\" class=\"btn btn-sm btn-outline-secondary\">View</a>\r\n            </td>\r\n          </tr>\r\n          <?php endforeach; ?>\r\n        <?php else: ?>\r\n          <tr><td colspan=\"6\" class=\"text-center\">No uploaded documents yet.</td></tr>\r\n        <?php endif; ?>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n</div>\r\n\r\n<script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\r\n</body>\r\n</html>"
        }
    ]
}