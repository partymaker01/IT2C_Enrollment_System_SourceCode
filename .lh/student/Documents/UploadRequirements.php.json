{
    "sourceFile": "student/Documents/UploadRequirements.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1749395010899,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1749395018743,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -271,8 +271,14 @@\n             </div>\n         </div>\n     </nav>\n \n+    <div class=\"container my-4\">\n+        <h2 class=\"section-title\">\n+            <i class=\"bi bi-cloud-upload\"></i>\n+            Upload Requirements\n+        </h2>\n+\n         <!-- Requirements List -->\n         <div class=\"requirements-list\">\n             <h6><i class=\"bi bi-info-circle\"></i> Required Documents</h6>\n             <ul>\n"
                }
            ],
            "date": 1749395010899,
            "name": "Commit-0",
            "content": "<?php\nsession_start();\n\nif (!isset($_SESSION['student_id'])) {\n    header(\"Location: ../../logregfor/login.php\");\n    exit;\n}\n\nrequire_once '../../db.php';\n\n$student_id = $_SESSION['student_id'];\n$message = '';\n$messageType = '';\n\n// Handle file upload\nif ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_FILES['document_file'])) {\n    $documentType = trim($_POST['document_type'] ?? '');\n    $file = $_FILES['document_file'];\n\n    if (empty($documentType)) {\n        $message = \"Please select a document type.\";\n        $messageType = \"danger\";\n    } elseif ($file['error'] !== UPLOAD_ERR_OK) {\n        $message = \"Error uploading file. Please try again.\";\n        $messageType = \"danger\";\n    } else {\n        // Validate file\n        $allowedTypes = ['pdf', 'jpg', 'jpeg', 'png'];\n        $maxSize = 5 * 1024 * 1024; // 5MB\n        $fileExt = strtolower(pathinfo($file['name'], PATHINFO_EXTENSION));\n\n        if (!in_array($fileExt, $allowedTypes)) {\n            $message = \"Invalid file type. Only PDF, JPG, JPEG, and PNG files are allowed.\";\n            $messageType = \"danger\";\n        } elseif ($file['size'] > $maxSize) {\n            $message = \"File is too large. Maximum size is 5MB.\";\n            $messageType = \"danger\";\n        } else {\n            // Create upload directory\n            $uploadDir = __DIR__ . '/uploads/' . $student_id;\n            if (!is_dir($uploadDir)) {\n                mkdir($uploadDir, 0755, true);\n            }\n\n            // Generate unique filename\n            $fileName = uniqid() . '_' . time() . '.' . $fileExt;\n            $filePath = $uploadDir . '/' . $fileName;\n\n            if (move_uploaded_file($file['tmp_name'], $filePath)) {\n                // Save to database\n                try {\n                    $stmt = $pdo->prepare(\"INSERT INTO uploaded_documents (student_id, doc_type, file_name, file_path, upload_date, status, remarks) VALUES (?, ?, ?, ?, NOW(), 'Uploaded', 'Waiting for verification')\");\n                    $stmt->execute([$student_id, $documentType, $file['name'], $fileName]);\n                    \n                    $message = \"Document uploaded successfully! It will be reviewed by the registrar.\";\n                    $messageType = \"success\";\n                } catch (PDOException $e) {\n                    $message = \"Database error: \" . $e->getMessage();\n                    $messageType = \"danger\";\n                }\n            } else {\n                $message = \"Failed to upload file. Please try again.\";\n                $messageType = \"danger\";\n            }\n        }\n    }\n}\n\n// Fetch uploaded documents\n$stmt = $pdo->prepare(\"SELECT * FROM uploaded_documents WHERE student_id = ? ORDER BY upload_date DESC\");\n$stmt->execute([$student_id]);\n$documents = $stmt->fetchAll();\n\nfunction getBadgeClass($status) {\n    return match(strtolower($status)) {\n        'uploaded' => 'bg-primary',\n        'verified' => 'bg-success',\n        'rejected' => 'bg-danger',\n        'pending' => 'bg-warning text-dark',\n        default => 'bg-secondary'\n    };\n}\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <title>Upload Requirements - Student Portal</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css\" rel=\"stylesheet\">\n    <link rel=\"icon\" href=\"../../picture/tlgc_pic.jpg\" type=\"image/x-icon\">\n    <style>\n        :root {\n            --primary-green: #2e7d32;\n            --light-green: #e8f5e9;\n            --accent-green: #43a047;\n            --hover-green: #c8e6c9;\n            --dark-green: #1b5e20;\n        }\n\n        body {\n            background: linear-gradient(135deg, var(--light-green) 0%, #f1f8e9 100%);\n            min-height: 100vh;\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n        }\n\n        .navbar {\n            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);\n            box-shadow: 0 2px 10px rgba(46, 125, 50, 0.3);\n        }\n\n        .navbar-brand, .nav-link {\n            color: #fff !important;\n            font-weight: 600;\n            letter-spacing: 0.5px;\n        }\n\n        .nav-link:hover {\n            color: var(--hover-green) !important;\n        }\n\n        .school-logo {\n            width: 50px;\n            height: 50px;\n            object-fit: cover;\n            border-radius: 50%;\n            margin-right: 15px;\n            border: 3px solid #fff;\n        }\n\n        .upload-card {\n            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);\n            border-radius: 20px;\n            box-shadow: 0 10px 30px rgba(46, 125, 50, 0.15);\n            padding: 2rem;\n            margin-bottom: 2rem;\n            border: 1px solid rgba(46, 125, 50, 0.1);\n        }\n\n        .documents-card {\n            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);\n            border-radius: 20px;\n            box-shadow: 0 10px 30px rgba(46, 125, 50, 0.15);\n            padding: 2rem;\n            border: 1px solid rgba(46, 125, 50, 0.1);\n        }\n\n        .section-title {\n            color: var(--primary-green);\n            font-weight: 700;\n            margin-bottom: 1.5rem;\n            position: relative;\n            padding-bottom: 10px;\n        }\n\n        .section-title::after {\n            content: '';\n            position: absolute;\n            bottom: 0;\n            left: 0;\n            width: 50px;\n            height: 3px;\n            background: linear-gradient(90deg, var(--accent-green), var(--primary-green));\n            border-radius: 2px;\n        }\n\n        .form-label {\n            color: var(--dark-green);\n            font-weight: 600;\n            margin-bottom: 0.5rem;\n        }\n\n        .form-select, .form-control {\n            border: 2px solid #e0e0e0;\n            border-radius: 10px;\n            padding: 12px 15px;\n            transition: all 0.3s ease;\n            background-color: #fafafa;\n        }\n\n        .form-select:focus, .form-control:focus {\n            border-color: var(--accent-green);\n            box-shadow: 0 0 0 0.25rem rgba(67, 160, 71, 0.25);\n            background-color: #fff;\n        }\n\n        .btn-upload {\n            background: linear-gradient(135deg, var(--accent-green) 0%, var(--primary-green) 100%);\n            border: none;\n            color: white;\n            font-weight: 600;\n            padding: 12px 30px;\n            border-radius: 25px;\n            transition: all 0.3s ease;\n        }\n\n        .btn-upload:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 8px 20px rgba(67, 160, 71, 0.4);\n            color: white;\n        }\n\n        .table {\n            border-radius: 15px;\n            overflow: hidden;\n            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);\n        }\n\n        .table thead th {\n            background: linear-gradient(135deg, var(--accent-green) 0%, var(--primary-green) 100%);\n            color: white;\n            border: none;\n            font-weight: 600;\n        }\n\n        .table tbody tr {\n            transition: all 0.3s ease;\n        }\n\n        .table tbody tr:hover {\n            background-color: var(--light-green);\n            transform: scale(1.01);\n        }\n\n        .requirements-list {\n            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);\n            border: 1px solid #ffc107;\n            border-radius: 15px;\n            padding: 1.5rem;\n            margin-bottom: 2rem;\n        }\n\n        .requirements-list h6 {\n            color: #856404;\n            font-weight: 700;\n        }\n\n        .requirements-list ul {\n            color: #856404;\n            margin-bottom: 0;\n        }\n\n        .file-preview {\n            max-width: 100%;\n            border-radius: 10px;\n            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);\n        }\n    </style>\n</head>\n<body>\n    <!-- Navigation -->\n    <nav class=\"navbar navbar-expand-lg\">\n        <div class=\"container\">\n            <a class=\"navbar-brand d-flex align-items-center\" href=\"../student-dashboard.php\">\n                <img src=\"../../picture/tlgc_pic.jpg\" alt=\"School Logo\" class=\"school-logo\">\n                <span>Student Portal</span>\n            </a>\n            <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\">\n                <span class=\"navbar-toggler-icon\"></span>\n            </button>\n            <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\n                <ul class=\"navbar-nav ms-auto\">\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link\" href=\"../student-dashboard.php\">\n                            <i class=\"bi bi-arrow-left\"></i> Back to Dashboard\n                        </a>\n                    </li>\n                </ul>\n            </div>\n        </div>\n    </nav>\n\n        <!-- Requirements List -->\n        <div class=\"requirements-list\">\n            <h6><i class=\"bi bi-info-circle\"></i> Required Documents</h6>\n            <ul>\n                <li>3 pieces 1x1 ID Pictures (recent)</li>\n                <li>4 pieces Passport Size Pictures (recent)</li>\n                <li>Form 137 / SF10 (Original or Certified True Copy)</li>\n                <li>Report Card / SF9 (Original or Certified True Copy)</li>\n                <li>PSA Birth Certificate (Original or Certified True Copy)</li>\n                <li>Diploma (Photocopy)</li>\n                <li>Certificate of Good Moral Character</li>\n            </ul>\n            <small><strong>Note:</strong> All documents must be clear and readable. Maximum file size is 5MB per document.</small>\n        </div>\n\n        <?php if ($message): ?>\n            <div class=\"alert alert-<?= $messageType ?> alert-dismissible fade show\" role=\"alert\">\n                <i class=\"bi bi-<?= $messageType === 'success' ? 'check-circle' : 'exclamation-triangle' ?>\"></i>\n                <?= htmlspecialchars($message) ?>\n                <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>\n            </div>\n        <?php endif; ?>\n\n        <!-- Upload Form -->\n        <div class=\"upload-card\">\n            <h4 class=\"section-title\">Upload Document</h4>\n            <form method=\"POST\" enctype=\"multipart/form-data\" id=\"uploadForm\">\n                <div class=\"row\">\n                    <div class=\"col-md-6 mb-3\">\n                        <label for=\"document_type\" class=\"form-label\">\n                            <i class=\"bi bi-file-text\"></i> Document Type\n                        </label>\n                        <select class=\"form-select\" name=\"document_type\" id=\"document_type\" required>\n                            <option value=\"\">Select Document Type</option>\n                            <option value=\"1x1 Pictures\">3pcs 1x1 Pictures</option>\n                            <option value=\"Passport Pictures\">4pcs Passport Size Pictures</option>\n                            <option value=\"Form 137\">Form 137 / SF10</option>\n                            <option value=\"Report Card\">Report Card / SF9</option>\n                            <option value=\"Birth Certificate\">PSA Birth Certificate</option>\n                            <option value=\"Diploma\">Diploma (Photocopy)</option>\n                            <option value=\"Good Moral\">Certificate of Good Moral</option>\n                            <option value=\"Other\">Other Document</option>\n                        </select>\n                    </div>\n                    <div class=\"col-md-6 mb-3\">\n                        <label for=\"document_file\" class=\"form-label\">\n                            <i class=\"bi bi-upload\"></i> Choose File\n                        </label>\n                        <input type=\"file\" class=\"form-control\" name=\"document_file\" id=\"document_file\" \n                               accept=\".pdf,.jpg,.jpeg,.png\" required>\n                        <div class=\"form-text\">Accepted formats: PDF, JPG, JPEG, PNG (Max: 5MB)</div>\n                    </div>\n                </div>\n                <button type=\"submit\" class=\"btn-upload\">\n                    <i class=\"bi bi-cloud-upload\"></i> Upload Document\n                </button>\n            </form>\n        </div>\n\n        <!-- Uploaded Documents -->\n        <div class=\"documents-card\">\n            <h4 class=\"section-title\">Uploaded Documents</h4>\n            <?php if (empty($documents)): ?>\n                <div class=\"text-center py-4\">\n                    <i class=\"bi bi-file-earmark-x\" style=\"font-size: 3rem; color: #6c757d;\"></i>\n                    <p class=\"text-muted mt-2\">No documents uploaded yet.</p>\n                </div>\n            <?php else: ?>\n                <div class=\"table-responsive\">\n                    <table class=\"table table-hover\">\n                        <thead>\n                            <tr>\n                                <th>Document Type</th>\n                                <th>File Name</th>\n                                <th>Upload Date</th>\n                                <th>Status</th>\n                                <th>Remarks</th>\n                                <th>Actions</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            <?php foreach ($documents as $doc): ?>\n                                <tr>\n                                    <td>\n                                        <i class=\"bi bi-file-earmark-text me-2\"></i>\n                                        <?= htmlspecialchars($doc['doc_type']) ?>\n                                    </td>\n                                    <td><?= htmlspecialchars($doc['file_name']) ?></td>\n                                    <td><?= date('M d, Y g:i A', strtotime($doc['upload_date'])) ?></td>\n                                    <td>\n                                        <span class=\"badge <?= getBadgeClass($doc['status']) ?>\">\n                                            <?= htmlspecialchars($doc['status']) ?>\n                                        </span>\n                                    </td>\n                                    <td><?= htmlspecialchars($doc['remarks']) ?></td>\n                                    <td>\n                                        <a href=\"uploads/<?= $student_id ?>/<?= htmlspecialchars($doc['file_path']) ?>\" \n                                           target=\"_blank\" class=\"btn btn-sm btn-outline-primary\">\n                                            <i class=\"bi bi-eye\"></i> View\n                                        </a>\n                                        <?php if ($doc['status'] === 'Rejected'): ?>\n                                            <button class=\"btn btn-sm btn-outline-warning\" \n                                                    onclick=\"reuploadDocument('<?= htmlspecialchars($doc['doc_type']) ?>')\">\n                                                <i class=\"bi bi-arrow-clockwise\"></i> Re-upload\n                                            </button>\n                                        <?php endif; ?>\n                                    </td>\n                                </tr>\n                            <?php endforeach; ?>\n                        </tbody>\n                    </table>\n                </div>\n            <?php endif; ?>\n        </div>\n    </div>\n\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\n    <script>\n        // File validation\n        document.getElementById('document_file').addEventListener('change', function() {\n            const file = this.files[0];\n            if (file) {\n                const maxSize = 5 * 1024 * 1024; // 5MB\n                const allowedTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];\n                \n                if (file.size > maxSize) {\n                    alert('File is too large. Maximum size is 5MB.');\n                    this.value = '';\n                    return;\n                }\n                \n                if (!allowedTypes.includes(file.type)) {\n                    alert('Invalid file type. Only PDF, JPG, JPEG, and PNG files are allowed.');\n                    this.value = '';\n                    return;\n                }\n            }\n        });\n\n        // Form validation\n        document.getElementById('uploadForm').addEventListener('submit', function(e) {\n            const documentType = document.getElementById('document_type').value;\n            const documentFile = document.getElementById('document_file').files[0];\n            \n            if (!documentType || !documentFile) {\n                e.preventDefault();\n                alert('Please select a document type and choose a file to upload.');\n            }\n        });\n\n        // Re-upload function\n        function reuploadDocument(docType) {\n            document.getElementById('document_type').value = docType;\n            document.getElementById('document_file').focus();\n        }\n    </script>\n</body>\n</html>\n"
        }
    ]
}