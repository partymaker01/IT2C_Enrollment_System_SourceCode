{
    "sourceFile": "student/MyEnrollAssignUpload/assigned-subjects.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1749396186287,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1749396186287,
            "name": "Commit-0",
            "content": "<?php\nsession_start();\n\nif (!isset($_SESSION['student_id'])) {\n    header(\"Location: ../../logregfor/login.php\");\n    exit;\n}\n\nrequire_once '../../db.php';\n\n$student_id = $_SESSION['student_id'];\n\n// Fetch student info\n$stmt = $pdo->prepare(\"SELECT * FROM students WHERE student_id = ?\");\n$stmt->execute([$student_id]);\n$student = $stmt->fetch(PDO::FETCH_ASSOC);\n\nif (!$student) {\n    header(\"Location: ../../logregfor/login.php\");\n    exit;\n}\n\n// Get the latest approved enrollment for the student\n$stmt = $pdo->prepare(\"\n    SELECT * FROM enrollments \n    WHERE student_id = ? AND status = 'approved' \n    ORDER BY date_submitted DESC \n    LIMIT 1\n\");\n$stmt->execute([$student_id]);\n$enrollment = $stmt->fetch(PDO::FETCH_ASSOC);\n\n// Get semester and school year from GET, enrollment data, or use defaults\n$semester = $_GET['semester'] ?? ($enrollment['semester'] ?? '1st Semester');\n$school_year = $_GET['school_year'] ?? ($enrollment['school_year'] ?? '2024-2025');\n\n// Use enrollment data for student info if available\n$student_program = $enrollment['program'] ?? 'N/A';\n$student_year_level = $enrollment['year_level'] ?? 'N/A';\n$student_section = $enrollment['section'] ?? 'N/A';\n\n// Fetch assigned subjects\n$stmt = $pdo->prepare(\"\n    SELECT s.subject_code, s.subject_title, s.instructor, s.day, s.time, s.room, s.units, ss.grade, ss.status\n    FROM subjects s\n    JOIN student_subjects ss ON s.id = ss.subject_id\n    WHERE ss.student_id = ? AND ss.semester = ? AND ss.school_year = ?\n    ORDER BY s.subject_code\n\");\n$stmt->execute([$student_id, $semester, $school_year]);\n$subjects = $stmt->fetchAll(PDO::FETCH_ASSOC);\n\n// If no subjects found, get sample subjects for demonstration\nif (empty($subjects)) {\n    $stmt = $pdo->prepare(\"SELECT * FROM subjects WHERE status = 'Active' ORDER BY subject_code ASC LIMIT 6\");\n    $stmt->execute();\n    $sampleSubjects = $stmt->fetchAll(PDO::FETCH_ASSOC);\n    \n    foreach ($sampleSubjects as $subject) {\n        $subjects[] = [\n            'subject_code' => $subject['subject_code'],\n            'subject_title' => $subject['subject_title'],\n            'instructor' => $subject['instructor'],\n            'day' => $subject['day'],\n            'time' => $subject['time'],\n            'room' => $subject['room'],\n            'units' => $subject['units'],\n            'grade' => null,\n            'status' => 'Enrolled'\n        ];\n    }\n}\n\n$totalUnits = array_sum(array_column($subjects, 'units'));\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <title>Assigned Subjects - Student Portal</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css\" rel=\"stylesheet\">\n    <link rel=\"icon\" href=\"../../picture/tlgc_pic.jpg\" type=\"image/x-icon\">\n    <style>\n        :root {\n            --primary-green: #2e7d32;\n            --light-green: #e8f5e9;\n            --accent-green: #43a047;\n            --hover-green: #c8e6c9;\n            --dark-green: #1b5e20;\n        }\n\n        body {\n            background: linear-gradient(135deg, var(--light-green) 0%, #f1f8e9 100%);\n            min-height: 100vh;\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n        }\n\n        .navbar {\n            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);\n            box-shadow: 0 2px 10px rgba(46, 125, 50, 0.3);\n        }\n\n        .navbar-brand, .nav-link {\n            color: #fff !important;\n            font-weight: 600;\n            letter-spacing: 0.5px;\n        }\n\n        .nav-link:hover {\n            color: var(--hover-green) !important;\n        }\n\n        .school-logo {\n            width: 50px;\n            height: 50px;\n            object-fit: cover;\n            border-radius: 50%;\n            margin-right: 15px;\n            border: 3px solid #fff;\n        }\n\n        .subjects-card {\n            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);\n            border-radius: 20px;\n            box-shadow: 0 10px 30px rgba(46, 125, 50, 0.15);\n            padding: 2rem;\n            margin-bottom: 2rem;\n            border: 1px solid rgba(46, 125, 50, 0.1);\n        }\n\n        .section-title {\n            color: var(--primary-green);\n            font-weight: 700;\n            margin-bottom: 1.5rem;\n            position: relative;\n            padding-bottom: 10px;\n        }\n\n        .section-title::after {\n            content: '';\n            position: absolute;\n            bottom: 0;\n            left: 0;\n            width: 50px;\n            height: 3px;\n            background: linear-gradient(90deg, var(--accent-green), var(--primary-green));\n            border-radius: 2px;\n        }\n\n        .student-header {\n            background: linear-gradient(135deg, var(--accent-green) 0%, var(--primary-green) 100%);\n            color: white;\n            border-radius: 15px;\n            padding: 1.5rem;\n            margin-bottom: 2rem;\n        }\n\n        .filter-card {\n            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);\n            border-radius: 15px;\n            padding: 1.5rem;\n            margin-bottom: 2rem;\n            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);\n        }\n\n        .table {\n            border-radius: 15px;\n            overflow: hidden;\n            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);\n        }\n\n        .table thead th {\n            background: linear-gradient(135deg, var(--accent-green) 0%, var(--primary-green) 100%);\n            color: white;\n            border: none;\n            font-weight: 600;\n            padding: 1rem;\n        }\n\n        .table tbody tr {\n            transition: all 0.3s ease;\n        }\n\n        .table tbody tr:hover {\n            background-color: var(--light-green);\n            transform: scale(1.01);\n        }\n\n        .btn-custom {\n            background: linear-gradient(135deg, var(--accent-green) 0%, var(--primary-green) 100%);\n            border: none;\n            color: white;\n            font-weight: 600;\n            padding: 10px 20px;\n            border-radius: 25px;\n            transition: all 0.3s ease;\n            text-decoration: none;\n            display: inline-block;\n            margin: 0.25rem;\n        }\n\n        .btn-custom:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 5px 15px rgba(67, 160, 71, 0.4);\n            color: white;\n        }\n\n        .summary-cards {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 1rem;\n            margin-bottom: 2rem;\n        }\n\n        .summary-card {\n            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);\n            border-radius: 15px;\n            padding: 1.5rem;\n            text-align: center;\n            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);\n            transition: all 0.3s ease;\n        }\n\n        .summary-card:hover {\n            transform: translateY(-5px);\n            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);\n        }\n\n        .summary-icon {\n            font-size: 2.5rem;\n            margin-bottom: 1rem;\n            display: block;\n        }\n\n        .icon-subjects { color: #4caf50; }\n        .icon-units { color: #2196f3; }\n        .icon-instructor { color: #ff9800; }\n\n        .enrollment-status {\n            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);\n            border: 1px solid #ffc107;\n            border-radius: 15px;\n            padding: 1rem;\n            margin-bottom: 1rem;\n        }\n\n        @media print {\n            .no-print { display: none !important; }\n            .subjects-card { box-shadow: none !important; }\n        }\n    </style>\n</head>\n<body>\n    <!-- Navigation -->\n    <nav class=\"navbar navbar-expand-lg no-print\">\n        <div class=\"container\">\n            <a class=\"navbar-brand d-flex align-items-center\" href=\"../student-dashboard.php\">\n                <img src=\"../../picture/tlgc_pic.jpg\" alt=\"School Logo\" class=\"school-logo\">\n                <span>Student Portal</span>\n            </a>\n            <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\">\n                <span class=\"navbar-toggler-icon\"></span>\n            </button>\n            <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\n                <ul class=\"navbar-nav ms-auto\">\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link\" href=\"../student-dashboard.php\">\n                            <i class=\"bi bi-arrow-left\"></i> Back to Dashboard\n                        </a>\n                    </li>\n                </ul>\n            </div>\n        </div>\n    </nav>\n\n    <div class=\"container my-4\">\n        <!-- Enrollment Status Alert -->\n        <?php if (!$enrollment): ?>\n            <div class=\"enrollment-status\">\n                <h5><i class=\"bi bi-exclamation-triangle me-2\"></i>No Approved Enrollment Found</h5>\n                <p class=\"mb-2\">You don't have an approved enrollment yet. Please complete your enrollment first.</p>\n                <a href=\"../Enrollment/fill-up-enrollment-form.php\" class=\"btn-custom\">\n                    <i class=\"bi bi-plus-circle me-1\"></i>Complete Enrollment\n                </a>\n            </div>\n        <?php endif; ?>\n\n        <!-- Student Header -->\n        <div class=\"student-header text-center\">\n            <h3><i class=\"bi bi-person-badge me-2\"></i><?= htmlspecialchars($student['first_name'] . ' ' . $student['last_name']) ?></h3>\n            <div class=\"row mt-3\">\n                <div class=\"col-md-4\">\n                    <strong>Program:</strong> <?= htmlspecialchars($student_program) ?>\n                </div>\n                <div class=\"col-md-4\">\n                    <strong>Year Level:</strong> <?= htmlspecialchars($student_year_level) ?>\n                </div>\n                <div class=\"col-md-4\">\n                    <strong>Section:</strong> <?= htmlspecialchars($student_section) ?>\n                </div>\n            </div>\n            <?php if ($enrollment): ?>\n                <div class=\"mt-2\">\n                    <small><i class=\"bi bi-check-circle me-1\"></i>Enrollment Status: <strong><?= ucfirst($enrollment['status']) ?></strong></small>\n                </div>\n            <?php endif; ?>\n        </div>\n\n        <h2 class=\"section-title\">\n            <i class=\"bi bi-book\"></i>\n            Assigned Subjects\n        </h2>\n\n        <!-- Filter Form -->\n        <div class=\"filter-card no-print\">\n            <form method=\"GET\" class=\"row g-3\">\n                <div class=\"col-md-4\">\n                    <label for=\"semester\" class=\"form-label\">\n                        <i class=\"bi bi-calendar-week me-1\"></i>Semester\n                    </label>\n                    <select class=\"form-select\" id=\"semester\" name=\"semester\">\n                        <option value=\"1st Semester\" <?= $semester == '1st Semester' ? 'selected' : '' ?>>1st Semester</option>\n                        <option value=\"2nd Semester\" <?= $semester == '2nd Semester' ? 'selected' : '' ?>>2nd Semester</option>\n                        <option value=\"Summer\" <?= $semester == 'Summer' ? 'selected' : '' ?>>Summer</option>\n                    </select>\n                </div>\n                <div class=\"col-md-4\">\n                    <label for=\"school_year\" class=\"form-label\">\n                        <i class=\"bi bi-calendar-range me-1\"></i>School Year\n                    </label>\n                    <input type=\"text\" class=\"form-control\" id=\"school_year\" name=\"school_year\" \n                           value=\"<?= htmlspecialchars($school_year) ?>\" placeholder=\"e.g., 2024-2025\">\n                </div>\n                <div class=\"col-md-4 align-self-end\">\n                    <button type=\"submit\" class=\"btn-custom w-100\">\n                        <i class=\"bi bi-search me-1\"></i>Load Subjects\n                    </button>\n                </div>\n            </form>\n        </div>\n\n        <!-- Summary Cards -->\n        <div class=\"summary-cards\">\n            <div class=\"summary-card\">\n                <i class=\"bi bi-book-fill summary-icon icon-subjects\"></i>\n                <h5>Total Subjects</h5>\n                <p class=\"display-6 mb-0\"><?= count($subjects) ?></p>\n            </div>\n            <div class=\"summary-card\">\n                <i class=\"bi bi-calculator summary-icon icon-units\"></i>\n                <h5>Total Units</h5>\n                <p class=\"display-6 mb-0\"><?= $totalUnits ?></p>\n            </div>\n            <div class=\"summary-card\">\n                <i class=\"bi bi-person-workspace summary-icon icon-instructor\"></i>\n                <h5>Instructors</h5>\n                <p class=\"display-6 mb-0\"><?= count(array_unique(array_column($subjects, 'instructor'))) ?></p>\n            </div>\n        </div>\n\n        <!-- Subjects Table -->\n        <div class=\"subjects-card\">\n            <h4 class=\"section-title\">Subject Details - <?= htmlspecialchars($semester) ?> (<?= htmlspecialchars($school_year) ?>)</h4>\n            <div class=\"table-responsive\">\n                <table class=\"table table-hover align-middle\">\n                    <thead>\n                        <tr>\n                            <th>Subject Code</th>\n                            <th>Subject Title</th>\n                            <th>Instructor</th>\n                            <th>Schedule</th>\n                            <th>Room</th>\n                            <th>Units</th>\n                            <th>Status</th>\n                            <th>Grade</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <?php if (!empty($subjects)): ?>\n                            <?php foreach ($subjects as $subject): ?>\n                                <tr>\n                                    <td><strong><?= htmlspecialchars($subject['subject_code']) ?></strong></td>\n                                    <td><?= htmlspecialchars($subject['subject_title']) ?></td>\n                                    <td><?= htmlspecialchars($subject['instructor']) ?></td>\n                                    <td>\n                                        <small>\n                                            <i class=\"bi bi-calendar-day me-1\"></i><?= htmlspecialchars($subject['day']) ?><br>\n                                            <i class=\"bi bi-clock me-1\"></i><?= htmlspecialchars($subject['time']) ?>\n                                        </small>\n                                    </td>\n                                    <td><?= htmlspecialchars($subject['room']) ?></td>\n                                    <td><span class=\"badge bg-primary\"><?= htmlspecialchars($subject['units']) ?></span></td>\n                                    <td>\n                                        <span class=\"badge bg-success\">\n                                            <i class=\"bi bi-check-circle me-1\"></i><?= htmlspecialchars($subject['status'] ?? 'Enrolled') ?>\n                                        </span>\n                                    </td>\n                                    <td>\n                                        <?php if ($subject['grade']): ?>\n                                            <span class=\"badge bg-info\"><?= htmlspecialchars($subject['grade']) ?></span>\n                                        <?php else: ?>\n                                            <span class=\"text-muted\">Ongoing</span>\n                                        <?php endif; ?>\n                                    </td>\n                                </tr>\n                            <?php endforeach; ?>\n                        <?php else: ?>\n                            <tr>\n                                <td colspan=\"8\" class=\"text-center py-4\">\n                                    <i class=\"bi bi-book-x\" style=\"font-size: 3rem; color: #6c757d;\"></i>\n                                    <p class=\"text-muted mt-2\">No subjects found for <?= htmlspecialchars($semester) ?> (<?= htmlspecialchars($school_year) ?>)</p>\n                                    <?php if (!$enrollment): ?>\n                                        <a href=\"../Enrollment/fill-up-enrollment-form.php\" class=\"btn-custom\">\n                                            <i class=\"bi bi-plus-circle me-1\"></i>Complete Enrollment First\n                                        </a>\n                                    <?php else: ?>\n                                        <p class=\"text-muted\">Contact the registrar to assign subjects to your enrollment.</p>\n                                    <?php endif; ?>\n                                </td>\n                            </tr>\n                        <?php endif; ?>\n                    </tbody>\n                </table>\n            </div>\n\n            <?php if (!empty($subjects)): ?>\n                <!-- Action Buttons -->\n                <div class=\"text-center mt-4 no-print\">\n                    <button class=\"btn-custom\" onclick=\"window.print()\">\n                        <i class=\"bi bi-printer me-1\"></i>Print Schedule\n                    </button>\n                    <a href=\"mysubject.php\" class=\"btn-custom\">\n                        <i class=\"bi bi-calendar-week me-1\"></i>View Weekly Schedule\n                    </a>\n                    <a href=\"current-enrollment-status.php\" class=\"btn-custom\">\n                        <i class=\"bi bi-eye me-1\"></i>View Enrollment Status\n                    </a>\n                </div>\n            <?php endif; ?>\n        </div>\n    </div>\n\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\n</body>\n</html>\n"
        }
    ]
}