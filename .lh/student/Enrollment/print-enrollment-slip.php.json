{
    "sourceFile": "student/Enrollment/print-enrollment-slip.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1749396504356,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1749396504356,
            "name": "Commit-0",
            "content": "<?php\nsession_start();\n\nif (!isset($_SESSION['student_id'])) {\n    header(\"Location: ../../logregfor/login.php\");\n    exit;\n}\n\nrequire_once '../../db.php';\n\n// Get enrollment id from URL - FIXED: changed from 'student_id' to 'id'\n$enrollment_id = isset($_GET['id']) ? intval($_GET['id']) : 0;\n\n// If no enrollment ID provided, try to get the latest approved enrollment for the current student\nif ($enrollment_id <= 0) {\n    $student_id = $_SESSION['student_id'];\n    $stmt = $pdo->prepare(\"\n        SELECT id FROM enrollments \n        WHERE student_id = ? AND status = 'approved' \n        ORDER BY date_submitted DESC \n        LIMIT 1\n    \");\n    $stmt->execute([$student_id]);\n    $result = $stmt->fetch();\n    \n    if ($result) {\n        $enrollment_id = $result['id'];\n    } else {\n        die(\"📋 No approved enrollment found. Please complete your enrollment first or wait for admin approval.\");\n    }\n}\n\ntry {\n    // Fetch enrollment info (only if status is approved)\n    $stmt = $pdo->prepare(\"\n        SELECT e.*, s.first_name, s.last_name, s.student_id as student_number, s.email, s.contact_number\n        FROM enrollments e\n        JOIN students s ON e.student_id = s.student_id\n        WHERE e.id = ? AND e.status = 'approved'\n    \");\n    $stmt->execute([$enrollment_id]);\n    $enrollment = $stmt->fetch(PDO::FETCH_ASSOC);\n\n    if (!$enrollment) {\n        die(\"📋 Enrollment not found or not yet approved. Please wait for admin confirmation.\");\n    }\n\n    // Check if the enrollment belongs to the current student (security check)\n    if ($enrollment['student_id'] != $_SESSION['student_id']) {\n        die(\"❌ Access denied. You can only view your own enrollment slip.\");\n    }\n\n    // Fetch subjects linked to enrollment\n    $stmt = $pdo->prepare(\"\n        SELECT s.subject_code, s.subject_title, s.units, s.day, s.time, s.room, s.instructor\n        FROM enrollment_subjects es\n        JOIN subjects s ON es.subject_code = s.subject_code\n        WHERE es.enrollment_id = ?\n        ORDER BY s.subject_code\n    \");\n    $stmt->execute([$enrollment_id]);\n    $subjects = $stmt->fetchAll(PDO::FETCH_ASSOC);\n\n    // If no subjects found, get sample subjects based on program and year level\n    if (empty($subjects)) {\n        $stmt = $pdo->prepare(\"\n            SELECT * FROM subjects \n            WHERE status = 'Active' \n            ORDER BY subject_code ASC \n            LIMIT 6\n        \");\n        $stmt->execute();\n        $subjects = $stmt->fetchAll(PDO::FETCH_ASSOC);\n    }\n\n    $totalUnits = array_sum(array_column($subjects, 'units'));\n\n} catch (PDOException $e) {\n    die(\"Database error: \" . $e->getMessage());\n}\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <title>Enrollment Slip - <?= htmlspecialchars($enrollment['first_name'] . ' ' . $enrollment['last_name']) ?></title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css\" rel=\"stylesheet\">\n    <link rel=\"icon\" href=\"../../picture/tlgc_pic.jpg\" type=\"image/x-icon\">\n    <style>\n        :root {\n            --primary-green: #2e7d32;\n            --light-green: #e8f5e9;\n            --accent-green: #43a047;\n        }\n\n        body {\n            background: linear-gradient(135deg, var(--light-green) 0%, #f1f8e9 100%);\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n        }\n\n        .navbar {\n            background: linear-gradient(135deg, var(--primary-green) 0%, #1b5e20 100%);\n            box-shadow: 0 2px 10px rgba(46, 125, 50, 0.3);\n        }\n\n        .navbar-brand, .nav-link {\n            color: #fff !important;\n            font-weight: 600;\n        }\n\n        .school-logo {\n            width: 50px;\n            height: 50px;\n            object-fit: cover;\n            border-radius: 50%;\n            margin-right: 15px;\n            border: 3px solid #fff;\n        }\n\n        .school-header {\n            text-align: center;\n            margin-bottom: 2rem;\n            padding: 2rem;\n            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);\n            border-radius: 20px;\n            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);\n        }\n\n        .school-header img {\n            width: 120px;\n            height: 120px;\n            object-fit: cover;\n            border-radius: 50%;\n            border: 5px solid var(--accent-green);\n            margin-bottom: 1rem;\n        }\n\n        .enrollment-slip {\n            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);\n            padding: 2.5rem;\n            border-radius: 20px;\n            box-shadow: 0 10px 30px rgba(46, 125, 50, 0.15);\n            border: 1px solid rgba(46, 125, 50, 0.1);\n        }\n\n        .info-section {\n            background: rgba(46, 125, 50, 0.05);\n            border-radius: 15px;\n            padding: 1.5rem;\n            margin-bottom: 2rem;\n            border-left: 5px solid var(--accent-green);\n        }\n\n        .table {\n            border-radius: 15px;\n            overflow: hidden;\n            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);\n        }\n\n        .table thead th {\n            background: linear-gradient(135deg, var(--accent-green) 0%, var(--primary-green) 100%);\n            color: white;\n            border: none;\n            font-weight: 600;\n            padding: 1rem;\n        }\n\n        .table tbody tr:hover {\n            background-color: var(--light-green);\n        }\n\n        .badge-status {\n            background: linear-gradient(135deg, #4caf50 0%, #43a047 100%);\n            color: white;\n            font-size: 1rem;\n            padding: 8px 16px;\n            border-radius: 25px;\n            font-weight: 600;\n        }\n\n        .btn-custom {\n            background: linear-gradient(135deg, var(--accent-green) 0%, var(--primary-green) 100%);\n            border: none;\n            color: white;\n            font-weight: 600;\n            padding: 12px 25px;\n            border-radius: 25px;\n            transition: all 0.3s ease;\n            margin: 0.25rem;\n        }\n\n        .btn-custom:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 5px 15px rgba(67, 160, 71, 0.4);\n            color: white;\n        }\n\n        .qr-section {\n            text-align: center;\n            padding: 2rem;\n            background: rgba(46, 125, 50, 0.05);\n            border-radius: 15px;\n            margin-top: 2rem;\n        }\n\n        .verification-section {\n            border-top: 2px solid var(--accent-green);\n            padding-top: 2rem;\n            margin-top: 2rem;\n        }\n\n        @media print {\n            .no-print { display: none !important; }\n            body { background: white !important; }\n            .enrollment-slip { box-shadow: none !important; }\n            .school-header { box-shadow: none !important; }\n        }\n\n        .watermark {\n            position: relative;\n            overflow: hidden;\n        }\n\n        .watermark::before {\n            content: 'OFFICIAL';\n            position: absolute;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%) rotate(-45deg);\n            font-size: 6rem;\n            color: rgba(46, 125, 50, 0.1);\n            font-weight: bold;\n            z-index: 1;\n            pointer-events: none;\n        }\n\n        .content {\n            position: relative;\n            z-index: 2;\n        }\n\n        .success-alert {\n            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);\n            border: 1px solid #c3e6cb;\n            border-radius: 15px;\n            padding: 1rem;\n            margin-bottom: 2rem;\n            color: #155724;\n        }\n    </style>\n</head>\n<body>\n    <!-- Navigation -->\n    <nav class=\"navbar navbar-expand-lg no-print\">\n        <div class=\"container\">\n            <a class=\"navbar-brand d-flex align-items-center\" href=\"../student-dashboard.php\">\n                <img src=\"../../picture/tlgc_pic.jpg\" alt=\"School Logo\" class=\"school-logo\">\n                <span>Student Portal</span>\n            </a>\n            <div class=\"navbar-nav ms-auto\">\n                <a class=\"nav-link\" href=\"../student-dashboard.php\">\n                    <i class=\"bi bi-arrow-left\"></i> Back to Dashboard\n                </a>\n            </div>\n        </div>\n    </nav>\n\n    <div class=\"container my-4\">\n        <!-- Success Alert -->\n        <div class=\"success-alert no-print\">\n            <h5><i class=\"bi bi-check-circle me-2\"></i>Enrollment Approved!</h5>\n            <p class=\"mb-0\">Your enrollment has been successfully approved. You can now print your official enrollment certificate.</p>\n        </div>\n\n        <!-- School Header -->\n        <div class=\"school-header\">\n            <img src=\"../../picture/tlgc_pic.jpg\" alt=\"School Logo\">\n            <h3 class=\"mb-2\" style=\"color: var(--primary-green); font-weight: 700;\">Top Link Global College Inc.</h3>\n            <p class=\"mb-1\">MRF Compound, Purok Lambingan, Brgy. Daan Sarile</p>\n            <p class=\"mb-1\">Cabanatuan City, Nueva Ecija, Philippines</p>\n            <p class=\"mb-3\">📞 (044) 123-4567 | 📧 info@tlgc.edu.ph</p>\n            <h4 style=\"color: var(--accent-green); font-weight: 700;\">\n                <i class=\"bi bi-award me-2\"></i>OFFICIAL ENROLLMENT CERTIFICATE\n            </h4>\n        </div>\n\n        <div class=\"enrollment-slip watermark\">\n            <div class=\"content\">\n                <!-- Student Information -->\n                <div class=\"info-section\">\n                    <h5 style=\"color: var(--primary-green); margin-bottom: 1rem;\">\n                        <i class=\"bi bi-person-badge me-2\"></i>Student Information\n                    </h5>\n                    <div class=\"row\">\n                        <div class=\"col-md-6\">\n                            <p><strong>Full Name:</strong> <?= htmlspecialchars($enrollment['first_name'] . ' ' . $enrollment['last_name']) ?></p>\n                            <p><strong>Student ID:</strong> <?= htmlspecialchars($enrollment['student_number']) ?></p>\n                            <p><strong>Email:</strong> <?= htmlspecialchars($enrollment['email']) ?></p>\n                        </div>\n                        <div class=\"col-md-6\">\n                            <p><strong>Contact Number:</strong> <?= htmlspecialchars($enrollment['contact_number']) ?></p>\n                            <p><strong>Program:</strong> <?= htmlspecialchars($enrollment['program']) ?></p>\n                            <p><strong>Year Level:</strong> <?= htmlspecialchars($enrollment['year_level']) ?></p>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Enrollment Details -->\n                <div class=\"info-section\">\n                    <h5 style=\"color: var(--primary-green); margin-bottom: 1rem;\">\n                        <i class=\"bi bi-journal-check me-2\"></i>Enrollment Details\n                    </h5>\n                    <div class=\"row\">\n                        <div class=\"col-md-6\">\n                            <p><strong>Semester:</strong> <?= htmlspecialchars($enrollment['semester']) ?></p>\n                            <p><strong>Section:</strong> <?= htmlspecialchars($enrollment['section']) ?></p>\n                            <p><strong>School Year:</strong> <?= htmlspecialchars($enrollment['school_year'] ?? '2024-2025') ?></p>\n                        </div>\n                        <div class=\"col-md-6\">\n                            <p><strong>Date Enrolled:</strong> <?= date(\"F d, Y\", strtotime($enrollment['date_submitted'])) ?></p>\n                            <p><strong>Date Processed:</strong> <?= $enrollment['date_processed'] ? date(\"F d, Y\", strtotime($enrollment['date_processed'])) : 'N/A' ?></p>\n                            <p><strong>Status:</strong> <span class=\"badge-status\"><?= ucfirst($enrollment['status']) ?></span></p>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Subjects Table -->\n                <h5 style=\"color: var(--primary-green); margin-bottom: 1rem;\">\n                    <i class=\"bi bi-book me-2\"></i>Enrolled Subjects & Class Schedule\n                </h5>\n                <div class=\"table-responsive\">\n                    <table class=\"table table-bordered table-hover\">\n                        <thead>\n                            <tr>\n                                <th>Subject Code</th>\n                                <th>Subject Title</th>\n                                <th>Units</th>\n                                <th>Schedule</th>\n                                <th>Room</th>\n                                <th>Instructor</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            <?php if (!empty($subjects)): ?>\n                                <?php foreach ($subjects as $subject): ?>\n                                    <tr>\n                                        <td><strong><?= htmlspecialchars($subject['subject_code']) ?></strong></td>\n                                        <td><?= htmlspecialchars($subject['subject_title']) ?></td>\n                                        <td class=\"text-center\"><?= htmlspecialchars($subject['units']) ?></td>\n                                        <td>\n                                            <?= htmlspecialchars($subject['day']) ?><br>\n                                            <small><?= htmlspecialchars($subject['time']) ?></small>\n                                        </td>\n                                        <td><?= htmlspecialchars($subject['room']) ?></td>\n                                        <td><?= htmlspecialchars($subject['instructor']) ?></td>\n                                    </tr>\n                                <?php endforeach; ?>\n                                <tr class=\"table-success\">\n                                    <td colspan=\"2\"><strong>TOTAL UNITS</strong></td>\n                                    <td class=\"text-center\"><strong><?= $totalUnits ?></strong></td>\n                                    <td colspan=\"3\"></td>\n                                </tr>\n                            <?php else: ?>\n                                <tr>\n                                    <td colspan=\"6\" class=\"text-center py-4\">\n                                        <i class=\"bi bi-book-x\" style=\"font-size: 2rem; color: #6c757d;\"></i>\n                                        <p class=\"text-muted mt-2\">No subjects assigned yet. Please contact the registrar.</p>\n                                    </td>\n                                </tr>\n                            <?php endif; ?>\n                        </tbody>\n                    </table>\n                </div>\n\n                <!-- Verification Section -->\n                <div class=\"verification-section\">\n                    <div class=\"row\">\n                        <div class=\"col-md-6\">\n                            <div class=\"qr-section\">\n                                <p><strong>Enrollment Reference:</strong></p>\n                                <h5>ENR-<?= str_pad($enrollment_id, 6, '0', STR_PAD_LEFT) ?></h5>\n                                <div class=\"mt-3\">\n                                    <div style=\"width: 120px; height: 120px; background: #f0f0f0; border: 2px dashed #ccc; display: flex; align-items: center; justify-content: center; margin: 0 auto; border-radius: 10px;\">\n                                        <small>QR Code</small>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-md-6\">\n                            <div class=\"text-center\">\n                                <p><strong>This document is computer-generated and valid without signature.</strong></p>\n                                <p class=\"text-muted\">Generated on: <?= date(\"F d, Y \\a\\\\t g:i A\") ?></p>\n                                <div class=\"mt-4\">\n                                    <div style=\"border-top: 2px solid var(--primary-green); width: 200px; margin: 0 auto;\"></div>\n                                    <p class=\"mt-2\"><strong>Registrar's Office</strong></p>\n                                    <p class=\"text-muted\">Top Link Global College Inc.</p>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Action Buttons -->\n                <div class=\"text-center mt-4 no-print\">\n                    <button onclick=\"window.print()\" class=\"btn-custom\">\n                        <i class=\"bi bi-printer me-2\"></i>Print Certificate\n                    </button>\n                    <button onclick=\"downloadPDF()\" class=\"btn-custom\">\n                        <i class=\"bi bi-download me-2\"></i>Download PDF\n                    </button>\n                    <a href=\"../MyEnrollAssignUpload/enrollment-status.php\" class=\"btn-custom\">\n                        <i class=\"bi bi-eye me-2\"></i>View Status\n                    </a>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js\"></script>\n    <script>\n        function downloadPDF() {\n            const element = document.querySelector('.enrollment-slip');\n            const opt = {\n                margin: 0.5,\n                filename: 'enrollment_certificate_ENR-<?= str_pad($enrollment_id, 6, '0', STR_PAD_LEFT) ?>.pdf',\n                image: { type: 'jpeg', quality: 0.98 },\n                html2canvas: { scale: 2, useCORS: true },\n                jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }\n            };\n            html2pdf().set(opt).from(element).save();\n        }\n\n        // Auto-print functionality\n        const urlParams = new URLSearchParams(window.location.search);\n        if (urlParams.get('print') === 'true') {\n            window.onload = function() {\n                setTimeout(() => window.print(), 1000);\n            };\n        }\n    </script>\n</body>\n</html>\n"
        }
    ]
}