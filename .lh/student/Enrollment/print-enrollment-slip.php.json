{
    "sourceFile": "student/Enrollment/print-enrollment-slip.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1748594620994,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1748594620994,
            "name": "Commit-0",
            "content": "<?php\r\n// DB config\r\n$servername = \"localhost\";\r\n$username = \"root\";\r\n$password = \"\";\r\n$dbname = \"enrollment_system\";\r\n\r\n$conn = new mysqli($servername, $username, $password, $dbname);\r\nif ($conn->connect_error) {\r\n  die(\"Connection failed: \" . $conn->connect_error);\r\n}\r\n\r\n// Get enrollment id from URL\r\n$enrollment_id = isset($_GET['id']) ? intval($_GET['id']) : 0;\r\n\r\nif ($enrollment_id <= 0) {\r\n    die(\"❌ Invalid enrollment ID.\");\r\n}\r\n\r\n// Fetch enrollment info (only if status is Approved)\r\n$sqlEnrollment = \"SELECT * FROM enrollments WHERE id = ? AND status = 'Approved'\";\r\n$stmt = $conn->prepare($sqlEnrollment);\r\n$stmt->bind_param(\"i\", $enrollment_id);\r\n$stmt->execute();\r\n$result = $stmt->get_result();\r\n\r\nif ($result->num_rows == 0) {\r\n    die(\"❌ Enrollment not found or not yet approved. Please wait for admin confirmation.\");\r\n}\r\n\r\n$enrollment = $result->fetch_assoc();\r\n\r\n// Check if studentID is empty, then generate and update\r\nif (empty($enrollment['studentID'])) {\r\n    $currentYear = date(\"Y\");\r\n    $studentID = $currentYear . '-' . str_pad($enrollment_id, 4, '0', STR_PAD_LEFT);\r\n\r\n    $updateStmt = $conn->prepare(\"UPDATE enrollments SET studentID = ? WHERE id = ?\");\r\n    $updateStmt->bind_param(\"si\", $studentID, $enrollment_id);\r\n    $updateStmt->execute();\r\n    $updateStmt->close();\r\n\r\n    // Refresh local value\r\n    $enrollment['studentID'] = $studentID;\r\n}\r\n\r\n// Fetch subjects linked to enrollment\r\n$sqlSubjects = \"SELECT * FROM subjects WHERE enrollment_id = ?\";\r\n$stmt2 = $conn->prepare($sqlSubjects);\r\n$stmt2->bind_param(\"i\", $enrollment_id);\r\n$stmt2->execute();\r\n$subjectsResult = $stmt2->get_result();\r\n\r\n$subjects = [];\r\nwhile ($row = $subjectsResult->fetch_assoc()) {\r\n    $subjects[] = $row;\r\n}\r\n\r\n$stmt->close();\r\n$stmt2->close();\r\n$conn->close();\r\n?>\r\n\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n  <meta charset=\"UTF-8\" />\r\n  <title>Enrollment Slip</title>\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\" />\r\n  <link rel=\"icon\" href=\"favicon.ico\" type=\"image/x-icon\">\r\n  <style>\r\n    body {\r\n      background-color: #e8f5e9;\r\n      font-family: 'Segoe UI', sans-serif;\r\n    }\r\n    .navbar {\r\n      background-color: #2e7d32;\r\n    }\r\n    .navbar-brand, .nav-link {\r\n      color: #fff !important;\r\n      font-weight: 600;\r\n      letter-spacing: 0.05em;\r\n    }\r\n    .nav-link:hover {\r\n      color: #c8e6c9 !important;\r\n    }\r\n    .school-header {\r\n      text-align: center;\r\n      margin-bottom: 30px;\r\n    }\r\n    .school-header img {\r\n      width: 100px;\r\n      height: 100px;\r\n      object-fit: cover;\r\n      border-radius: 50%;\r\n      border: 3px solid #4caf50;\r\n    }\r\n    .enrollment-slip {\r\n      background: white;\r\n      padding: 30px;\r\n      border-radius: 12px;\r\n      box-shadow: 0 0 15px rgba(0,0,0,0.1);\r\n    }\r\n    .table thead th {\r\n      background-color: #43a047;\r\n      color: white;\r\n    }\r\n    .badge-status {\r\n      font-size: 1rem;\r\n      padding: 6px 12px;\r\n    }\r\n    @media print {\r\n      .no-print {\r\n        display: none;\r\n      }\r\n    }\r\n  </style>\r\n</head>\r\n<body>\r\n  <nav class=\"navbar navbar-expand-lg\">\r\n    <div class=\"container\">\r\n      <a class=\"navbar-brand\" href=\"/IT2C_Enrollment_System_SourceCode/student/student-dashboard.php\">\r\n        Student Dashboard\r\n      </a>\r\n      <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\" aria-controls=\"navbarNav\" aria-expanded=\"false\" aria-label=\"Toggle navigation\">\r\n        <span class=\"navbar-toggler-icon\"></span>\r\n      </button>\r\n      <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\r\n        <ul class=\"navbar-nav ms-auto\">\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link\" href=\"/IT2C_Enrollment_System_SourceCode/student/student-dashboard.php\">\r\n              <i class=\"bi bi-arrow-left\"></i> Back to Dashboard\r\n            </a>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  </nav>\r\n\r\n  <div class=\"container my-5\">\r\n    <div class=\"school-header\">\r\n      <img src=\"/IT2C_Enrollment_System_SourceCode/picture/tlgc_pic.jpg\" alt=\"School Logo\" />\r\n      <h4 class=\"mt-2 mb-0\">Top Link Global College Inc.</h4>\r\n      <p class=\"mb-0\">MRF Compound, Purok Lambingan, Brgy. Daan Sarile, Cabanatuan City</p>\r\n      <p class=\"mb-2\">Nueva Ecija, Philippines</p>\r\n      <h5 class=\"fw-bold text-success\">Enrollment Slip / Certificate</h5>\r\n    </div>\r\n\r\n    <div class=\"enrollment-slip\" id=\"enrollmentSlip\">\r\n  <div class=\"row mb-4\">\r\n    <div class=\"col-md-6\">\r\n      <p><strong>Student Name:</strong> <?= htmlspecialchars($enrollment['studentName']) ?></p>\r\n      <p><strong>Student ID:</strong> <?= htmlspecialchars($enrollment['studentID']) ?></p>\r\n    </div>\r\n    <div class=\"col-md-6\">\r\n      <p><strong>Program:</strong> <?= htmlspecialchars($enrollment['program']) ?></p>\r\n      <p><strong>Year Level:</strong> <?= htmlspecialchars($enrollment['yearLevel']) ?></p>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"row mb-4\">\r\n    <div class=\"col-md-6\">\r\n      <p><strong>Semester:</strong> <?= htmlspecialchars($enrollment['semester']) ?></p>\r\n      <p><strong>Section:</strong> <?= htmlspecialchars($enrollment['section']) ?></p>\r\n    </div>\r\n    <div class=\"col-md-6\">\r\n      <p><strong>Date Submitted:</strong> <?= date(\"F d, Y\", strtotime($enrollment['dateSubmitted'])) ?></p>\r\n      <p><strong>Status:</strong> \r\n        <span class=\"badge bg-success badge-status\">\r\n          <?= htmlspecialchars($enrollment['status']) ?>\r\n        </span>\r\n      </p>\r\n    </div>\r\n  </div>\r\n\r\n  <h5 class=\"mb-3\">Assigned Subjects / Class Schedule</h5>\r\n  <div class=\"table-responsive\">\r\n    <table class=\"table table-bordered table-hover\">\r\n      <thead>\r\n        <tr>\r\n          <th>Subject Code</th>\r\n          <th>Subject Title</th>\r\n          <th>Units</th>\r\n          <th>Schedule</th>\r\n          <th>Instructor</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        <?php if (count($subjects) > 0): ?>\r\n          <?php foreach ($subjects as $subject): ?>\r\n            <tr>\r\n              <td><?= htmlspecialchars($subject['code']) ?></td>\r\n              <td><?= htmlspecialchars($subject['title']) ?></td>\r\n              <td><?= htmlspecialchars($subject['units']) ?></td>\r\n              <td><?= htmlspecialchars($subject['schedule']) ?></td>\r\n              <td><?= htmlspecialchars($subject['instructor']) ?></td>\r\n            </tr>\r\n          <?php endforeach; ?>\r\n        <?php else: ?>\r\n          <tr><td colspan=\"5\" class=\"text-center\">No subjects assigned.</td></tr>\r\n        <?php endif; ?>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n\r\n  <div class=\"mt-4 text-center\">\r\n    <p><strong>Enrollment No:</strong> ENR-<?= $enrollment_id ?></p>\r\n    <img src=\"images/qr/qr_enrollment_<?= $enrollment_id ?>.png\" width=\"120\" alt=\"QR Code\" />\r\n  </div>\r\n\r\n  <div class=\"text-center mt-4 no-print\">\r\n    <button onclick=\"window.print()\" class=\"btn btn-success me-2\">Print Slip</button>\r\n    <button onclick=\"downloadPDF()\" class=\"btn btn-primary\">Download PDF</button>\r\n  </div>\r\n</div>\r\n\r\n  <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\r\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js\"></script>\r\n<script>\r\n  function downloadPDF() {\r\n    const element = document.getElementById('enrollmentSlip');\r\n    html2pdf().set({\r\n      margin: 1,\r\n      filename: 'enrollment_slip_ENR-<?= $enrollment_id ?>.pdf',\r\n      image: { type: 'jpeg', quality: 0.98 },\r\n      html2canvas: { scale: 2 },\r\n      jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }\r\n    }).from(element).save();\r\n  }\r\n</script>\r\n</body>\r\n</html>"
        }
    ]
}