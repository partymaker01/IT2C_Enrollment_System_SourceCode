{
    "sourceFile": "student/Enrollment/view_assigned_subjects.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1749399272178,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1749399272178,
            "name": "Commit-0",
            "content": "<?php\r\nsession_start();\r\n\r\nif (!isset($_SESSION['student_id'])) {\r\n    header(\"Location: ../../logregfor/login.php\");\r\n    exit;\r\n}\r\n\r\nrequire_once '../../db.php';\r\n\r\n$student_id = $_SESSION['student_id'];\r\n\r\n// Fetch student info\r\n$stmt = $pdo->prepare(\"SELECT * FROM students WHERE student_id = ?\");\r\n$stmt->execute([$student_id]);\r\n$student = $stmt->fetch(PDO::FETCH_ASSOC);\r\n\r\nif (!$student) {\r\n    header(\"Location: ../../logregfor/login.php\");\r\n    exit;\r\n}\r\n\r\n// Get the latest approved enrollment for the student\r\n$stmt = $pdo->prepare(\"\r\n    SELECT * FROM enrollments \r\n    WHERE student_id = ? AND status = 'approved' \r\n    ORDER BY date_submitted DESC \r\n    LIMIT 1\r\n\");\r\n$stmt->execute([$student_id]);\r\n$enrollment = $stmt->fetch(PDO::FETCH_ASSOC);\r\n\r\n// Get semester and school year from GET, enrollment data, or use defaults\r\n$semester = $_GET['semester'] ?? ($enrollment['semester'] ?? '1st Semester');\r\n$school_year = $_GET['school_year'] ?? ($enrollment['school_year'] ?? '2024-2025');\r\n\r\n// Use enrollment data for student info if available\r\n$student_program = $enrollment['program'] ?? 'N/A';\r\n$student_year_level = $enrollment['year_level'] ?? 'N/A';\r\n$student_section = $enrollment['section'] ?? 'N/A';\r\n\r\n// Fetch assigned subjects\r\n$stmt = $pdo->prepare(\"\r\n    SELECT s.subject_code, s.subject_title, s.instructor, s.day, s.time, s.room, s.units, ss.grade, ss.status\r\n    FROM subjects s\r\n    JOIN student_subjects ss ON s.id = ss.subject_id\r\n    WHERE ss.student_id = ? AND ss.semester = ? AND ss.school_year = ?\r\n    ORDER BY s.subject_code\r\n\");\r\n$stmt->execute([$student_id, $semester, $school_year]);\r\n$subjects = $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n\r\n// If no subjects found, get sample subjects for demonstration\r\nif (empty($subjects)) {\r\n    $stmt = $pdo->prepare(\"SELECT * FROM subjects WHERE status = 'Active' ORDER BY subject_code ASC LIMIT 6\");\r\n    $stmt->execute();\r\n    $sampleSubjects = $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n    \r\n    foreach ($sampleSubjects as $subject) {\r\n        $subjects[] = [\r\n            'subject_code' => $subject['subject_code'],\r\n            'subject_title' => $subject['subject_title'],\r\n            'instructor' => $subject['instructor'],\r\n            'day' => $subject['day'],\r\n            'time' => $subject['time'],\r\n            'room' => $subject['room'],\r\n            'units' => $subject['units'],\r\n            'grade' => null,\r\n            'status' => 'Enrolled'\r\n        ];\r\n    }\r\n}\r\n\r\n$totalUnits = array_sum(array_column($subjects, 'units'));\r\n?>\r\n\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n    <title>Assigned Subjects - Student Portal</title>\r\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css\" rel=\"stylesheet\">\r\n    <link rel=\"icon\" href=\"../../picture/tlgc_pic.jpg\" type=\"image/x-icon\">\r\n    <style>\r\n        :root {\r\n            --primary-green: #2e7d32;\r\n            --light-green: #e8f5e9;\r\n            --accent-green: #43a047;\r\n            --hover-green: #c8e6c9;\r\n            --dark-green: #1b5e20;\r\n        }\r\n\r\n        body {\r\n            background: linear-gradient(135deg, var(--light-green) 0%, #f1f8e9 100%);\r\n            min-height: 100vh;\r\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\r\n        }\r\n\r\n        .navbar {\r\n            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);\r\n            box-shadow: 0 2px 10px rgba(46, 125, 50, 0.3);\r\n        }\r\n\r\n        .navbar-brand, .nav-link {\r\n            color: #fff !important;\r\n            font-weight: 600;\r\n            letter-spacing: 0.5px;\r\n        }\r\n\r\n        .nav-link:hover {\r\n            color: var(--hover-green) !important;\r\n        }\r\n\r\n        .school-logo {\r\n            width: 50px;\r\n            height: 50px;\r\n            object-fit: cover;\r\n            border-radius: 50%;\r\n            margin-right: 15px;\r\n            border: 3px solid #fff;\r\n        }\r\n\r\n        .subjects-card {\r\n            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);\r\n            border-radius: 20px;\r\n            box-shadow: 0 10px 30px rgba(46, 125, 50, 0.15);\r\n            padding: 2rem;\r\n            margin-bottom: 2rem;\r\n            border: 1px solid rgba(46, 125, 50, 0.1);\r\n        }\r\n\r\n        .section-title {\r\n            color: var(--primary-green);\r\n            font-weight: 700;\r\n            margin-bottom: 1.5rem;\r\n            position: relative;\r\n            padding-bottom: 10px;\r\n        }\r\n\r\n        .section-title::after {\r\n            content: '';\r\n            position: absolute;\r\n            bottom: 0;\r\n            left: 0;\r\n            width: 50px;\r\n            height: 3px;\r\n            background: linear-gradient(90deg, var(--accent-green), var(--primary-green));\r\n            border-radius: 2px;\r\n        }\r\n\r\n        .student-header {\r\n            background: linear-gradient(135deg, var(--accent-green) 0%, var(--primary-green) 100%);\r\n            color: white;\r\n            border-radius: 15px;\r\n            padding: 1.5rem;\r\n            margin-bottom: 2rem;\r\n        }\r\n\r\n        .filter-card {\r\n            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);\r\n            border-radius: 15px;\r\n            padding: 1.5rem;\r\n            margin-bottom: 2rem;\r\n            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);\r\n        }\r\n\r\n        .table {\r\n            border-radius: 15px;\r\n            overflow: hidden;\r\n            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);\r\n        }\r\n\r\n        .table thead th {\r\n            background: linear-gradient(135deg, var(--accent-green) 0%, var(--primary-green) 100%);\r\n            color: white;\r\n            border: none;\r\n            font-weight: 600;\r\n            padding: 1rem;\r\n        }\r\n\r\n        .table tbody tr {\r\n            transition: all 0.3s ease;\r\n        }\r\n\r\n        .table tbody tr:hover {\r\n            background-color: var(--light-green);\r\n            transform: scale(1.01);\r\n        }\r\n\r\n        .btn-custom {\r\n            background: linear-gradient(135deg, var(--accent-green) 0%, var(--primary-green) 100%);\r\n            border: none;\r\n            color: white;\r\n            font-weight: 600;\r\n            padding: 10px 20px;\r\n            border-radius: 25px;\r\n            transition: all 0.3s ease;\r\n            text-decoration: none;\r\n            display: inline-block;\r\n            margin: 0.25rem;\r\n        }\r\n\r\n        .btn-custom:hover {\r\n            transform: translateY(-2px);\r\n            box-shadow: 0 5px 15px rgba(67, 160, 71, 0.4);\r\n            color: white;\r\n        }\r\n\r\n        .summary-cards {\r\n            display: grid;\r\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\r\n            gap: 1rem;\r\n            margin-bottom: 2rem;\r\n        }\r\n\r\n        .summary-card {\r\n            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);\r\n            border-radius: 15px;\r\n            padding: 1.5rem;\r\n            text-align: center;\r\n            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);\r\n            transition: all 0.3s ease;\r\n        }\r\n\r\n        .summary-card:hover {\r\n            transform: translateY(-5px);\r\n            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);\r\n        }\r\n\r\n        .summary-icon {\r\n            font-size: 2.5rem;\r\n            margin-bottom: 1rem;\r\n            display: block;\r\n        }\r\n\r\n        .icon-subjects { color: #4caf50; }\r\n        .icon-units { color: #2196f3; }\r\n        .icon-instructor { color: #ff9800; }\r\n\r\n        .enrollment-status {\r\n            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);\r\n            border: 1px solid #ffc107;\r\n            border-radius: 15px;\r\n            padding: 1rem;\r\n            margin-bottom: 1rem;\r\n        }\r\n\r\n        @media print {\r\n            .no-print { display: none !important; }\r\n            .subjects-card { box-shadow: none !important; }\r\n        }\r\n    </style>\r\n</head>\r\n<body>\r\n    <!-- Navigation -->\r\n    <nav class=\"navbar navbar-expand-lg no-print\">\r\n        <div class=\"container\">\r\n            <a class=\"navbar-brand d-flex align-items-center\" href=\"../student-dashboard.php\">\r\n                <img src=\"../../picture/tlgc_pic.jpg\" alt=\"School Logo\" class=\"school-logo\">\r\n                <span>Student Portal</span>\r\n            </a>\r\n            <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\">\r\n                <span class=\"navbar-toggler-icon\"></span>\r\n            </button>\r\n            <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\r\n                <ul class=\"navbar-nav ms-auto\">\r\n                    <li class=\"nav-item\">\r\n                        <a class=\"nav-link\" href=\"../student-dashboard.php\">\r\n                            <i class=\"bi bi-arrow-left\"></i> Back to Dashboard\r\n                        </a>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n        </div>\r\n    </nav>\r\n\r\n    <div class=\"container my-4\">\r\n        <!-- Enrollment Status Alert -->\r\n        <?php if (!$enrollment): ?>\r\n            <div class=\"enrollment-status\">\r\n                <h5><i class=\"bi bi-exclamation-triangle me-2\"></i>No Approved Enrollment Found</h5>\r\n                <p class=\"mb-2\">You don't have an approved enrollment yet. Please complete your enrollment first.</p>\r\n                <a href=\"../Enrollment/fill-up-enrollment-form.php\" class=\"btn-custom\">\r\n                    <i class=\"bi bi-plus-circle me-1\"></i>Complete Enrollment\r\n                </a>\r\n            </div>\r\n        <?php endif; ?>\r\n\r\n        <!-- Student Header -->\r\n        <div class=\"student-header text-center\">\r\n            <h3><i class=\"bi bi-person-badge me-2\"></i><?= htmlspecialchars($student['first_name'] . ' ' . $student['last_name']) ?></h3>\r\n            <div class=\"row mt-3\">\r\n                <div class=\"col-md-4\">\r\n                    <strong>Program:</strong> <?= htmlspecialchars($student_program) ?>\r\n                </div>\r\n                <div class=\"col-md-4\">\r\n                    <strong>Year Level:</strong> <?= htmlspecialchars($student_year_level) ?>\r\n                </div>\r\n                <div class=\"col-md-4\">\r\n                    <strong>Section:</strong> <?= htmlspecialchars($student_section) ?>\r\n                </div>\r\n            </div>\r\n            <?php if ($enrollment): ?>\r\n                <div class=\"mt-2\">\r\n                    <small><i class=\"bi bi-check-circle me-1\"></i>Enrollment Status: <strong><?= ucfirst($enrollment['status']) ?></strong></small>\r\n                </div>\r\n            <?php endif; ?>\r\n        </div>\r\n\r\n        <h2 class=\"section-title\">\r\n            <i class=\"bi bi-book\"></i>\r\n            Assigned Subjects\r\n        </h2>\r\n\r\n        <!-- Filter Form -->\r\n        <div class=\"filter-card no-print\">\r\n            <form method=\"GET\" class=\"row g-3\">\r\n                <div class=\"col-md-4\">\r\n                    <label for=\"semester\" class=\"form-label\">\r\n                        <i class=\"bi bi-calendar-week me-1\"></i>Semester\r\n                    </label>\r\n                    <select class=\"form-select\" id=\"semester\" name=\"semester\">\r\n                        <option value=\"1st Semester\" <?= $semester == '1st Semester' ? 'selected' : '' ?>>1st Semester</option>\r\n                        <option value=\"2nd Semester\" <?= $semester == '2nd Semester' ? 'selected' : '' ?>>2nd Semester</option>\r\n                        <option value=\"Summer\" <?= $semester == 'Summer' ? 'selected' : '' ?>>Summer</option>\r\n                    </select>\r\n                </div>\r\n                <div class=\"col-md-4\">\r\n                    <label for=\"school_year\" class=\"form-label\">\r\n                        <i class=\"bi bi-calendar-range me-1\"></i>School Year\r\n                    </label>\r\n                    <input type=\"text\" class=\"form-control\" id=\"school_year\" name=\"school_year\" \r\n                           value=\"<?= htmlspecialchars($school_year) ?>\" placeholder=\"e.g., 2024-2025\">\r\n                </div>\r\n                <div class=\"col-md-4 align-self-end\">\r\n                    <button type=\"submit\" class=\"btn-custom w-100\">\r\n                        <i class=\"bi bi-search me-1\"></i>Load Subjects\r\n                    </button>\r\n                </div>\r\n            </form>\r\n        </div>\r\n\r\n        <!-- Summary Cards -->\r\n        <div class=\"summary-cards\">\r\n            <div class=\"summary-card\">\r\n                <i class=\"bi bi-book-fill summary-icon icon-subjects\"></i>\r\n                <h5>Total Subjects</h5>\r\n                <p class=\"display-6 mb-0\"><?= count($subjects) ?></p>\r\n            </div>\r\n            <div class=\"summary-card\">\r\n                <i class=\"bi bi-calculator summary-icon icon-units\"></i>\r\n                <h5>Total Units</h5>\r\n                <p class=\"display-6 mb-0\"><?= $totalUnits ?></p>\r\n            </div>\r\n            <div class=\"summary-card\">\r\n                <i class=\"bi bi-person-workspace summary-icon icon-instructor\"></i>\r\n                <h5>Instructors</h5>\r\n                <p class=\"display-6 mb-0\"><?= count(array_unique(array_column($subjects, 'instructor'))) ?></p>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- Subjects Table -->\r\n        <div class=\"subjects-card\">\r\n            <h4 class=\"section-title\">Subject Details - <?= htmlspecialchars($semester) ?> (<?= htmlspecialchars($school_year) ?>)</h4>\r\n            <div class=\"table-responsive\">\r\n                <table class=\"table table-hover align-middle\">\r\n                    <thead>\r\n                        <tr>\r\n                            <th>Subject Code</th>\r\n                            <th>Subject Title</th>\r\n                            <th>Instructor</th>\r\n                            <th>Schedule</th>\r\n                            <th>Room</th>\r\n                            <th>Units</th>\r\n                            <th>Status</th>\r\n                            <th>Grade</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        <?php if (!empty($subjects)): ?>\r\n                            <?php foreach ($subjects as $subject): ?>\r\n                                <tr>\r\n                                    <td><strong><?= htmlspecialchars($subject['subject_code']) ?></strong></td>\r\n                                    <td><?= htmlspecialchars($subject['subject_title']) ?></td>\r\n                                    <td><?= htmlspecialchars($subject['instructor']) ?></td>\r\n                                    <td>\r\n                                        <small>\r\n                                            <i class=\"bi bi-calendar-day me-1\"></i><?= htmlspecialchars($subject['day']) ?><br>\r\n                                            <i class=\"bi bi-clock me-1\"></i><?= htmlspecialchars($subject['time']) ?>\r\n                                        </small>\r\n                                    </td>\r\n                                    <td><?= htmlspecialchars($subject['room']) ?></td>\r\n                                    <td><span class=\"badge bg-primary\"><?= htmlspecialchars($subject['units']) ?></span></td>\r\n                                    <td>\r\n                                        <span class=\"badge bg-success\">\r\n                                            <i class=\"bi bi-check-circle me-1\"></i><?= htmlspecialchars($subject['status'] ?? 'Enrolled') ?>\r\n                                        </span>\r\n                                    </td>\r\n                                    <td>\r\n                                        <?php if ($subject['grade']): ?>\r\n                                            <span class=\"badge bg-info\"><?= htmlspecialchars($subject['grade']) ?></span>\r\n                                        <?php else: ?>\r\n                                            <span class=\"text-muted\">Ongoing</span>\r\n                                        <?php endif; ?>\r\n                                    </td>\r\n                                </tr>\r\n                            <?php endforeach; ?>\r\n                        <?php else: ?>\r\n                            <tr>\r\n                                <td colspan=\"8\" class=\"text-center py-4\">\r\n                                    <i class=\"bi bi-book-x\" style=\"font-size: 3rem; color: #6c757d;\"></i>\r\n                                    <p class=\"text-muted mt-2\">No subjects found for <?= htmlspecialchars($semester) ?> (<?= htmlspecialchars($school_year) ?>)</p>\r\n                                    <?php if (!$enrollment): ?>\r\n                                        <a href=\"../Enrollment/fill-up-enrollment-form.php\" class=\"btn-custom\">\r\n                                            <i class=\"bi bi-plus-circle me-1\"></i>Complete Enrollment First\r\n                                        </a>\r\n                                    <?php else: ?>\r\n                                        <p class=\"text-muted\">Contact the registrar to assign subjects to your enrollment.</p>\r\n                                    <?php endif; ?>\r\n                                </td>\r\n                            </tr>\r\n                        <?php endif; ?>\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n\r\n            <?php if (!empty($subjects)): ?>\r\n                <!-- Action Buttons -->\r\n                <div class=\"text-center mt-4 no-print\">\r\n                    <button class=\"btn-custom\" onclick=\"window.print()\">\r\n                        <i class=\"bi bi-printer me-1\"></i>Print Schedule\r\n                    </button>\r\n                    <a href=\"mysubject.php\" class=\"btn-custom\">\r\n                        <i class=\"bi bi-calendar-week me-1\"></i>View Weekly Schedule\r\n                    </a>\r\n                    <a href=\"current-enrollment-status.php\" class=\"btn-custom\">\r\n                        <i class=\"bi bi-eye me-1\"></i>View Enrollment Status\r\n                    </a>\r\n                </div>\r\n            <?php endif; ?>\r\n        </div>\r\n    </div>\r\n\r\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\r\n</body>\r\n</html>\r\n"
        }
    ]
}