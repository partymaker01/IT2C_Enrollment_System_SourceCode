{
    "sourceFile": "student/Enrollment/fill-up-enrollment-form.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1748461652775,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1748462933109,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,24 +1,30 @@\n <?php\r\n-// DB connection settings - change these!\r\n+session_start(); // âœ… Important\r\n+\r\n+// Check if student is logged in\r\n+if (!isset($_SESSION['student_id'])) {\r\n+    header(\"Location: ../logregfor/login.php\");\r\n+    exit;\r\n+}\r\n+\r\n+$student_id = $_SESSION['student_id'];\r\n+\r\n $servername = \"localhost\";\r\n $username = \"root\";\r\n $password = \"\";\r\n-$dbname = \"your_database_name\";\r\n+$dbname = \"enrollment_system\";\r\n \r\n-$conn = new mysqli(\"localhost\", \"root\", \"\", \"enrollment_system\");\r\n-\r\n+$conn = new mysqli($servername, $username, $password, $dbname);\r\n if ($conn->connect_error) {\r\n     die(\"Connection failed: \" . $conn->connect_error);\r\n }\r\n \r\n-\r\n $program = $yearLevel = $semester = $section = \"\";\r\n $submitted = false;\r\n $errors = [];\r\n \r\n if ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\r\n-\r\n     $program = $_POST['program'] ?? \"\";\r\n     $yearLevel = $_POST['yearLevel'] ?? \"\";\r\n     $semester = $_POST['semester'] ?? \"\";\r\n     $section = $_POST['section'] ?? \"\";\r\n@@ -28,25 +34,39 @@\n     if (empty($semester)) $errors[] = \"Please select a Semester.\";\r\n     if (empty($section)) $errors[] = \"Please select a Section.\";\r\n \r\n     if (empty($errors)) {\r\n-        // Prepare and bind\r\n-        $stmt = $conn->prepare(\"INSERT INTO enrollments (program, year_level, semester, section) VALUES (?, ?, ?, ?)\");\r\n-        $stmt->bind_param(\"ssss\", $program, $yearLevel, $semester, $section);\r\n+        // Check if student exists before inserting\r\n+        $check = $conn->prepare(\"SELECT id FROM students WHERE id = ?\");\r\n+        $check->bind_param(\"i\", $student_id);\r\n+        $check->execute();\r\n+        $check->store_result();\r\n \r\n-        if ($stmt->execute()) {\r\n-            $submitted = true;\r\n+        if ($check->num_rows === 0) {\r\n+            $errors[] = \"Invalid student ID. Please log in again.\";\r\n         } else {\r\n-            $errors[] = \"Failed to submit enrollment. Please try again.\";\r\n+            $stmt = $conn->prepare(\"INSERT INTO enrollments (student_id, program, year_level, semester, section) VALUES (?, ?, ?, ?, ?)\");\r\n+            $stmt->bind_param(\"issss\", $student_id, $program, $yearLevel, $semester, $section);\r\n+\r\n+            if ($stmt->execute()) {\r\n+                $submitted = true;\r\n+            } else {\r\n+                $errors[] = \"Failed to submit enrollment: \" . $stmt->error;\r\n+            }\r\n+\r\n+            $stmt->close();\r\n         }\r\n \r\n-        $stmt->close();\r\n+        $check->close();\r\n     }\r\n }\r\n \r\n $conn->close();\r\n ?>\r\n \r\n+$conn->close();\r\n+?>\r\n+\r\n <!DOCTYPE html>\r\n <html lang=\"en\">\r\n <head>\r\n   <meta charset=\"UTF-8\" />\r\n"
                },
                {
                    "date": 1748462944018,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -62,11 +62,8 @@\n \r\n $conn->close();\r\n ?>\r\n \r\n-$conn->close();\r\n-?>\r\n-\r\n <!DOCTYPE html>\r\n <html lang=\"en\">\r\n <head>\r\n   <meta charset=\"UTF-8\" />\r\n"
                }
            ],
            "date": 1748461652775,
            "name": "Commit-0",
            "content": "<?php\r\n// DB connection settings - change these!\r\n$servername = \"localhost\";\r\n$username = \"root\";\r\n$password = \"\";\r\n$dbname = \"your_database_name\";\r\n\r\n$conn = new mysqli(\"localhost\", \"root\", \"\", \"enrollment_system\");\r\n\r\nif ($conn->connect_error) {\r\n    die(\"Connection failed: \" . $conn->connect_error);\r\n}\r\n\r\n\r\n$program = $yearLevel = $semester = $section = \"\";\r\n$submitted = false;\r\n$errors = [];\r\n\r\nif ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\r\n\r\n    $program = $_POST['program'] ?? \"\";\r\n    $yearLevel = $_POST['yearLevel'] ?? \"\";\r\n    $semester = $_POST['semester'] ?? \"\";\r\n    $section = $_POST['section'] ?? \"\";\r\n\r\n    if (empty($program)) $errors[] = \"Please select a Program.\";\r\n    if (empty($yearLevel)) $errors[] = \"Please select a Year Level.\";\r\n    if (empty($semester)) $errors[] = \"Please select a Semester.\";\r\n    if (empty($section)) $errors[] = \"Please select a Section.\";\r\n\r\n    if (empty($errors)) {\r\n        // Prepare and bind\r\n        $stmt = $conn->prepare(\"INSERT INTO enrollments (program, year_level, semester, section) VALUES (?, ?, ?, ?)\");\r\n        $stmt->bind_param(\"ssss\", $program, $yearLevel, $semester, $section);\r\n\r\n        if ($stmt->execute()) {\r\n            $submitted = true;\r\n        } else {\r\n            $errors[] = \"Failed to submit enrollment. Please try again.\";\r\n        }\r\n\r\n        $stmt->close();\r\n    }\r\n}\r\n\r\n$conn->close();\r\n?>\r\n\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n  <meta charset=\"UTF-8\" />\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\r\n  <title>Fill-up Enrollment Form</title>\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\" />\r\n  <link rel=\"icon\" href=\"favicon.ico\" type=\"image/x-icon\">\r\n  <style>\r\n    body {\r\n      background-color: #e6f2e6; \r\n    }\r\n    .navbar {\r\n      background-color: #2e7d32;\r\n    }\r\n    .navbar-brand, .nav-link {\r\n      color: #fff !important;\r\n      font-weight: 600;\r\n      letter-spacing: 0.05em;\r\n    }\r\n    .nav-link:hover {\r\n      color: #c8e6c9 !important;\r\n    }\r\n    h2 {\r\n      color: #2e7d32;\r\n      font-weight: 700;\r\n    }\r\n    label {\r\n      color: #0f0f0f; \r\n      font-weight: 600;\r\n    }\r\n    .form-select, .form-control {\r\n      background-color: #f1f8e9;\r\n      border-color: #81c784;\r\n      color: #0f0f0f;\r\n      transition: border-color 0.3s ease;\r\n    }\r\n    .form-select:focus, .form-control:focus {\r\n      border-color: #388e3c;\r\n      box-shadow: 0 0 0 0.25rem rgba(56, 142, 60, 0.25);\r\n      outline: none;\r\n    }\r\n    .btn-primary {\r\n      background-color: #2e7d32;\r\n      border-color: #2e7d32;\r\n      font-weight: 600;\r\n    }\r\n    .btn-primary:hover {\r\n      background-color: #27632a;\r\n      border-color: #27632a;\r\n    }\r\n    .form-container {\r\n      max-width: 480px;\r\n      background: white;\r\n      padding: 25px 30px;\r\n      border-radius: 8px;\r\n      box-shadow: 0 0 15px rgba(0,0,0,0.1);\r\n    }\r\n  </style>\r\n</head>\r\n<body>\r\n  <nav class=\"navbar navbar-expand-lg\">\r\n    <div class=\"container\">\r\n      <a class=\"navbar-brand\" href=\"/IT2C_Enrollment_System_SourceCode/student//student-dashboard.php\">\r\n        Student Dashboard\r\n      </a>\r\n      <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\" aria-controls=\"navbarNav\" aria-expanded=\"false\" aria-label=\"Toggle navigation\">\r\n        <span class=\"navbar-toggler-icon\"></span>\r\n      </button>\r\n      <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\r\n        <ul class=\"navbar-nav ms-auto\">\r\n          <li class=\"nav-item\"><a class=\"nav-link\" href=\"/IT2C_Enrollment_System_SourceCode/student//student-dashboard.php\" class=\"btn btn-outline-secondary mb-3\">\r\n          <i class=\"bi bi-arrow-left\"></i> Back to Dashboard\r\n          </a>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  </nav>\r\n  <div class=\"container my-5 d-flex justify-content-center\">\r\n    <div class=\"form-container\">\r\n      <h2 class=\"text-center mb-4\">\r\n        Fill-up Enrollment Form\r\n      </h2>\r\n\r\n      <?php if ($submitted): ?>\r\n        <div class=\"alert alert-success text-center\">\r\n          <h5>\r\n            Enrollment Submitted Successfully!\r\n          </h5>\r\n          <p><strong>\r\n            Program:\r\n          </strong> <?= htmlspecialchars($program) ?></p>\r\n          <p><strong>\r\n            Year Level:\r\n          </strong> <?= htmlspecialchars($yearLevel) ?></p>\r\n          <p><strong>\r\n            Semester:\r\n          </strong> <?= htmlspecialchars($semester) ?></p>\r\n          <p><strong>\r\n            Section:\r\n          </strong> <?= htmlspecialchars($section) ?></p>\r\n        </div>\r\n        <div class=\"text-center\">\r\n          <a href=\"<?= $_SERVER['PHP_SELF'] ?>\" class=\"btn btn-secondary mt-3\">\r\n            Submit Another Enrollment\r\n          </a>\r\n        </div>\r\n      <?php else: ?>\r\n\r\n        <?php if ($errors): ?>\r\n          <div class=\"alert alert-danger\">\r\n            <ul class=\"mb-0\">\r\n              <?php foreach($errors as $error): ?>\r\n                <li><?= htmlspecialchars($error) ?></li>\r\n              <?php endforeach; ?>\r\n            </ul>\r\n          </div>\r\n        <?php endif; ?>\r\n\r\n        <form action=\"<?= $_SERVER['PHP_SELF'] ?>\" method=\"post\">\r\n          <div class=\"mb-3\">\r\n            <label for=\"program\" class=\"form-label\">\r\n              Program\r\n            </label>\r\n            <select class=\"form-select\" name=\"program\" id=\"program\">\r\n              <option value=\"\">Select Program</option>\r\n              <option value=\"IT\" <?= $program == \"IT\" ? \"selected\" : \"\" ?>>IT</option>\r\n              <option value=\"ECT\" <?= $program == \"ECT\" ? \"selected\" : \"\" ?>>ECT</option>\r\n              <option value=\"HRMT\" <?= $program == \"HRMT\" ? \"selected\" : \"\" ?>>HRMT</option>\r\n              <option value=\"HST\" <?= $program == \"HST\" ? \"selected\" : \"\" ?>>HST</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div class=\"mb-3\">\r\n            <label for=\"yearLevel\" class=\"form-label\">\r\n              Year Level\r\n            </label>\r\n            <select class=\"form-select\" name=\"yearLevel\" id=\"yearLevel\">\r\n              <option value=\"\">Select Year Level</option>\r\n              <option value=\"1st Year\" <?= $yearLevel == \"1st Year\" ? \"selected\" : \"\" ?>>1st Year</option>\r\n              <option value=\"2nd Year\" <?= $yearLevel == \"2nd Year\" ? \"selected\" : \"\" ?>>2nd Year</option>\r\n              <option value=\"3rd Year\" <?= $yearLevel == \"3rd Year\" ? \"selected\" : \"\" ?>>3rd Year</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div class=\"mb-3\">\r\n            <label for=\"semester\" class=\"form-label\">\r\n              Semester\r\n            </label>\r\n            <select class=\"form-select\" name=\"semester\" id=\"semester\">\r\n              <option value=\"\">Select Semester</option>\r\n              <option value=\"1st Semester\" <?= $semester == \"1st Semester\" ? \"selected\" : \"\" ?>>1st Semester</option>\r\n              <option value=\"2nd Semester\" <?= $semester == \"2nd Semester\" ? \"selected\" : \"\" ?>>2nd Semester</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div class=\"mb-3\">\r\n            <label for=\"section\" class=\"form-label\">Section</label>\r\n            <select class=\"form-select\" name=\"section\" id=\"section\">\r\n              <option value=\"\">Select Section</option>\r\n              <option value=\"Section A\" <?= $section == \"Section A\" ? \"selected\" : \"\" ?>>A</option>\r\n              <option value=\"Section B\" <?= $section == \"Section B\" ? \"selected\" : \"\" ?>>B</option>\r\n              <option value=\"Section C\" <?= $section == \"Section C\" ? \"selected\" : \"\" ?>>C</option>\r\n              <option value=\"Section D\" <?= $section == \"Section D\" ? \"selected\" : \"\" ?>>D</option>\r\n              <option value=\"Section E\" <?= $section == \"Section E\" ? \"selected\" : \"\" ?>>E</option>\r\n              <option value=\"Section F\" <?= $section == \"Section F\" ? \"selected\" : \"\" ?>>F</option>\r\n              <option value=\"Section G\" <?= $section == \"Section G\" ? \"selected\" : \"\" ?>>G</option>\r\n              <option value=\"Section H\" <?= $section == \"Section H\" ? \"selected\" : \"\" ?>>H</option>\r\n            </select>\r\n          </div>\r\n\r\n          <button type=\"submit\" class=\"btn btn-primary w-100\">\r\n            Submit Enrollment\r\n          </button>\r\n        </form>\r\n      <?php endif; ?>\r\n    </div>\r\n  </div>\r\n\r\n  <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\r\n</body>\r\n</html>\r\n"
        }
    ]
}