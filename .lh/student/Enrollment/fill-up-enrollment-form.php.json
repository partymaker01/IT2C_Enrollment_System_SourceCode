{
    "sourceFile": "student/Enrollment/fill-up-enrollment-form.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1749393779489,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1749393779489,
            "name": "Commit-0",
            "content": "<?php\nsession_start();\n\nif (!isset($_SESSION['student_id'])) {\n    header(\"Location: ../../logregfor/login.php\");\n    exit;\n}\n\nrequire_once '../../db.php';\n\n$student_id = $_SESSION['student_id'];\n$errors = [];\n$success = false;\n\n// Check if student already has a pending or approved enrollment\n$stmt = $pdo->prepare(\"SELECT * FROM enrollments WHERE student_id = ? AND status IN ('pending', 'approved') ORDER BY date_submitted DESC LIMIT 1\");\n$stmt->execute([$student_id]);\n$existingEnrollment = $stmt->fetch();\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    $program = trim($_POST['program'] ?? '');\n    $yearLevel = trim($_POST['year_level'] ?? '');\n    $semester = trim($_POST['semester'] ?? '');\n    $section = trim($_POST['section'] ?? '');\n    $schoolYear = trim($_POST['school_year'] ?? '');\n\n    // Validation\n    if (empty($program)) $errors[] = \"Program is required.\";\n    if (empty($yearLevel)) $errors[] = \"Year Level is required.\";\n    if (empty($semester)) $errors[] = \"Semester is required.\";\n    if (empty($section)) $errors[] = \"Section is required.\";\n    if (empty($schoolYear)) $errors[] = \"School Year is required.\";\n\n    if ($existingEnrollment && $existingEnrollment['status'] === 'approved') {\n        $errors[] = \"You already have an approved enrollment for this period.\";\n    }\n\n    if (empty($errors)) {\n        try {\n            // If there's a pending enrollment, update it; otherwise, create new\n            if ($existingEnrollment && $existingEnrollment['status'] === 'pending') {\n                $stmt = $pdo->prepare(\"UPDATE enrollments SET program = ?, year_level = ?, semester = ?, section = ?, school_year = ?, date_submitted = NOW() WHERE id = ?\");\n                $stmt->execute([$program, $yearLevel, $semester, $section, $schoolYear, $existingEnrollment['id']]);\n            } else {\n                $stmt = $pdo->prepare(\"INSERT INTO enrollments (student_id, program, year_level, semester, section, school_year, status, date_submitted) VALUES (?, ?, ?, ?, ?, ?, 'pending', NOW())\");\n                $stmt->execute([$student_id, $program, $yearLevel, $semester, $section, $schoolYear]);\n            }\n            $success = true;\n        } catch (PDOException $e) {\n            $errors[] = \"Database error: \" . $e->getMessage();\n        }\n    }\n}\n\n// Get current school year\n$currentYear = date('Y');\n$nextYear = $currentYear + 1;\n$defaultSchoolYear = $currentYear . '-' . $nextYear;\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <title>Enrollment Form - Student Portal</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css\" rel=\"stylesheet\">\n    <link rel=\"icon\" href=\"../../picture/tlgc_pic.jpg\" type=\"image/x-icon\">\n    <style>\n        :root {\n            --primary-green: #2e7d32;\n            --light-green: #e8f5e9;\n            --accent-green: #43a047;\n            --hover-green: #c8e6c9;\n            --dark-green: #1b5e20;\n        }\n\n        body {\n            background: linear-gradient(135deg, var(--light-green) 0%, #f1f8e9 100%);\n            min-height: 100vh;\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n        }\n\n        .navbar {\n            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);\n            box-shadow: 0 2px 10px rgba(46, 125, 50, 0.3);\n        }\n\n        .navbar-brand, .nav-link {\n            color: #fff !important;\n            font-weight: 600;\n            letter-spacing: 0.5px;\n        }\n\n        .nav-link:hover {\n            color: var(--hover-green) !important;\n        }\n\n        .school-logo {\n            width: 50px;\n            height: 50px;\n            object-fit: cover;\n            border-radius: 50%;\n            margin-right: 15px;\n            border: 3px solid #fff;\n        }\n\n        .form-container {\n            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);\n            border-radius: 20px;\n            box-shadow: 0 10px 30px rgba(46, 125, 50, 0.15);\n            padding: 2.5rem;\n            margin: 2rem auto;\n            max-width: 600px;\n            border: 1px solid rgba(46, 125, 50, 0.1);\n        }\n\n        .form-title {\n            color: var(--primary-green);\n            font-weight: 700;\n            text-align: center;\n            margin-bottom: 2rem;\n            position: relative;\n        }\n\n        .form-title::after {\n            content: '';\n            position: absolute;\n            bottom: -10px;\n            left: 50%;\n            transform: translateX(-50%);\n            width: 80px;\n            height: 3px;\n            background: linear-gradient(90deg, var(--accent-green), var(--primary-green));\n            border-radius: 2px;\n        }\n\n        .form-label {\n            color: var(--dark-green);\n            font-weight: 600;\n            margin-bottom: 0.5rem;\n        }\n\n        .form-select, .form-control {\n            border: 2px solid #e0e0e0;\n            border-radius: 10px;\n            padding: 12px 15px;\n            transition: all 0.3s ease;\n            background-color: #fafafa;\n        }\n\n        .form-select:focus, .form-control:focus {\n            border-color: var(--accent-green);\n            box-shadow: 0 0 0 0.25rem rgba(67, 160, 71, 0.25);\n            background-color: #fff;\n        }\n\n        .btn-submit {\n            background: linear-gradient(135deg, var(--accent-green) 0%, var(--primary-green) 100%);\n            border: none;\n            color: white;\n            font-weight: 600;\n            padding: 12px 30px;\n            border-radius: 25px;\n            transition: all 0.3s ease;\n            width: 100%;\n            margin-top: 1rem;\n        }\n\n        .btn-submit:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 8px 20px rgba(67, 160, 71, 0.4);\n        }\n\n        .alert {\n            border-radius: 15px;\n            border: none;\n            padding: 1rem 1.5rem;\n        }\n\n        .alert-success {\n            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);\n            color: #155724;\n        }\n\n        .alert-danger {\n            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);\n            color: #721c24;\n        }\n\n        .warning-card {\n            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);\n            border: 1px solid #ffc107;\n            border-radius: 15px;\n            padding: 1.5rem;\n            margin-bottom: 2rem;\n        }\n\n        .existing-enrollment {\n            background: linear-gradient(135deg, #cce5ff 0%, #b3d9ff 100%);\n            border: 1px solid #007bff;\n            border-radius: 15px;\n            padding: 1.5rem;\n            margin-bottom: 2rem;\n        }\n    </style>\n</head>\n<body>\n    <!-- Navigation -->\n    <nav class=\"navbar navbar-expand-lg\">\n        <div class=\"container\">\n            <a class=\"navbar-brand d-flex align-items-center\" href=\"../student-dashboard.php\">\n                <img src=\"../../picture/tlgc_pic.jpg\" alt=\"School Logo\" class=\"school-logo\">\n                <span>Student Portal</span>\n            </a>\n            <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\">\n                <span class=\"navbar-toggler-icon\"></span>\n            </button>\n            <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\n                <ul class=\"navbar-nav ms-auto\">\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link\" href=\"../student-dashboard.php\">\n                            <i class=\"bi bi-arrow-left\"></i> Back to Dashboard\n                        </a>\n                    </li>\n                </ul>\n            </div>\n        </div>\n    </nav>\n\n    <div class=\"container\">\n        <div class=\"form-container\">\n            <h2 class=\"form-title\">\n                <i class=\"bi bi-journal-plus\"></i>\n                Enrollment Application Form\n            </h2>\n\n            <?php if ($existingEnrollment): ?>\n                <div class=\"existing-enrollment\">\n                    <h5><i class=\"bi bi-info-circle\"></i> Existing Enrollment Found</h5>\n                    <p><strong>Status:</strong> <?= ucfirst($existingEnrollment['status']) ?></p>\n                    <p><strong>Program:</strong> <?= htmlspecialchars($existingEnrollment['program']) ?></p>\n                    <p><strong>Year Level:</strong> <?= htmlspecialchars($existingEnrollment['year_level']) ?></p>\n                    <p><strong>Semester:</strong> <?= htmlspecialchars($existingEnrollment['semester']) ?></p>\n                    <?php if ($existingEnrollment['status'] === 'pending'): ?>\n                        <p class=\"text-warning mb-0\">You can update your enrollment details below.</p>\n                    <?php endif; ?>\n                </div>\n            <?php endif; ?>\n\n            <?php if ($success): ?>\n                <div class=\"alert alert-success\">\n                    <h5><i class=\"bi bi-check-circle\"></i> Enrollment Submitted Successfully!</h5>\n                    <p class=\"mb-0\">Your enrollment application has been submitted and is now pending review by the registrar.</p>\n                    <hr>\n                    <a href=\"../MyEnrollAssignUpload/enrollment-status.php\" class=\"btn btn-success btn-sm\">View Status</a>\n                    <a href=\"../student-dashboard.php\" class=\"btn btn-outline-success btn-sm\">Back to Dashboard</a>\n                </div>\n            <?php endif; ?>\n\n            <?php if (!empty($errors)): ?>\n                <div class=\"alert alert-danger\">\n                    <h6><i class=\"bi bi-exclamation-triangle\"></i> Please correct the following errors:</h6>\n                    <ul class=\"mb-0\">\n                        <?php foreach ($errors as $error): ?>\n                            <li><?= htmlspecialchars($error) ?></li>\n                        <?php endforeach; ?>\n                    </ul>\n                </div>\n            <?php endif; ?>\n\n            <?php if (!$success): ?>\n                <form method=\"POST\" action=\"\" id=\"enrollmentForm\">\n                    <div class=\"row\">\n                        <div class=\"col-md-6 mb-3\">\n                            <label for=\"program\" class=\"form-label\">\n                                <i class=\"bi bi-mortarboard\"></i> Program\n                            </label>\n                            <select class=\"form-select\" name=\"program\" id=\"program\" required>\n                                <option value=\"\">Select Program</option>\n                                <option value=\"Bachelor of Science in Information Technology\" <?= ($_POST['program'] ?? '') === 'Bachelor of Science in Information Technology' ? 'selected' : '' ?>>IT</option>\n                                <option value=\"Bachelor of Science in Computer Science\" <?= ($_POST['program'] ?? '') === 'Bachelor of Science in Computer Science' ? 'selected' : '' ?>>HRMT</option>\n                                <option value=\"Bachelor of Science in Business Administration\" <?= ($_POST['program'] ?? '') === 'Bachelor of Science in Business Administration' ? 'selected' : '' ?>>ECT</option>\n                                <option value=\"Bachelor of Science in Hospitality Management\" <?= ($_POST['program'] ?? '') === 'Bachelor of Science in Hospitality Management' ? 'selected' : '' ?>>HST</option>\n                                <option value=\"Bachelor of Science in Tourism Management\" <?= ($_POST['program'] ?? '') === 'Bachelor of Science in Tourism Management' ? 'selected' : '' ?>>ET</option>\n                                <option value=\"Associate in Computer Technology\" <?= ($_POST['program'] ?? '') === 'Associate in Computer Technology' ? 'selected' : '' ?>>TVET</option>\n                            </select>\n                        </div>\n\n                        <div class=\"col-md-6 mb-3\">\n                            <label for=\"year_level\" class=\"form-label\">\n                                <i class=\"bi bi-calendar3\"></i> Year Level\n                            </label>\n                            <select class=\"form-select\" name=\"year_level\" id=\"year_level\" required>\n                                <option value=\"\">Select Year Level</option>\n                                <option value=\"1st Year\" <?= ($_POST['year_level'] ?? '') === '1st Year' ? 'selected' : '' ?>>1st Year</option>\n                                <option value=\"2nd Year\" <?= ($_POST['year_level'] ?? '') === '2nd Year' ? 'selected' : '' ?>>2nd Year</option>\n                                <option value=\"3rd Year\" <?= ($_POST['year_level'] ?? '') === '3rd Year' ? 'selected' : '' ?>>3rd Year</option>\n                            </select>\n                        </div>\n                    </div>\n\n                    <div class=\"row\">\n                        <div class=\"col-md-6 mb-3\">\n                            <label for=\"semester\" class=\"form-label\">\n                                <i class=\"bi bi-calendar-week\"></i> Semester\n                            </label>\n                            <select class=\"form-select\" name=\"semester\" id=\"semester\" required>\n                                <option value=\"\">Select Semester</option>\n                                <option value=\"1st Semester\" <?= ($_POST['semester'] ?? '') === '1st Semester' ? 'selected' : '' ?>>1st Semester</option>\n                                <option value=\"2nd Semester\" <?= ($_POST['semester'] ?? '') === '2nd Semester' ? 'selected' : '' ?>>2nd Semester</option>\n                                <option value=\"Summer\" <?= ($_POST['semester'] ?? '') === 'Summer' ? 'selected' : '' ?>>Summer</option>\n                            </select>\n                        </div>\n\n                        <div class=\"col-md-6 mb-3\">\n                            <label for=\"section\" class=\"form-label\">\n                                <i class=\"bi bi-people\"></i> Section\n                            </label>\n                            <select class=\"form-select\" name=\"section\" id=\"section\" required>\n                                <option value=\"\">Select Section</option>\n                                <option value=\"A\" <?= ($_POST['section'] ?? '') === 'A' ? 'selected' : '' ?>>Section A</option>\n                                <option value=\"B\" <?= ($_POST['section'] ?? '') === 'B' ? 'selected' : '' ?>>Section B</option>\n                                <option value=\"C\" <?= ($_POST['section'] ?? '') === 'C' ? 'selected' : '' ?>>Section C</option>\n                                <option value=\"D\" <?= ($_POST['section'] ?? '') === 'D' ? 'selected' : '' ?>>Section D</option>\n                                <option value=\"E\" <?= ($_POST['section'] ?? '') === 'E' ? 'selected' : '' ?>>Section E</option>\n                                <option value=\"F\" <?= ($_POST['section'] ?? '') === 'F' ? 'selected' : '' ?>>Section E</option>\n                                <option value=\"G\" <?= ($_POST['section'] ?? '') === 'G' ? 'selected' : '' ?>>Section E</option>\n                            </select>\n                        </div>\n                    </div>\n\n                    <div class=\"mb-3\">\n                        <label for=\"school_year\" class=\"form-label\">\n                            <i class=\"bi bi-calendar-range\"></i> School Year\n                        </label>\n                        <input type=\"text\" class=\"form-control\" name=\"school_year\" id=\"school_year\" \n                               value=\"<?= $_POST['school_year'] ?? $defaultSchoolYear ?>\" \n                               placeholder=\"e.g., 2024-2025\" required>\n                    </div>\n\n                    <button type=\"submit\" class=\"btn-submit\">\n                        <i class=\"bi bi-send\"></i> Submit Enrollment Application\n                    </button>\n                </form>\n            <?php endif; ?>\n        </div>\n    </div>\n\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\n    <script>\n        // Form validation and enhancement\n        document.getElementById('enrollmentForm')?.addEventListener('submit', function(e) {\n            const requiredFields = ['program', 'year_level', 'semester', 'section', 'school_year'];\n            let isValid = true;\n\n            requiredFields.forEach(field => {\n                const element = document.getElementById(field);\n                if (!element.value.trim()) {\n                    element.classList.add('is-invalid');\n                    isValid = false;\n                } else {\n                    element.classList.remove('is-invalid');\n                }\n            });\n\n            if (!isValid) {\n                e.preventDefault();\n                alert('Please fill in all required fields.');\n            }\n        });\n\n        // Remove invalid class on input\n        document.querySelectorAll('.form-select, .form-control').forEach(element => {\n            element.addEventListener('change', function() {\n                this.classList.remove('is-invalid');\n            });\n        });\n    </script>\n</body>\n</html>\n"
        }
    ]
}