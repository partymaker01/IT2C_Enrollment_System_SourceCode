{
    "sourceFile": "student/history&Profile/Enrollment History.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1748594757158,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1748594757158,
            "name": "Commit-0",
            "content": "<?php\r\nsession_start();\r\n\r\n// Example: Assuming logged-in student ID stored in session\r\n$student_id = $_SESSION['student_id'] ?? 1; // Replace 1 with session value in real use\r\n\r\n// DB connection (edit your credentials here)\r\n$host = \"localhost\";\r\n$dbname = \"enrollment_system\";\r\n$user = \"root\";\r\n$pass = \"\"; // your db password\r\n\r\ntry {\r\n    $pdo = new PDO(\"mysql:host=$host;dbname=$dbname;charset=utf8mb4\", $user, $pass);\r\n    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n\r\n    // Get all enrollments of the student with subjects\r\n      $stmt = $pdo->prepare(\"\r\n    SELECT \r\n        e.id AS enrollment_id, \r\n        e.semester, \r\n        e.program, \r\n        e.year_level, \r\n        e.section, \r\n        e.date_submitted AS enrollment_date, \r\n        e.status,\r\n        s.subject_code AS subject_code, \r\n        s.subject_title AS title, \r\n        CONCAT(s.day, ' ', s.time, ' @ ', s.room) AS schedule, \r\n        s.units\r\n    FROM enrollments e\r\n    LEFT JOIN enrollment_subjects es ON e.id = es.enrollment_id\r\n    LEFT JOIN subjects s ON es.subject_code = s.subject_code\r\n    WHERE e.student_id = ?\r\n    ORDER BY e.date_submitted DESC, s.subject_title ASC\r\n\");\r\n\r\n    $stmt->execute([$student_id]);\r\n    $rows = $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n\r\n    // Organize data to group subjects under each enrollment\r\n    $enrollments = [];\r\n      foreach ($rows as $row) {\r\n          $eid = $row['enrollment_id']; // âœ… Ito ang tamang pwesto\r\n\r\n          if (!isset($enrollments[$eid])) {\r\n              $enrollments[$eid] = [\r\n                  'semester' => $row['semester'],\r\n                  'program' => $row['program'],\r\n                  'year' => $row['year_level'],\r\n                  'section' => $row['section'],\r\n                  'date' => date(\"F j, Y\", strtotime($row['enrollment_date'])),\r\n                  'status' => $row['status'],\r\n                  'subjects' => []\r\n              ];\r\n          }\r\n\r\n          if ($row['subject_code']) {\r\n              $enrollments[$eid]['subjects'][] = [\r\n                  'code' => $row['subject_code'],\r\n                  'title' => $row['title'],\r\n                  'schedule' => $row['schedule'],\r\n                  'units' => $row['units']\r\n              ];\r\n          }\r\n      }\r\n\r\n} catch (PDOException $e) {\r\n    die(\"Database connection failed: \" . $e->getMessage());\r\n}\r\n?>\r\n\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n  <meta charset=\"UTF-8\" />\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\r\n  <title>Enrollment History</title>\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\" />\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css\" rel=\"stylesheet\">\r\n  <link rel=\"icon\" href=\"favicon.ico\" type=\"image/x-icon\">\r\n  <style>\r\n    body { background-color: #e8f5e9; }\r\n    .accordion-button:focus { box-shadow: none; }\r\n    .badge-approved { background-color: #43a047; }\r\n    .badge-pending { background-color: #fbc02d; color: black; }\r\n    .badge-rejected { background-color: #e53935; }\r\n    .table th, .table td { vertical-align: middle; }\r\n    .navbar {\r\n      background-color: #2e7d32;\r\n    }\r\n    .navbar-brand, .nav-link {\r\n      color: #fff !important;\r\n      font-weight: 600;\r\n      letter-spacing: 0.05em;\r\n    }\r\n    .nav-link:hover {\r\n      color: #c8e6c9 !important;\r\n    }\r\n  </style>\r\n</head>\r\n<body>\r\n  <nav class=\"navbar navbar-expand-lg\">\r\n    <div class=\"container\">\r\n      <a class=\"navbar-brand\" href=\"/IT2C_Enrollment_System_SourceCode/student/student-dashboard.php\">\r\n        Student Dashboard\r\n      </a>\r\n      <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\" aria-controls=\"navbarNav\" aria-expanded=\"false\" aria-label=\"Toggle navigation\">\r\n        <span class=\"navbar-toggler-icon\"></span>\r\n      </button>\r\n      <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\r\n        <ul class=\"navbar-nav ms-auto\">\r\n          <li class=\"nav-item\"><a class=\"nav-link\" href=\"/IT2C_Enrollment_System_SourceCode/student/student-dashboard.php\"><i class=\"bi bi-arrow-left\"></i> Back to Dashboard</a></li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  </nav>\r\n  <div class=\"container my-5\">\r\n    <h2 class=\"text-success mb-4\"><i class=\"bi bi-clock-history me-2\"></i> Enrollment History </h2>\r\n\r\n    <div class=\"accordion\" id=\"historyAccordion\">\r\n      <?php if(empty($enrollments)): ?>\r\n        <p>No enrollment records found.</p>\r\n      <?php else: ?>\r\n        <?php foreach ($enrollments as $index => $entry): ?>\r\n          <div class=\"accordion-item\">\r\n            <h2 class=\"accordion-header\" id=\"heading<?= $index ?>\">\r\n              <button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#collapse<?= $index ?>\" aria-expanded=\"false\" aria-controls=\"collapse<?= $index ?>\">\r\n                Semester: <?= htmlspecialchars($entry['semester']) ?>\r\n              </button>\r\n            </h2>\r\n            <div id=\"collapse<?= $index ?>\" class=\"accordion-collapse collapse\" aria-labelledby=\"heading<?= $index ?>\" data-bs-parent=\"#historyAccordion\">\r\n              <div class=\"accordion-body\">\r\n                <p><strong>Program:</strong> <?= htmlspecialchars($entry['program']) ?></p>\r\n                <p><strong>Year Level:</strong> <?= htmlspecialchars($entry['year']) ?></p>\r\n                <p><strong>Section:</strong> <?= htmlspecialchars($entry['section']) ?></p>\r\n                <p><strong>Enrollment Date:</strong> <?= htmlspecialchars($entry['date']) ?></p>\r\n                <p><strong>Status:</strong> \r\n                  <span class=\"badge <?= $entry['status'] === 'Approved' ? 'badge-approved' : ($entry['status'] === 'Pending' ? 'badge-pending' : 'badge-rejected') ?>\">\r\n                    <?= htmlspecialchars($entry['status']) ?>\r\n                  </span>\r\n                </p>\r\n\r\n                <h5 class=\"mt-4\">Subjects Enrolled</h5>\r\n                <div class=\"table-responsive\">\r\n                  <table class=\"table table-striped\">\r\n                    <thead class=\"table-success\">\r\n                      <tr>\r\n                        <th>Subject Code</th>\r\n                        <th>Subject Title</th>\r\n                        <th>Schedule</th>\r\n                        <th>Units</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                      <?php foreach ($entry['subjects'] as $subject): ?>\r\n                        <tr>\r\n                          <td><?= htmlspecialchars($subject['code']) ?></td>\r\n                          <td><?= htmlspecialchars($subject['title']) ?></td>\r\n                          <td><?= htmlspecialchars($subject['schedule']) ?></td>\r\n                          <td><?= htmlspecialchars($subject['units']) ?></td>\r\n                        </tr>\r\n                      <?php endforeach; ?>\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n\r\n                <form action=\"download-slip.php\" method=\"post\" target=\"_blank\">\r\n                  <input type=\"hidden\" name=\"enrollment_id\" value=\"<?= $index ?>\">\r\n                  <input type=\"hidden\" name=\"data\" value=\"<?= htmlspecialchars(json_encode($entry), ENT_QUOTES, 'UTF-8') ?>\">\r\n                  <button type=\"submit\" class=\"btn btn-success mt-3\">\r\n                    <i class=\"bi bi-download me-1\"></i> Download Enrollment Slip\r\n                  </button>\r\n                </form>\r\n\r\n                <a href=\"#\" class=\"btn btn-success mt-3\"><i class=\"bi bi-download me-1\"></i> Download Enrollment Slip</a>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        <?php endforeach; ?>\r\n      <?php endif; ?>\r\n    </div>\r\n  </div>\r\n\r\n  <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\r\n</body>\r\n</html>"
        }
    ]
}