{
    "sourceFile": "student/history&Profile/Edit Profile.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1748592541929,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1748594783821,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,31 +1,29 @@\n <?php\r\n session_start();\r\n \r\n-// Replace with your actual DB credentials\r\n+// DB connection\r\n $host = 'localhost';\r\n $dbname = 'enrollment_system';\r\n $username = 'root';\r\n $password = '';\r\n \r\n-// Connect to database using PDO\r\n try {\r\n     $pdo = new PDO(\"mysql:host=$host;dbname=$dbname;charset=utf8mb4\", $username, $password);\r\n     $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n } catch (Exception $e) {\r\n     die(\"Database connection failed: \" . $e->getMessage());\r\n }\r\n \r\n-// Assume student is logged in and we have student ID in session\r\n if (!isset($_SESSION['student_id'])) {\r\n     die(\"You must be logged in to access this page.\");\r\n }\r\n \r\n $student_id = $_SESSION['student_id'];\r\n $errors = [];\r\n $success = \"\";\r\n \r\n-// Fetch current student data\r\n+// Fetch student record\r\n $stmt = $pdo->prepare(\"SELECT * FROM students WHERE id = ?\");\r\n $stmt->execute([$student_id]);\r\n $student = $stmt->fetch(PDO::FETCH_ASSOC);\r\n \r\n@@ -39,9 +37,9 @@\n     $gender = $_POST['gender'] ?? '';\r\n     $contactNumber = trim($_POST['contact_number'] ?? '');\r\n     $email = trim($_POST['email'] ?? '');\r\n     $address = trim($_POST['address'] ?? '');\r\n-    $profilePicturePath = $student['profile_picture']; // Default to existing pic\r\n+    $profilePicturePath = $student['profile_picture'] ?? 'uploads/default.png';\r\n \r\n     // Validation\r\n     if ($fullName === '') $errors[] = \"Full Name is required.\";\r\n     if ($dob === '') $errors[] = \"Date of Birth is required.\";\r\n@@ -49,16 +47,14 @@\n     if ($contactNumber === '') $errors[] = \"Contact Number is required.\";\r\n     if ($email === '' || !filter_var($email, FILTER_VALIDATE_EMAIL)) $errors[] = \"Valid Email is required.\";\r\n     if ($address === '') $errors[] = \"Address is required.\";\r\n \r\n-    // Check if email already exists for other students\r\n     $stmt = $pdo->prepare(\"SELECT id FROM students WHERE email = ? AND id != ?\");\r\n     $stmt->execute([$email, $student_id]);\r\n     if ($stmt->fetch()) {\r\n         $errors[] = \"Email is already taken by another user.\";\r\n     }\r\n \r\n-    // Profile picture upload handling\r\n     if (isset($_FILES['profile_picture']) && $_FILES['profile_picture']['error'] === UPLOAD_ERR_OK) {\r\n         $allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];\r\n         if (!in_array($_FILES['profile_picture']['type'], $allowedTypes)) {\r\n             $errors[] = 'Only JPG, PNG, and GIF images are allowed for the profile picture.';\r\n@@ -78,9 +74,8 @@\n             }\r\n         }\r\n     }\r\n \r\n-    // If no errors, update the record\r\n     if (empty($errors)) {\r\n         $stmt = $pdo->prepare(\"UPDATE students SET full_name = ?, dob = ?, gender = ?, contact_number = ?, email = ?, address = ?, profile_picture = ? WHERE id = ?\");\r\n         $stmt->execute([\r\n             $fullName,\r\n@@ -93,9 +88,8 @@\n             $student_id\r\n         ]);\r\n         $success = \"Profile updated successfully!\";\r\n \r\n-        // Refresh student data from DB after update\r\n         $stmt = $pdo->prepare(\"SELECT * FROM students WHERE id = ?\");\r\n         $stmt->execute([$student_id]);\r\n         $student = $stmt->fetch(PDO::FETCH_ASSOC);\r\n     }\r\n@@ -138,11 +132,9 @@\n </head>\r\n <body>\r\n   <nav class=\"navbar navbar-expand-lg\">\r\n     <div class=\"container\">\r\n-      <a class=\"navbar-brand\" href=\"/IT2C_Enrollment_System_SourceCode/student/student-dashboard.php\">\r\n-        Student Dashboard\r\n-      </a>\r\n+      <a class=\"navbar-brand\" href=\"/IT2C_Enrollment_System_SourceCode/student/student-dashboard.php\">Student Dashboard</a>\r\n       <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\"\r\n         aria-controls=\"navbarNav\" aria-expanded=\"false\" aria-label=\"Toggle navigation\">\r\n         <span class=\"navbar-toggler-icon\"></span>\r\n       </button>\r\n@@ -175,9 +167,9 @@\n       class=\"bg-white p-4 rounded shadow-sm mx-auto\" style=\"max-width: 600px;\">\r\n       \r\n       <div class=\"mb-4 text-center\">\r\n         <label for=\"profilePicture\">\r\n-          <img src=\"<?= htmlspecialchars($student['profile_picture'] ?: 'uploads/default.png') ?>\" alt=\"Profile Picture\"\r\n+          <img src=\"<?= htmlspecialchars($student['profile_picture'] ?? 'uploads/default.png') ?>\" alt=\"Profile Picture\"\r\n             class=\"profile-img mb-3\" id=\"profilePreview\" title=\"Click to change profile picture\" />\r\n         </label>\r\n         <input type=\"file\" id=\"profilePicture\" name=\"profile_picture\" accept=\"image/*\" class=\"d-none\"\r\n           onchange=\"previewProfilePic(event)\" />\r\n@@ -185,43 +177,43 @@\n \r\n       <div class=\"mb-3\">\r\n         <label for=\"fullName\" class=\"form-label\">Full Name</label>\r\n         <input type=\"text\" class=\"form-control\" id=\"fullName\" name=\"full_name\" required\r\n-          value=\"<?= htmlspecialchars($student['full_name']) ?>\" />\r\n+          value=\"<?= htmlspecialchars($student['full_name'] ?? '') ?>\" />\r\n       </div>\r\n \r\n       <div class=\"mb-3\">\r\n         <label for=\"dob\" class=\"form-label\">Date of Birth</label>\r\n         <input type=\"date\" class=\"form-control\" id=\"dob\" name=\"dob\" required\r\n-          value=\"<?= htmlspecialchars($student['dob']) ?>\" />\r\n+          value=\"<?= htmlspecialchars($student['dob'] ?? '') ?>\" />\r\n       </div>\r\n \r\n       <div class=\"mb-3\">\r\n         <label for=\"gender\" class=\"form-label\">Gender</label>\r\n         <select class=\"form-select\" id=\"gender\" name=\"gender\" required>\r\n-          <option value=\"\" <?= $student['gender'] == '' ? 'selected' : '' ?>>Select Gender</option>\r\n-          <option value=\"Male\" <?= $student['gender'] == 'Male' ? 'selected' : '' ?>>Male</option>\r\n-          <option value=\"Female\" <?= $student['gender'] == 'Female' ? 'selected' : '' ?>>Female</option>\r\n-          <option value=\"Other\" <?= $student['gender'] == 'Other' ? 'selected' : '' ?>>Other</option>\r\n+          <option value=\"\" <?= ($student['gender'] ?? '') == '' ? 'selected' : '' ?>>Select Gender</option>\r\n+          <option value=\"Male\" <?= ($student['gender'] ?? '') == 'Male' ? 'selected' : '' ?>>Male</option>\r\n+          <option value=\"Female\" <?= ($student['gender'] ?? '') == 'Female' ? 'selected' : '' ?>>Female</option>\r\n+          <option value=\"Other\" <?= ($student['gender'] ?? '') == 'Other' ? 'selected' : '' ?>>Other</option>\r\n         </select>\r\n       </div>\r\n \r\n       <div class=\"mb-3\">\r\n         <label for=\"contact\" class=\"form-label\">Contact Number</label>\r\n         <input type=\"tel\" class=\"form-control\" id=\"contact\" name=\"contact_number\" required\r\n-          value=\"<?= htmlspecialchars($student['contact_number']) ?>\" />\r\n+          value=\"<?= htmlspecialchars($student['contact_number'] ?? '') ?>\" />\r\n       </div>\r\n \r\n       <div class=\"mb-3\">\r\n         <label for=\"email\" class=\"form-label\">Email Address</label>\r\n         <input type=\"email\" class=\"form-control\" id=\"email\" name=\"email\" required\r\n-          value=\"<?= htmlspecialchars($student['email']) ?>\" />\r\n+          value=\"<?= htmlspecialchars($student['email'] ?? '') ?>\" />\r\n       </div>\r\n \r\n       <div class=\"mb-3\">\r\n         <label for=\"address\" class=\"form-label\">Address</label>\r\n         <textarea class=\"form-control\" id=\"address\" name=\"address\" rows=\"3\"\r\n-          required><?= htmlspecialchars($student['address']) ?></textarea>\r\n+          required><?= htmlspecialchars($student['address'] ?? '') ?></textarea>\r\n       </div>\r\n \r\n       <button type=\"submit\" class=\"btn btn-success w-100\">Save Changes</button>\r\n     </form>\r\n@@ -238,5 +230,5 @@\n   </script>\r\n \r\n   <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\r\n </body>\r\n-</html>\r\n+</html>\n\\ No newline at end of file\n"
                }
            ],
            "date": 1748592541929,
            "name": "Commit-0",
            "content": "<?php\r\nsession_start();\r\n\r\n// Replace with your actual DB credentials\r\n$host = 'localhost';\r\n$dbname = 'enrollment_system';\r\n$username = 'root';\r\n$password = '';\r\n\r\n// Connect to database using PDO\r\ntry {\r\n    $pdo = new PDO(\"mysql:host=$host;dbname=$dbname;charset=utf8mb4\", $username, $password);\r\n    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n} catch (Exception $e) {\r\n    die(\"Database connection failed: \" . $e->getMessage());\r\n}\r\n\r\n// Assume student is logged in and we have student ID in session\r\nif (!isset($_SESSION['student_id'])) {\r\n    die(\"You must be logged in to access this page.\");\r\n}\r\n\r\n$student_id = $_SESSION['student_id'];\r\n$errors = [];\r\n$success = \"\";\r\n\r\n// Fetch current student data\r\n$stmt = $pdo->prepare(\"SELECT * FROM students WHERE id = ?\");\r\n$stmt->execute([$student_id]);\r\n$student = $stmt->fetch(PDO::FETCH_ASSOC);\r\n\r\nif (!$student) {\r\n    die(\"Student record not found.\");\r\n}\r\n\r\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\r\n    $fullName = trim($_POST['full_name'] ?? '');\r\n    $dob = $_POST['dob'] ?? '';\r\n    $gender = $_POST['gender'] ?? '';\r\n    $contactNumber = trim($_POST['contact_number'] ?? '');\r\n    $email = trim($_POST['email'] ?? '');\r\n    $address = trim($_POST['address'] ?? '');\r\n    $profilePicturePath = $student['profile_picture']; // Default to existing pic\r\n\r\n    // Validation\r\n    if ($fullName === '') $errors[] = \"Full Name is required.\";\r\n    if ($dob === '') $errors[] = \"Date of Birth is required.\";\r\n    if (!in_array($gender, ['Male', 'Female', 'Other'])) $errors[] = \"Please select a valid Gender.\";\r\n    if ($contactNumber === '') $errors[] = \"Contact Number is required.\";\r\n    if ($email === '' || !filter_var($email, FILTER_VALIDATE_EMAIL)) $errors[] = \"Valid Email is required.\";\r\n    if ($address === '') $errors[] = \"Address is required.\";\r\n\r\n    // Check if email already exists for other students\r\n    $stmt = $pdo->prepare(\"SELECT id FROM students WHERE email = ? AND id != ?\");\r\n    $stmt->execute([$email, $student_id]);\r\n    if ($stmt->fetch()) {\r\n        $errors[] = \"Email is already taken by another user.\";\r\n    }\r\n\r\n    // Profile picture upload handling\r\n    if (isset($_FILES['profile_picture']) && $_FILES['profile_picture']['error'] === UPLOAD_ERR_OK) {\r\n        $allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];\r\n        if (!in_array($_FILES['profile_picture']['type'], $allowedTypes)) {\r\n            $errors[] = 'Only JPG, PNG, and GIF images are allowed for the profile picture.';\r\n        } else {\r\n            $uploadDir = 'uploads/';\r\n            if (!is_dir($uploadDir)) {\r\n                mkdir($uploadDir, 0755, true);\r\n            }\r\n            $ext = pathinfo($_FILES['profile_picture']['name'], PATHINFO_EXTENSION);\r\n            $newFileName = 'profile_' . $student_id . '.' . $ext;\r\n            $targetFile = $uploadDir . $newFileName;\r\n\r\n            if (move_uploaded_file($_FILES['profile_picture']['tmp_name'], $targetFile)) {\r\n                $profilePicturePath = $targetFile;\r\n            } else {\r\n                $errors[] = 'Failed to upload profile picture.';\r\n            }\r\n        }\r\n    }\r\n\r\n    // If no errors, update the record\r\n    if (empty($errors)) {\r\n        $stmt = $pdo->prepare(\"UPDATE students SET full_name = ?, dob = ?, gender = ?, contact_number = ?, email = ?, address = ?, profile_picture = ? WHERE id = ?\");\r\n        $stmt->execute([\r\n            $fullName,\r\n            $dob,\r\n            $gender,\r\n            $contactNumber,\r\n            $email,\r\n            $address,\r\n            $profilePicturePath,\r\n            $student_id\r\n        ]);\r\n        $success = \"Profile updated successfully!\";\r\n\r\n        // Refresh student data from DB after update\r\n        $stmt = $pdo->prepare(\"SELECT * FROM students WHERE id = ?\");\r\n        $stmt->execute([$student_id]);\r\n        $student = $stmt->fetch(PDO::FETCH_ASSOC);\r\n    }\r\n}\r\n?>\r\n\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n  <meta charset=\"UTF-8\" />\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\r\n  <title>Edit Profile</title>\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\" />\r\n  <link rel=\"icon\" href=\"favicon.ico\" type=\"image/x-icon\">\r\n  <style>\r\n    body {\r\n      background-color: #e8f5e9;\r\n      min-height: 100vh;\r\n    }\r\n    .navbar {\r\n      background-color: #2e7d32;\r\n    }\r\n    .navbar-brand, .nav-link {\r\n      color: #fff !important;\r\n      font-weight: 600;\r\n      letter-spacing: 0.05em;\r\n    }\r\n    .nav-link:hover {\r\n      color: #c8e6c9 !important;\r\n    }\r\n    .profile-img {\r\n      width: 120px;\r\n      height: 120px;\r\n      object-fit: cover;\r\n      border-radius: 50%;\r\n      border: 3px solid #43a047;\r\n      cursor: pointer;\r\n    }\r\n  </style>\r\n</head>\r\n<body>\r\n  <nav class=\"navbar navbar-expand-lg\">\r\n    <div class=\"container\">\r\n      <a class=\"navbar-brand\" href=\"/IT2C_Enrollment_System_SourceCode/student/student-dashboard.php\">\r\n        Student Dashboard\r\n      </a>\r\n      <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\"\r\n        aria-controls=\"navbarNav\" aria-expanded=\"false\" aria-label=\"Toggle navigation\">\r\n        <span class=\"navbar-toggler-icon\"></span>\r\n      </button>\r\n      <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\r\n        <ul class=\"navbar-nav ms-auto\">\r\n          <li class=\"nav-item\"><a class=\"nav-link\" href=\"/IT2C_Enrollment_System_SourceCode/student/student-dashboard.php\">\r\n            <i class=\"bi bi-arrow-left\"></i> Back to Dashboard\r\n          </a></li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  </nav>\r\n\r\n  <div class=\"container my-5\">\r\n    <h2 class=\"text-success mb-4 text-center\">Edit Profile</h2>\r\n\r\n    <?php if ($errors): ?>\r\n      <div class=\"alert alert-danger\">\r\n        <ul class=\"mb-0\">\r\n          <?php foreach ($errors as $error) echo \"<li>\" . htmlspecialchars($error) . \"</li>\"; ?>\r\n        </ul>\r\n      </div>\r\n    <?php endif; ?>\r\n\r\n    <?php if ($success): ?>\r\n      <div class=\"alert alert-success\"><?= htmlspecialchars($success) ?></div>\r\n    <?php endif; ?>\r\n\r\n    <form action=\"\" method=\"POST\" enctype=\"multipart/form-data\"\r\n      class=\"bg-white p-4 rounded shadow-sm mx-auto\" style=\"max-width: 600px;\">\r\n      \r\n      <div class=\"mb-4 text-center\">\r\n        <label for=\"profilePicture\">\r\n          <img src=\"<?= htmlspecialchars($student['profile_picture'] ?: 'uploads/default.png') ?>\" alt=\"Profile Picture\"\r\n            class=\"profile-img mb-3\" id=\"profilePreview\" title=\"Click to change profile picture\" />\r\n        </label>\r\n        <input type=\"file\" id=\"profilePicture\" name=\"profile_picture\" accept=\"image/*\" class=\"d-none\"\r\n          onchange=\"previewProfilePic(event)\" />\r\n      </div>\r\n\r\n      <div class=\"mb-3\">\r\n        <label for=\"fullName\" class=\"form-label\">Full Name</label>\r\n        <input type=\"text\" class=\"form-control\" id=\"fullName\" name=\"full_name\" required\r\n          value=\"<?= htmlspecialchars($student['full_name']) ?>\" />\r\n      </div>\r\n\r\n      <div class=\"mb-3\">\r\n        <label for=\"dob\" class=\"form-label\">Date of Birth</label>\r\n        <input type=\"date\" class=\"form-control\" id=\"dob\" name=\"dob\" required\r\n          value=\"<?= htmlspecialchars($student['dob']) ?>\" />\r\n      </div>\r\n\r\n      <div class=\"mb-3\">\r\n        <label for=\"gender\" class=\"form-label\">Gender</label>\r\n        <select class=\"form-select\" id=\"gender\" name=\"gender\" required>\r\n          <option value=\"\" <?= $student['gender'] == '' ? 'selected' : '' ?>>Select Gender</option>\r\n          <option value=\"Male\" <?= $student['gender'] == 'Male' ? 'selected' : '' ?>>Male</option>\r\n          <option value=\"Female\" <?= $student['gender'] == 'Female' ? 'selected' : '' ?>>Female</option>\r\n          <option value=\"Other\" <?= $student['gender'] == 'Other' ? 'selected' : '' ?>>Other</option>\r\n        </select>\r\n      </div>\r\n\r\n      <div class=\"mb-3\">\r\n        <label for=\"contact\" class=\"form-label\">Contact Number</label>\r\n        <input type=\"tel\" class=\"form-control\" id=\"contact\" name=\"contact_number\" required\r\n          value=\"<?= htmlspecialchars($student['contact_number']) ?>\" />\r\n      </div>\r\n\r\n      <div class=\"mb-3\">\r\n        <label for=\"email\" class=\"form-label\">Email Address</label>\r\n        <input type=\"email\" class=\"form-control\" id=\"email\" name=\"email\" required\r\n          value=\"<?= htmlspecialchars($student['email']) ?>\" />\r\n      </div>\r\n\r\n      <div class=\"mb-3\">\r\n        <label for=\"address\" class=\"form-label\">Address</label>\r\n        <textarea class=\"form-control\" id=\"address\" name=\"address\" rows=\"3\"\r\n          required><?= htmlspecialchars($student['address']) ?></textarea>\r\n      </div>\r\n\r\n      <button type=\"submit\" class=\"btn btn-success w-100\">Save Changes</button>\r\n    </form>\r\n  </div>\r\n\r\n  <script>\r\n    function previewProfilePic(event) {\r\n      const reader = new FileReader();\r\n      reader.onload = function () {\r\n        document.getElementById('profilePreview').src = reader.result;\r\n      };\r\n      reader.readAsDataURL(event.target.files[0]);\r\n    }\r\n  </script>\r\n\r\n  <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\r\n</body>\r\n</html>\r\n"
        }
    ]
}