{
    "sourceFile": "ADMIN/Enrollment_Management/generate-student-id.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1749397708971,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1749397801466,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,14 +8,14 @@\n     $year = date('y');\r\n     \r\n     // Map programs to their abbreviations\r\n     $programCodes = [\r\n-        'Bachelor of Science in Information Technology' => 'IT',\r\n-        'Bachelor of Science in Computer Science' => 'CS', \r\n-        'Bachelor of Science in Business Administration' => 'BA',\r\n-        'Bachelor of Science in Hospitality Management' => 'HRMT',\r\n-        'Bachelor of Science in Tourism Management' => 'TM',\r\n-        'Associate in Computer Technology' => 'ACT',\r\n+        'Information Technology' => 'IT',\r\n+        'Computer Science' => 'HRMT', \r\n+        'in Business Administration' => 'BA',\r\n+        'Hospitality Management' => 'HRMT',\r\n+        'Tourism Management' => 'TM',\r\n+        '' => 'ACT',\r\n         // Add more programs as needed\r\n         'ECT' => 'ECT',\r\n         'HST' => 'HST',\r\n         'TVET' => 'TVET'\r\n"
                },
                {
                    "date": 1749397973550,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,12 +9,12 @@\n     \r\n     // Map programs to their abbreviations\r\n     $programCodes = [\r\n         'Information Technology' => 'IT',\r\n-        'Computer Science' => 'HRMT', \r\n-        'in Business Administration' => 'BA',\r\n-        'Hospitality Management' => 'HRMT',\r\n-        'Tourism Management' => 'TM',\r\n+        'hospital and restaurant management technology' => 'HRMT', \r\n+        'in Business Administration' => 'ECT',\r\n+        'Hospitality Management' => 'HST',\r\n+        'Tourism Management' => 'TVET',\r\n         '' => 'ACT',\r\n         // Add more programs as needed\r\n         'ECT' => 'ECT',\r\n         'HST' => 'HST',\r\n"
                },
                {
                    "date": 1749398022688,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,9 +10,9 @@\n     // Map programs to their abbreviations\r\n     $programCodes = [\r\n         'Information Technology' => 'IT',\r\n         'hospital and restaurant management technology' => 'HRMT', \r\n-        'in Business Administration' => 'ECT',\r\n+        'electronics and computer technology' => 'ECT',\r\n         'Hospitality Management' => 'HST',\r\n         'Tourism Management' => 'TVET',\r\n         '' => 'ACT',\r\n         // Add more programs as needed\r\n"
                },
                {
                    "date": 1749398569648,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,17 +9,13 @@\n     \r\n     // Map programs to their abbreviations\r\n     $programCodes = [\r\n         'Information Technology' => 'IT',\r\n-        'hospital and restaurant management technology' => 'HRMT', \r\n-        'electronics and computer technology' => 'ECT',\r\n-        'Hospitality Management' => 'HST',\r\n-        'Tourism Management' => 'TVET',\r\n-        '' => 'ACT',\r\n-        // Add more programs as needed\r\n-        'ECT' => 'ECT',\r\n-        'HST' => 'HST',\r\n-        'TVET' => 'TVET'\r\n+        'Hospital and Restaurant Management Technology' => 'HRMT', \r\n+        'Electronics and Computer Technology' => 'ECT',\r\n+        'Hospitality Services technology' => 'HST',\r\n+        'Techncal Vocational Education Techonlogy' => 'TVET',\r\n+        'Enterpreneurship Technology' => 'ET',\r\n     ];\r\n     \r\n     // Get program code\r\n     $programCode = $programCodes[$program] ?? 'GEN'; // Default to 'GEN' if not found\r\n"
                }
            ],
            "date": 1749397708971,
            "name": "Commit-0",
            "content": "<?php\r\n// Helper file para sa student ID generation\r\n// I-save mo ito sa same folder ng process-enrollment.php\r\n\r\n// Function to generate student ID based on program\r\nfunction generateStudentId($conn, $program) {\r\n    // Get current year (last 2 digits)\r\n    $year = date('y');\r\n    \r\n    // Map programs to their abbreviations\r\n    $programCodes = [\r\n        'Bachelor of Science in Information Technology' => 'IT',\r\n        'Bachelor of Science in Computer Science' => 'CS', \r\n        'Bachelor of Science in Business Administration' => 'BA',\r\n        'Bachelor of Science in Hospitality Management' => 'HRMT',\r\n        'Bachelor of Science in Tourism Management' => 'TM',\r\n        'Associate in Computer Technology' => 'ACT',\r\n        // Add more programs as needed\r\n        'ECT' => 'ECT',\r\n        'HST' => 'HST',\r\n        'TVET' => 'TVET'\r\n    ];\r\n    \r\n    // Get program code\r\n    $programCode = $programCodes[$program] ?? 'GEN'; // Default to 'GEN' if not found\r\n    \r\n    // Create the base pattern\r\n    $basePattern = \"TLGC-{$programCode}-{$year}-\";\r\n    \r\n    // Get the highest existing number for this pattern\r\n    $stmt = $conn->prepare(\"\r\n        SELECT student_id \r\n        FROM students \r\n        WHERE student_id LIKE ? \r\n        ORDER BY student_id DESC \r\n        LIMIT 1\r\n    \");\r\n    $stmt->bind_param(\"s\", $basePattern . '%');\r\n    $stmt->execute();\r\n    $result = $stmt->get_result();\r\n    $lastId = $result->fetch_column();\r\n    \r\n    if ($lastId) {\r\n        // Extract the number part and increment\r\n        $lastNumber = intval(substr($lastId, -4));\r\n        $newNumber = $lastNumber + 1;\r\n    } else {\r\n        // First student for this program/year\r\n        $newNumber = 1;\r\n    }\r\n    \r\n    // Format with leading zeros\r\n    $formattedNumber = str_pad($newNumber, 4, '0', STR_PAD_LEFT);\r\n    \r\n    return $basePattern . $formattedNumber;\r\n}\r\n\r\n// Function to update student ID\r\nfunction updateStudentId($conn, $oldStudentId, $newStudentId) {\r\n    try {\r\n        $conn->begin_transaction();\r\n        \r\n        // Update students table\r\n        $stmt = $conn->prepare(\"UPDATE students SET student_id = ? WHERE student_id = ?\");\r\n        $stmt->bind_param(\"ss\", $newStudentId, $oldStudentId);\r\n        $stmt->execute();\r\n        \r\n        // Update enrollments table\r\n        $stmt = $conn->prepare(\"UPDATE enrollments SET student_id = ? WHERE student_id = ?\");\r\n        $stmt->bind_param(\"ss\", $newStudentId, $oldStudentId);\r\n        $stmt->execute();\r\n        \r\n        // Update student_subjects table if it exists\r\n        $stmt = $conn->prepare(\"UPDATE student_subjects SET student_id = ? WHERE student_id = ?\");\r\n        $stmt->bind_param(\"ss\", $newStudentId, $oldStudentId);\r\n        $stmt->execute();\r\n        \r\n        $conn->commit();\r\n        return true;\r\n    } catch (Exception $e) {\r\n        $conn->rollback();\r\n        return false;\r\n    }\r\n}\r\n?>\r\n"
        }
    ]
}