{
    "sourceFile": "ADMIN/helpdeskAdminProfileSettings/profile.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1749402271155,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1749402271155,
            "name": "Commit-0",
            "content": "<?php\nsession_start();\n\n// Check if logged in\nif (!isset($_SESSION['admin_logged_in']) || $_SESSION['admin_logged_in'] !== true) {\n    header(\"Location: ../../logregfor/admin-login.php\");\n    exit();\n}\n\n// DB Connection parameters\ninclude '../../db.php';\n\n// Initialize variables\n$profileData = [\n    \"id\" => $_SESSION['admin_id'],\n    \"name\" => $_SESSION['admin_name'] ?? \"\",\n    \"email\" => \"\",\n    \"image\" => \"../../img/default_admin.png\"\n];\n\n// Fetch admin profile from DB\n$stmt = $pdo->prepare(\"SELECT * FROM admin_settings WHERE id = ?\");\n$stmt->execute([$profileData['id']]);\n$admin = $stmt->fetch();\n\nif ($admin) {\n    $profileData = [\n        \"id\" => $admin['id'],\n        \"name\" => $admin['name'],\n        \"email\" => $admin['email'],\n        \"image\" => $admin['image'] ?? \"../../img/default_admin.png\"\n    ];\n}\n\n$success = false;\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    $name = trim($_POST['adminName']);\n    $email = trim($_POST['adminEmail']);\n    \n    // Handle profile picture upload\n    if (isset($_FILES['profilePic']) && $_FILES['profilePic']['error'] === 0) {\n        // Create directory if it doesn't exist\n        $uploadDir = '../../img/';\n        if (!is_dir($uploadDir)) {\n            mkdir($uploadDir, 0755, true);\n        }\n        \n        $ext = strtolower(pathinfo($_FILES['profilePic']['name'], PATHINFO_EXTENSION));\n        $allowed = ['jpg', 'jpeg', 'png', 'gif'];\n        if (in_array($ext, $allowed)) {\n            $filename = $uploadDir . 'admin_profile_' . time() . '.' . $ext;\n            if (move_uploaded_file($_FILES['profilePic']['tmp_name'], $filename)) {\n                $profileData['image'] = $filename;\n            }\n        }\n    }\n\n    // Update database\n    $sql = \"UPDATE admin_settings SET name = ?, email = ?, image = ? WHERE id = ?\";\n    $stmt = $pdo->prepare($sql);\n    $stmt->execute([$name, $email, $profileData['image'], $profileData['id']]);\n\n    // Update session\n    $_SESSION['admin_name'] = $name;\n    \n    $success = true;\n\n    // Reload updated data\n    $stmt = $pdo->prepare(\"SELECT * FROM admin_settings WHERE id = ?\");\n    $stmt->execute([$profileData['id']]);\n    $admin = $stmt->fetch();\n    \n    if ($admin) {\n        $profileData = [\n            \"id\" => $admin['id'],\n            \"name\" => $admin['name'],\n            \"email\" => $admin['email'],\n            \"image\" => $admin['image'] ?? \"../../img/default_admin.png\"\n        ];\n    }\n}\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n    <title>Admin Profile</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\" />\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css\" rel=\"stylesheet\">\n    <link rel=\"icon\" href=\"../../picture/tlgc_pic.jpg\" type=\"image/x-icon\">\n    <style>\n        :root {\n            --primary-green: #2e7d32;\n            --light-green: #e8f5e9;\n            --accent-green: #43a047;\n            --hover-green: #c8e6c9;\n            --dark-green: #1b5e20;\n        }\n        \n        body {\n            background-color: #f4f9f4;\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n        }\n        \n        .navbar {\n            background-color: var(--primary-green);\n        }\n        \n        .navbar-brand, .nav-link {\n            color: #fff !important;\n            font-weight: 600;\n            letter-spacing: 0.05em;\n        }\n        \n        .nav-link:hover {\n            color: var(--hover-green) !important;\n        }\n        \n        .school-logo {\n            width: 50px;\n            height: 50px;\n            object-fit: cover;\n            border-radius: 50%;\n            margin-right: 10px;\n            border: 2px solid #fff;\n        }\n        \n        .profile-card {\n            background: white;\n            border-radius: 15px;\n            padding: 2rem;\n            width: 100%;\n            max-width: 500px;\n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);\n        }\n        \n        .profile-img {\n            width: 150px;\n            height: 150px;\n            border-radius: 50%;\n            object-fit: cover;\n            border: 5px solid var(--accent-green);\n            margin-bottom: 1.5rem;\n            cursor: pointer;\n            transition: all 0.3s ease;\n        }\n        \n        .profile-img:hover {\n            transform: scale(1.05);\n            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);\n        }\n    </style>\n</head>\n<body>\n    <nav class=\"navbar navbar-expand-lg navbar-dark py-3\">\n        <div class=\"container-fluid\">\n            <a class=\"navbar-brand d-flex align-items-center\" href=\"../admin-dashboard.php\">\n                <img src=\"../../picture/tlgc_pic.jpg\" alt=\"School Logo\" class=\"school-logo\">\n                Admin Panel\n            </a>\n            <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\">\n                <span class=\"navbar-toggler-icon\"></span>\n            </button>\n            <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\n                <ul class=\"navbar-nav ms-auto\">\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link\" href=\"../admin-dashboard.php\">\n                            <i class=\"bi bi-arrow-left me-1\"></i> Back to Dashboard\n                        </a>\n                    </li>\n                </ul>\n            </div>\n        </div>\n    </nav>\n\n    <div class=\"d-flex justify-content-center align-items-center p-4\" style=\"min-height: calc(100vh - 80px);\">\n        <div class=\"profile-card text-center shadow-sm\">\n            <h2 class=\"text-success mb-4\"><i class=\"bi bi-person-circle me-2\"></i>Admin Profile</h2>\n            \n            <label for=\"profilePic\" tabindex=\"0\" aria-label=\"Change profile picture\">\n                <img src=\"<?= htmlspecialchars($profileData['image']) ?>\" alt=\"Profile Picture\" class=\"profile-img\" id=\"profileImage\" title=\"Click to change picture\" />\n            </label>\n\n            <?php if ($success): ?>\n                <div class=\"alert alert-success\">\n                    <i class=\"bi bi-check-circle me-2\"></i>Profile updated successfully!\n                </div>\n            <?php endif; ?>\n\n            <form method=\"post\" enctype=\"multipart/form-data\" class=\"text-start mt-3\" novalidate>\n                <div class=\"mb-3\">\n                    <label for=\"adminName\" class=\"form-label\"><i class=\"bi bi-person me-2\"></i>Full Name</label>\n                    <input type=\"text\" class=\"form-control\" id=\"adminName\" name=\"adminName\" value=\"<?= htmlspecialchars($profileData['name']) ?>\" required autocomplete=\"name\" />\n                </div>\n                <div class=\"mb-3\">\n                    <label for=\"adminEmail\" class=\"form-label\"><i class=\"bi bi-envelope me-2\"></i>Email Address</label>\n                    <input type=\"email\" class=\"form-control\" id=\"adminEmail\" name=\"adminEmail\" value=\"<?= htmlspecialchars($profileData['email']) ?>\" required autocomplete=\"email\" />\n                </div>\n                <div class=\"mb-4\">\n                    <input class=\"form-control d-none\" type=\"file\" name=\"profilePic\" id=\"profilePic\" accept=\"image/*\" />\n                </div>\n                <button type=\"submit\" class=\"btn btn-success w-100\">\n                    <i class=\"bi bi-save me-2\"></i>Save Changes\n                </button>\n            </form>\n        </div>\n    </div>\n\n    <script>\n        const profilePicInput = document.getElementById('profilePic');\n        const profileImage = document.getElementById('profileImage');\n\n        profileImage.addEventListener('click', () => profilePicInput.click());\n        profileImage.addEventListener('keypress', e => {\n            if (e.key === 'Enter' || e.key === ' ') {\n                profilePicInput.click();\n            }\n        });\n\n        profilePicInput.addEventListener('change', function(event) {\n            const file = event.target.files[0];\n            if (file) {\n                const reader = new FileReader();\n                reader.onload = function(e) {\n                    profileImage.src = e.target.result;\n                };\n                reader.readAsDataURL(file);\n            }\n        });\n    </script>\n    \n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\n</body>\n</html>\n"
        }
    ]
}