{
    "sourceFile": "ADMIN/admin-dashboard.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 24,
            "patches": [
                {
                    "date": 1748595508944,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1748597059360,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -35,15 +35,8 @@\n     }\r\n     $result->free();\r\n }\r\n \r\n-// Total Staff\r\n-if ($result = $conn->query(\"SELECT COUNT(*) AS total FROM staff\")) {\r\n-    $row = $result->fetch_assoc();\r\n-    $total_staff = $row['total'] ?? 0;\r\n-    $result->free();\r\n-}\r\n-\r\n // Enrolled this semester (status='Enrolled')\r\n if ($result = $conn->query(\"SELECT COUNT(*) AS total FROM students WHERE status = 'Enrolled'\")) {\r\n     $row = $result->fetch_assoc();\r\n     $enrolled_semester = $row['total'] ?? 0;\r\n@@ -112,32 +105,33 @@\n \r\n <div class=\"container my-5\">\r\n \r\n     <div class=\"row g-4 mb-5\">\r\n-        <div class=\"col-md-3 col-sm-6\">\r\n-            <div class=\"card text-white bg-success text-center\">\r\n-                <div class=\"card-body\">\r\n-                    <h5>Total Students</h5>\r\n-                    <p class=\"display-6\"><?= $total_students ?></p>\r\n-                </div>\r\n+    <div class=\"col-md-4 col-sm-6\">\r\n+        <div class=\"card text-white bg-success text-center\">\r\n+            <div class=\"card-body\">\r\n+                <h5>Total Students</h5>\r\n+                <p class=\"display-6\"><?= $total_students ?></p>\r\n             </div>\r\n         </div>\r\n-        <div class=\"col-md-3 col-sm-6\">\r\n-            <div class=\"card text-white bg-primary text-center\">\r\n-                <div class=\"card-body\">\r\n-                    <h5>Total Staff</h5>\r\n-                    <p class=\"display-6\"><?= $total_staff ?></p>\r\n-                </div>\r\n+    </div>\r\n+    <div class=\"col-md-4 col-sm-6\">\r\n+        <div class=\"card text-dark bg-warning text-center\">\r\n+            <div class=\"card-body\">\r\n+                <h5>Enrolled This Semester</h5>\r\n+                <p class=\"display-6\"><?= $enrolled_semester ?></p>\r\n             </div>\r\n         </div>\r\n-        <div class=\"col-md-3 col-sm-6\">\r\n-            <div class=\"card text-dark bg-warning text-center\">\r\n-                <div class=\"card-body\">\r\n-                    <h5>Enrolled This Semester</h5>\r\n-                    <p class=\"display-6\"><?= $enrolled_semester ?></p>\r\n-                </div>\r\n+    </div>\r\n+    <div class=\"col-md-4 col-sm-6\">\r\n+        <div class=\"card text-white bg-info text-center\">\r\n+            <div class=\"card-body\">\r\n+                <h5>Programs/Courses</h5>\r\n+                <p class=\"display-6\"><?= $programs_count ?></p>\r\n             </div>\r\n         </div>\r\n+    </div>\r\n+</div>\r\n         <div class=\"col-md-3 col-sm-6\">\r\n             <div class=\"card text-white bg-info text-center\">\r\n                 <div class=\"card-body\">\r\n                     <h5>Programs/Courses</h5>\r\n"
                },
                {
                    "date": 1748597068220,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -102,36 +102,36 @@\n         </div>\r\n     </div>\r\n </nav>\r\n \r\n-<div class=\"container my-5\">\r\n+        <div class=\"container my-5\">\r\n \r\n-    <div class=\"row g-4 mb-5\">\r\n-    <div class=\"col-md-4 col-sm-6\">\r\n-        <div class=\"card text-white bg-success text-center\">\r\n-            <div class=\"card-body\">\r\n-                <h5>Total Students</h5>\r\n-                <p class=\"display-6\"><?= $total_students ?></p>\r\n+        <div class=\"row g-4 mb-5\">\r\n+        <div class=\"col-md-4 col-sm-6\">\r\n+            <div class=\"card text-white bg-success text-center\">\r\n+                <div class=\"card-body\">\r\n+                    <h5>Total Students</h5>\r\n+                    <p class=\"display-6\"><?= $total_students ?></p>\r\n+                </div>\r\n             </div>\r\n         </div>\r\n-    </div>\r\n-    <div class=\"col-md-4 col-sm-6\">\r\n-        <div class=\"card text-dark bg-warning text-center\">\r\n-            <div class=\"card-body\">\r\n-                <h5>Enrolled This Semester</h5>\r\n-                <p class=\"display-6\"><?= $enrolled_semester ?></p>\r\n+        <div class=\"col-md-4 col-sm-6\">\r\n+            <div class=\"card text-dark bg-warning text-center\">\r\n+                <div class=\"card-body\">\r\n+                    <h5>Enrolled This Semester</h5>\r\n+                    <p class=\"display-6\"><?= $enrolled_semester ?></p>\r\n+                </div>\r\n             </div>\r\n         </div>\r\n-    </div>\r\n-    <div class=\"col-md-4 col-sm-6\">\r\n-        <div class=\"card text-white bg-info text-center\">\r\n-            <div class=\"card-body\">\r\n-                <h5>Programs/Courses</h5>\r\n-                <p class=\"display-6\"><?= $programs_count ?></p>\r\n+        <div class=\"col-md-4 col-sm-6\">\r\n+            <div class=\"card text-white bg-info text-center\">\r\n+                <div class=\"card-body\">\r\n+                    <h5>Programs/Courses</h5>\r\n+                    <p class=\"display-6\"><?= $programs_count ?></p>\r\n+                </div>\r\n             </div>\r\n         </div>\r\n     </div>\r\n-</div>\r\n         <div class=\"col-md-3 col-sm-6\">\r\n             <div class=\"card text-white bg-info text-center\">\r\n                 <div class=\"card-body\">\r\n                     <h5>Programs/Courses</h5>\r\n"
                },
                {
                    "date": 1748597495690,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,16 +3,16 @@\n $timeout = 900;\r\n if (isset($_SESSION['LAST_ACTIVITY']) && (time() - $_SESSION['LAST_ACTIVITY'] > $timeout)) {\r\n     session_unset();\r\n     session_destroy();\r\n-    header(\"Location: ../logregfor/login.php\");\r\n+    header(\"Location: ../logregfor/admin-login.php\");\r\n     exit;\r\n }\r\n $_SESSION['LAST_ACTIVITY'] = time();\r\n \r\n // CHECK IF LOGGED IN\r\n if (!isset($_SESSION['admin_logged_in'])) {\r\n-    header(\"Location: ../logregfor/login.php\");\r\n+    header(\"Location: ../logregfor/admin-login.php\");\r\n     exit;\r\n }\r\n \r\n include '../db.php';\r\n"
                },
                {
                    "date": 1748597745368,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,8 +14,14 @@\n     header(\"Location: ../logregfor/admin-login.php\");\r\n     exit;\r\n }\r\n \r\n+// DB connection\r\n+$host = 'localhost';\r\n+$dbname = 'enrollment_system';\r\n+$username = 'root';\r\n+$password = '';\r\n+\r\n include '../db.php';\r\n \r\n // Sanitize session username output\r\n $admin_username = htmlspecialchars($_SESSION['admin_username'] ?? 'Admin');\r\n"
                },
                {
                    "date": 1748597984525,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,9 +3,9 @@\n $timeout = 900;\r\n if (isset($_SESSION['LAST_ACTIVITY']) && (time() - $_SESSION['LAST_ACTIVITY'] > $timeout)) {\r\n     session_unset();\r\n     session_destroy();\r\n-    header(\"Location: ../logregfor/admin-login.php\");\r\n+    header(\"Location: ../admin-dashboard.php\");\r\n     exit;\r\n }\r\n $_SESSION['LAST_ACTIVITY'] = time();\r\n \r\n"
                },
                {
                    "date": 1748598027514,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,9 +3,9 @@\n $timeout = 900;\r\n if (isset($_SESSION['LAST_ACTIVITY']) && (time() - $_SESSION['LAST_ACTIVITY'] > $timeout)) {\r\n     session_unset();\r\n     session_destroy();\r\n-    header(\"Location: ../admin-dashboard.php\");\r\n+    header(\"Location: ../logregfor/admin-login.php\");\r\n     exit;\r\n }\r\n $_SESSION['LAST_ACTIVITY'] = time();\r\n \r\n"
                },
                {
                    "date": 1748598057022,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,9 +3,9 @@\n $timeout = 900;\r\n if (isset($_SESSION['LAST_ACTIVITY']) && (time() - $_SESSION['LAST_ACTIVITY'] > $timeout)) {\r\n     session_unset();\r\n     session_destroy();\r\n-    header(\"Location: ../logregfor/admin-login.php\");\r\n+    header(\"Location: ../logregfor/login.php\");\r\n     exit;\r\n }\r\n $_SESSION['LAST_ACTIVITY'] = time();\r\n \r\n@@ -14,14 +14,8 @@\n     header(\"Location: ../logregfor/admin-login.php\");\r\n     exit;\r\n }\r\n \r\n-// DB connection\r\n-$host = 'localhost';\r\n-$dbname = 'enrollment_system';\r\n-$username = 'root';\r\n-$password = '';\r\n-\r\n include '../db.php';\r\n \r\n // Sanitize session username output\r\n $admin_username = htmlspecialchars($_SESSION['admin_username'] ?? 'Admin');\r\n@@ -108,9 +102,9 @@\n         </div>\r\n     </div>\r\n </nav>\r\n \r\n-        <div class=\"container my-5\">\r\n+    <div class=\"container my-5\">\r\n \r\n         <div class=\"row g-4 mb-5\">\r\n         <div class=\"col-md-4 col-sm-6\">\r\n             <div class=\"card text-white bg-success text-center\">\r\n"
                },
                {
                    "date": 1748598246066,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,11 +9,12 @@\n }\r\n $_SESSION['LAST_ACTIVITY'] = time();\r\n \r\n // CHECK IF LOGGED IN\r\n+session_start();\r\n if (!isset($_SESSION['admin_logged_in'])) {\r\n     header(\"Location: ../logregfor/admin-login.php\");\r\n-    exit;\r\n+    exit();\r\n }\r\n \r\n include '../db.php';\r\n \r\n"
                },
                {
                    "date": 1748598450802,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,9 +11,9 @@\n \r\n // CHECK IF LOGGED IN\r\n session_start();\r\n if (!isset($_SESSION['admin_logged_in'])) {\r\n-    header(\"Location: ../logregfor/admin-login.php\");\r\n+    header(\"Location: ../logregfor/admin-dashboard.php\");\r\n     exit();\r\n }\r\n \r\n include '../db.php';\r\n"
                },
                {
                    "date": 1748598474707,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,9 +11,9 @@\n \r\n // CHECK IF LOGGED IN\r\n session_start();\r\n if (!isset($_SESSION['admin_logged_in'])) {\r\n-    header(\"Location: ../logregfor/admin-dashboard.php\");\r\n+    header(\"Location: ../logregfor/admin-login.php\");\r\n     exit();\r\n }\r\n \r\n include '../db.php';\r\n"
                },
                {
                    "date": 1748599650942,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -95,9 +95,9 @@\n                     <ul class=\"dropdown-menu dropdown-menu-end\">\r\n                         <li><a class=\"dropdown-item\" href=\"/IT2C_Enrollment_System_SourceCode/ADMIN/helpdeskAdminProfileSettings/settings.php\">Settings</a></li>\r\n                         <li><a class=\"dropdown-item\" href=\"/IT2C_Enrollment_System_SourceCode/ADMIN/helpdeskAdminProfileSettings/profile.php\">Profile</a></li>\r\n                         <li><hr class=\"dropdown-divider\"></li>\r\n-                        <li><a class=\"dropdown-item text-danger\" href=\"/IT2C_Enrollment_System_SourceCode/logregfor/logout.php\">Logout</a></li>\r\n+                        <li><a class=\"dropdown-item text-danger\" href=\"/IT2C_Enrollment_System_SourceCode/logregfor/admin-logout.php\">Logout</a></li>\r\n                     </ul>\r\n                 </li>\r\n             </ul>\r\n         </div>\r\n"
                },
                {
                    "date": 1748599854724,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,17 +1,17 @@\n <?php\r\n session_start();\r\n+\r\n $timeout = 900;\r\n if (isset($_SESSION['LAST_ACTIVITY']) && (time() - $_SESSION['LAST_ACTIVITY'] > $timeout)) {\r\n     session_unset();\r\n     session_destroy();\r\n-    header(\"Location: ../logregfor/login.php\");\r\n+    header(\"Location: ../logregfor/admin-login.php\");\r\n     exit;\r\n }\r\n $_SESSION['LAST_ACTIVITY'] = time();\r\n \r\n // CHECK IF LOGGED IN\r\n-session_start();\r\n if (!isset($_SESSION['admin_logged_in'])) {\r\n     header(\"Location: ../logregfor/admin-login.php\");\r\n     exit();\r\n }\r\n"
                },
                {
                    "date": 1748599937531,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,9 +7,11 @@\n     session_destroy();\r\n     header(\"Location: ../logregfor/admin-login.php\");\r\n     exit;\r\n }\r\n-$_SESSION['LAST_ACTIVITY'] = time();\r\n+$_SESSION['admin_logged_in'] = true;\r\n+$_SESSION['admin_username'] = $admin_username; // e.g., from database\r\n+$_SESSION['LAST_ACTIVITY'] = time()\r\n \r\n // CHECK IF LOGGED IN\r\n if (!isset($_SESSION['admin_logged_in'])) {\r\n     header(\"Location: ../logregfor/admin-login.php\");\r\n"
                },
                {
                    "date": 1748599958108,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,11 +7,9 @@\n     session_destroy();\r\n     header(\"Location: ../logregfor/admin-login.php\");\r\n     exit;\r\n }\r\n-$_SESSION['admin_logged_in'] = true;\r\n-$_SESSION['admin_username'] = $admin_username; // e.g., from database\r\n-$_SESSION['LAST_ACTIVITY'] = time()\r\n+$_SESSION['LAST_ACTIVITY'] = time();\r\n \r\n // CHECK IF LOGGED IN\r\n if (!isset($_SESSION['admin_logged_in'])) {\r\n     header(\"Location: ../logregfor/admin-login.php\");\r\n"
                },
                {
                    "date": 1748600047134,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,7 +1,13 @@\n <?php\r\n session_start();\r\n \r\n+session_start();\r\n+$_SESSION['admin_logged_in'] = true;\r\n+$_SESSION['admin_username'] = $username; // Or kung ano man yung admin username mo\r\n+header(\"Location: ../ADMIN/admin-dashboard.php\");\r\n+exit();\r\n+\r\n $timeout = 900;\r\n if (isset($_SESSION['LAST_ACTIVITY']) && (time() - $_SESSION['LAST_ACTIVITY'] > $timeout)) {\r\n     session_unset();\r\n     session_destroy();\r\n"
                },
                {
                    "date": 1748600054550,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,7 @@\n <?php\r\n session_start();\r\n \r\n-session_start();\r\n $_SESSION['admin_logged_in'] = true;\r\n $_SESSION['admin_username'] = $username; // Or kung ano man yung admin username mo\r\n header(\"Location: ../ADMIN/admin-dashboard.php\");\r\n exit();\r\n"
                },
                {
                    "date": 1748600089281,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,22 +1,18 @@\n <?php\r\n session_start();\r\n \r\n-$_SESSION['admin_logged_in'] = true;\r\n-$_SESSION['admin_username'] = $username; // Or kung ano man yung admin username mo\r\n-header(\"Location: ../ADMIN/admin-dashboard.php\");\r\n-exit();\r\n-\r\n+// Session timeout check (15 mins = 900 seconds)\r\n $timeout = 900;\r\n if (isset($_SESSION['LAST_ACTIVITY']) && (time() - $_SESSION['LAST_ACTIVITY'] > $timeout)) {\r\n     session_unset();\r\n     session_destroy();\r\n-    header(\"Location: ../logregfor/admin-login.php\");\r\n+    header(\"Location: ../logregfor/login.php\");\r\n     exit;\r\n }\r\n $_SESSION['LAST_ACTIVITY'] = time();\r\n \r\n-// CHECK IF LOGGED IN\r\n+// Check if admin is logged in\r\n if (!isset($_SESSION['admin_logged_in'])) {\r\n     header(\"Location: ../logregfor/admin-login.php\");\r\n     exit();\r\n }\r\n"
                },
                {
                    "date": 1748600101453,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,7 +1,9 @@\n <?php\r\n session_start();\r\n-\r\n+echo '<pre>';\r\n+print_r($_SESSION);\r\n+echo '</pre>';\r\n // Session timeout check (15 mins = 900 seconds)\r\n $timeout = 900;\r\n if (isset($_SESSION['LAST_ACTIVITY']) && (time() - $_SESSION['LAST_ACTIVITY'] > $timeout)) {\r\n     session_unset();\r\n"
                },
                {
                    "date": 1748600199081,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,10 +1,6 @@\n <?php\r\n session_start();\r\n-echo '<pre>';\r\n-print_r($_SESSION);\r\n-echo '</pre>';\r\n-// Session timeout check (15 mins = 900 seconds)\r\n $timeout = 900;\r\n if (isset($_SESSION['LAST_ACTIVITY']) && (time() - $_SESSION['LAST_ACTIVITY'] > $timeout)) {\r\n     session_unset();\r\n     session_destroy();\r\n@@ -12,12 +8,12 @@\n     exit;\r\n }\r\n $_SESSION['LAST_ACTIVITY'] = time();\r\n \r\n-// Check if admin is logged in\r\n+// CHECK IF LOGGED IN\r\n if (!isset($_SESSION['admin_logged_in'])) {\r\n-    header(\"Location: ../logregfor/admin-login.php\");\r\n-    exit();\r\n+    header(\"Location: ../logregfor/login.php\");\r\n+    exit;\r\n }\r\n \r\n include '../db.php';\r\n \r\n@@ -30,17 +26,25 @@\n $enrolled_semester = 0;\r\n $programs_count = 0;\r\n $course_data = [];\r\n \r\n-// Total Students (counted during course grouping)\r\n+// Total Students\r\n if ($result = $conn->query(\"SELECT course, COUNT(*) AS total FROM students GROUP BY course\")) {\r\n     while ($row = $result->fetch_assoc()) {\r\n         $course_data[] = $row;\r\n-        $total_students += $row['total']; // total students from grouped data\r\n     }\r\n     $result->free();\r\n+\r\n+    // ❌ Session timeout block is wrongfully here\r\n }\r\n \r\n+// Total Staff\r\n+if ($result = $conn->query(\"SELECT COUNT(*) AS total FROM staff\")) {\r\n+    $row = $result->fetch_assoc();\r\n+    $total_staff = $row['total'] ?? 0;\r\n+    $result->free();\r\n+}\r\n+\r\n // Enrolled this semester (status='Enrolled')\r\n if ($result = $conn->query(\"SELECT COUNT(*) AS total FROM students WHERE status = 'Enrolled'\")) {\r\n     $row = $result->fetch_assoc();\r\n     $enrolled_semester = $row['total'] ?? 0;\r\n@@ -52,8 +56,16 @@\n     $row = $result->fetch_assoc();\r\n     $programs_count = $row['total'] ?? 0;\r\n     $result->free();\r\n }\r\n+\r\n+// Chart data: number of students per course\r\n+if ($result = $conn->query(\"SELECT course, COUNT(*) AS total FROM students GROUP BY course\")) {\r\n+    while ($row = $result->fetch_assoc()) {\r\n+        $course_data[] = $row;\r\n+    }\r\n+    $result->free();\r\n+} // ← DITO LAGAY ANG KULANG MONG BRACKET\r\n ?>\r\n \r\n <!DOCTYPE html>\r\n <html lang=\"en\">\r\n@@ -98,44 +110,43 @@\n                     <ul class=\"dropdown-menu dropdown-menu-end\">\r\n                         <li><a class=\"dropdown-item\" href=\"/IT2C_Enrollment_System_SourceCode/ADMIN/helpdeskAdminProfileSettings/settings.php\">Settings</a></li>\r\n                         <li><a class=\"dropdown-item\" href=\"/IT2C_Enrollment_System_SourceCode/ADMIN/helpdeskAdminProfileSettings/profile.php\">Profile</a></li>\r\n                         <li><hr class=\"dropdown-divider\"></li>\r\n-                        <li><a class=\"dropdown-item text-danger\" href=\"/IT2C_Enrollment_System_SourceCode/logregfor/admin-logout.php\">Logout</a></li>\r\n+                        <li><a class=\"dropdown-item text-danger\" href=\"/IT2C_Enrollment_System_SourceCode/logregfor/logout.php\">Logout</a></li>\r\n                     </ul>\r\n                 </li>\r\n             </ul>\r\n         </div>\r\n     </div>\r\n </nav>\r\n \r\n-    <div class=\"container my-5\">\r\n+<div class=\"container my-5\">\r\n \r\n-        <div class=\"row g-4 mb-5\">\r\n-        <div class=\"col-md-4 col-sm-6\">\r\n+    <div class=\"row g-4 mb-5\">\r\n+        <div class=\"col-md-3 col-sm-6\">\r\n             <div class=\"card text-white bg-success text-center\">\r\n                 <div class=\"card-body\">\r\n                     <h5>Total Students</h5>\r\n                     <p class=\"display-6\"><?= $total_students ?></p>\r\n                 </div>\r\n             </div>\r\n         </div>\r\n-        <div class=\"col-md-4 col-sm-6\">\r\n-            <div class=\"card text-dark bg-warning text-center\">\r\n+        <div class=\"col-md-3 col-sm-6\">\r\n+            <div class=\"card text-white bg-primary text-center\">\r\n                 <div class=\"card-body\">\r\n-                    <h5>Enrolled This Semester</h5>\r\n-                    <p class=\"display-6\"><?= $enrolled_semester ?></p>\r\n+                    <h5>Total Staff</h5>\r\n+                    <p class=\"display-6\"><?= $total_staff ?></p>\r\n                 </div>\r\n             </div>\r\n         </div>\r\n-        <div class=\"col-md-4 col-sm-6\">\r\n-            <div class=\"card text-white bg-info text-center\">\r\n+        <div class=\"col-md-3 col-sm-6\">\r\n+            <div class=\"card text-dark bg-warning text-center\">\r\n                 <div class=\"card-body\">\r\n-                    <h5>Programs/Courses</h5>\r\n-                    <p class=\"display-6\"><?= $programs_count ?></p>\r\n+                    <h5>Enrolled This Semester</h5>\r\n+                    <p class=\"display-6\"><?= $enrolled_semester ?></p>\r\n                 </div>\r\n             </div>\r\n         </div>\r\n-    </div>\r\n         <div class=\"col-md-3 col-sm-6\">\r\n             <div class=\"card text-white bg-info text-center\">\r\n                 <div class=\"card-body\">\r\n                     <h5>Programs/Courses</h5>\r\n"
                },
                {
                    "date": 1748600211981,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -36,15 +36,8 @@\n \r\n     // ❌ Session timeout block is wrongfully here\r\n }\r\n \r\n-// Total Staff\r\n-if ($result = $conn->query(\"SELECT COUNT(*) AS total FROM staff\")) {\r\n-    $row = $result->fetch_assoc();\r\n-    $total_staff = $row['total'] ?? 0;\r\n-    $result->free();\r\n-}\r\n-\r\n // Enrolled this semester (status='Enrolled')\r\n if ($result = $conn->query(\"SELECT COUNT(*) AS total FROM students WHERE status = 'Enrolled'\")) {\r\n     $row = $result->fetch_assoc();\r\n     $enrolled_semester = $row['total'] ?? 0;\r\n"
                },
                {
                    "date": 1748600254459,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,16 +3,16 @@\n $timeout = 900;\r\n if (isset($_SESSION['LAST_ACTIVITY']) && (time() - $_SESSION['LAST_ACTIVITY'] > $timeout)) {\r\n     session_unset();\r\n     session_destroy();\r\n-    header(\"Location: ../logregfor/login.php\");\r\n+    header(\"Location: ../logregfor/admin-login.php\");\r\n     exit;\r\n }\r\n $_SESSION['LAST_ACTIVITY'] = time();\r\n \r\n // CHECK IF LOGGED IN\r\n if (!isset($_SESSION['admin_logged_in'])) {\r\n-    header(\"Location: ../logregfor/login.php\");\r\n+    header(\"Location: ../logregfor/admin-dashboard\");\r\n     exit;\r\n }\r\n \r\n include '../db.php';\r\n"
                },
                {
                    "date": 1748602097683,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,57 +10,48 @@\n $_SESSION['LAST_ACTIVITY'] = time();\r\n \r\n // CHECK IF LOGGED IN\r\n if (!isset($_SESSION['admin_logged_in'])) {\r\n-    header(\"Location: ../logregfor/admin-dashboard\");\r\n+    header(\"Location: ../logregfor/admin-login.php\");\r\n     exit;\r\n }\r\n \r\n include '../db.php';\r\n \r\n // Sanitize session username output\r\n $admin_username = htmlspecialchars($_SESSION['admin_username'] ?? 'Admin');\r\n \r\n-// Queries\r\n+// Dashboard variables\r\n $total_students = 0;\r\n-$total_staff = 0;\r\n $enrolled_semester = 0;\r\n $programs_count = 0;\r\n $course_data = [];\r\n \r\n-// Total Students\r\n+// Get total students and chart data\r\n if ($result = $conn->query(\"SELECT course, COUNT(*) AS total FROM students GROUP BY course\")) {\r\n     while ($row = $result->fetch_assoc()) {\r\n         $course_data[] = $row;\r\n+        $total_students += $row['total'];\r\n     }\r\n     $result->free();\r\n-\r\n-    // ❌ Session timeout block is wrongfully here\r\n }\r\n \r\n-// Enrolled this semester (status='Enrolled')\r\n+// Enrolled this semester\r\n if ($result = $conn->query(\"SELECT COUNT(*) AS total FROM students WHERE status = 'Enrolled'\")) {\r\n     $row = $result->fetch_assoc();\r\n     $enrolled_semester = $row['total'] ?? 0;\r\n     $result->free();\r\n }\r\n \r\n-// Programs/Courses count (distinct)\r\n+// Programs/Courses count\r\n if ($result = $conn->query(\"SELECT COUNT(DISTINCT course) AS total FROM students\")) {\r\n     $row = $result->fetch_assoc();\r\n     $programs_count = $row['total'] ?? 0;\r\n     $result->free();\r\n }\r\n-\r\n-// Chart data: number of students per course\r\n-if ($result = $conn->query(\"SELECT course, COUNT(*) AS total FROM students GROUP BY course\")) {\r\n-    while ($row = $result->fetch_assoc()) {\r\n-        $course_data[] = $row;\r\n-    }\r\n-    $result->free();\r\n-} // ← DITO LAGAY ANG KULANG MONG BRACKET\r\n ?>\r\n \r\n+\r\n <!DOCTYPE html>\r\n <html lang=\"en\">\r\n <head>\r\n     <meta charset=\"UTF-8\" />\r\n"
                },
                {
                    "date": 1748602293744,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -49,9 +49,8 @@\n     $result->free();\r\n }\r\n ?>\r\n \r\n-\r\n <!DOCTYPE html>\r\n <html lang=\"en\">\r\n <head>\r\n     <meta charset=\"UTF-8\" />\r\n"
                },
                {
                    "date": 1748602427020,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,12 +9,13 @@\n }\r\n $_SESSION['LAST_ACTIVITY'] = time();\r\n \r\n // CHECK IF LOGGED IN\r\n-if (!isset($_SESSION['admin_logged_in'])) {\r\n-    header(\"Location: ../logregfor/admin-login.php\");\r\n-    exit;\r\n+if (!isset($_SESSION['admin_logged_in']) || $_SESSION['admin_logged_in'] !== true) {\r\n+    header(\"Location: ../ADMIN/admin-login.php\");\r\n+    exit();\r\n }\r\n+?>\r\n \r\n include '../db.php';\r\n \r\n // Sanitize session username output\r\n"
                }
            ],
            "date": 1748595508944,
            "name": "Commit-0",
            "content": "<?php\r\nsession_start();\r\n$timeout = 900;\r\nif (isset($_SESSION['LAST_ACTIVITY']) && (time() - $_SESSION['LAST_ACTIVITY'] > $timeout)) {\r\n    session_unset();\r\n    session_destroy();\r\n    header(\"Location: ../logregfor/login.php\");\r\n    exit;\r\n}\r\n$_SESSION['LAST_ACTIVITY'] = time();\r\n\r\n// CHECK IF LOGGED IN\r\nif (!isset($_SESSION['admin_logged_in'])) {\r\n    header(\"Location: ../logregfor/login.php\");\r\n    exit;\r\n}\r\n\r\ninclude '../db.php';\r\n\r\n// Sanitize session username output\r\n$admin_username = htmlspecialchars($_SESSION['admin_username'] ?? 'Admin');\r\n\r\n// Queries\r\n$total_students = 0;\r\n$total_staff = 0;\r\n$enrolled_semester = 0;\r\n$programs_count = 0;\r\n$course_data = [];\r\n\r\n// Total Students (counted during course grouping)\r\nif ($result = $conn->query(\"SELECT course, COUNT(*) AS total FROM students GROUP BY course\")) {\r\n    while ($row = $result->fetch_assoc()) {\r\n        $course_data[] = $row;\r\n        $total_students += $row['total']; // total students from grouped data\r\n    }\r\n    $result->free();\r\n}\r\n\r\n// Total Staff\r\nif ($result = $conn->query(\"SELECT COUNT(*) AS total FROM staff\")) {\r\n    $row = $result->fetch_assoc();\r\n    $total_staff = $row['total'] ?? 0;\r\n    $result->free();\r\n}\r\n\r\n// Enrolled this semester (status='Enrolled')\r\nif ($result = $conn->query(\"SELECT COUNT(*) AS total FROM students WHERE status = 'Enrolled'\")) {\r\n    $row = $result->fetch_assoc();\r\n    $enrolled_semester = $row['total'] ?? 0;\r\n    $result->free();\r\n}\r\n\r\n// Programs/Courses count (distinct)\r\nif ($result = $conn->query(\"SELECT COUNT(DISTINCT course) AS total FROM students\")) {\r\n    $row = $result->fetch_assoc();\r\n    $programs_count = $row['total'] ?? 0;\r\n    $result->free();\r\n}\r\n?>\r\n\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"UTF-8\" />\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\r\n    <title>Admin Dashboard - Enrollment System</title>\r\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\" />\r\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css\" rel=\"stylesheet\" />\r\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\r\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\r\n    <link rel=\"icon\" href=\"favicon.ico\" type=\"image/x-icon\">\r\n    <style>\r\n        body { background-color: #f4f9f4; }\r\n        .navbar { box-shadow: 0 4px 6px rgba(0,0,0,0.1); }\r\n        .card { border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }\r\n        .school-logo { width: 50px; height: 50px; object-fit: cover; border-radius: 50%; margin-right: 10px; border: 2px solid #fff; }\r\n        .section-title { border-bottom: 2px solid #c8e6c9; padding-bottom: 5px; margin-bottom: 15px; color: #2e7d32; }\r\n        .list-group-item { border: none; border-left: 4px solid transparent; transition: all 0.3s; }\r\n        .list-group-item:hover { background-color: #e8f5e9; border-left: 4px solid #43a047; }\r\n        @media (max-width: 576px) { .card { margin-bottom: 1rem; } }\r\n    </style>\r\n</head>\r\n<body>\r\n\r\n<nav class=\"navbar navbar-expand-lg navbar-dark bg-success py-3\">\r\n    <div class=\"container-fluid\">\r\n        <a class=\"navbar-brand d-flex align-items-center\" href=\"#\">\r\n            <img src=\"/IT2C_Enrollment_System_SourceCode/picture/tlgc_pic.jpg\" alt=\"School Logo\" class=\"school-logo\" />\r\n            Admin Panel\r\n        </a>\r\n        <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNavDropdown\">\r\n            <span class=\"navbar-toggler-icon\"></span>\r\n        </button>\r\n        <div class=\"collapse navbar-collapse justify-content-end\" id=\"navbarNavDropdown\">\r\n            <ul class=\"navbar-nav\">\r\n                <li class=\"nav-item\"><a class=\"nav-link\" href=\"/IT2C_Enrollment_System_SourceCode/ADMIN/helpdeskAdminProfileSettings/HelpDesk.php\">Help Desk</a></li>\r\n                <li class=\"nav-item dropdown\">\r\n                    <a class=\"nav-link dropdown-toggle\" href=\"#\" role=\"button\" data-bs-toggle=\"dropdown\">\r\n                        Admin (<?= $admin_username ?>)\r\n                    </a>\r\n                    <ul class=\"dropdown-menu dropdown-menu-end\">\r\n                        <li><a class=\"dropdown-item\" href=\"/IT2C_Enrollment_System_SourceCode/ADMIN/helpdeskAdminProfileSettings/settings.php\">Settings</a></li>\r\n                        <li><a class=\"dropdown-item\" href=\"/IT2C_Enrollment_System_SourceCode/ADMIN/helpdeskAdminProfileSettings/profile.php\">Profile</a></li>\r\n                        <li><hr class=\"dropdown-divider\"></li>\r\n                        <li><a class=\"dropdown-item text-danger\" href=\"/IT2C_Enrollment_System_SourceCode/logregfor/logout.php\">Logout</a></li>\r\n                    </ul>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n    </div>\r\n</nav>\r\n\r\n<div class=\"container my-5\">\r\n\r\n    <div class=\"row g-4 mb-5\">\r\n        <div class=\"col-md-3 col-sm-6\">\r\n            <div class=\"card text-white bg-success text-center\">\r\n                <div class=\"card-body\">\r\n                    <h5>Total Students</h5>\r\n                    <p class=\"display-6\"><?= $total_students ?></p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class=\"col-md-3 col-sm-6\">\r\n            <div class=\"card text-white bg-primary text-center\">\r\n                <div class=\"card-body\">\r\n                    <h5>Total Staff</h5>\r\n                    <p class=\"display-6\"><?= $total_staff ?></p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class=\"col-md-3 col-sm-6\">\r\n            <div class=\"card text-dark bg-warning text-center\">\r\n                <div class=\"card-body\">\r\n                    <h5>Enrolled This Semester</h5>\r\n                    <p class=\"display-6\"><?= $enrolled_semester ?></p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class=\"col-md-3 col-sm-6\">\r\n            <div class=\"card text-white bg-info text-center\">\r\n                <div class=\"card-body\">\r\n                    <h5>Programs/Courses</h5>\r\n                    <p class=\"display-6\"><?= $programs_count ?></p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- Chart -->\r\n    <div class=\"row mb-5\">\r\n        <div class=\"col\">\r\n            <canvas id=\"enrollmentChart\" height=\"100\"></canvas>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- Recent Students -->\r\n    <div class=\"row mb-5\">\r\n        <div class=\"col\">\r\n            <div class=\"card\">\r\n                <div class=\"card-header bg-primary text-white d-flex justify-content-between align-items-center\">\r\n                    <h5 class=\"mb-0\">Recent Student List</h5>\r\n                    <a href=\"/IT2C_Enrollment_System_SourceCode/ADMIN/Student_Management/view-all-students.php\" class=\"btn btn-sm btn-light\">View All</a>\r\n                </div>\r\n                <div class=\"card-body p-0\">\r\n                    <div class=\"table-responsive\">\r\n                        <table class=\"table table-hover mb-0\">\r\n                            <thead>\r\n                                <tr>\r\n                                    <th>Student Number</th>\r\n                                    <th>Full Name</th>\r\n                                    <th>Year Level</th>\r\n                                    <th>Course</th>\r\n                                    <th>Status</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody>\r\n                                <?php\r\n                                $recent_students = $conn->query(\"SELECT student_number, CONCAT(first_name, ' ', last_name) AS full_name, year_level, course, status FROM students ORDER BY student_id DESC LIMIT 3\");\r\n                                if ($recent_students) {\r\n                                    while ($student = $recent_students->fetch_assoc()):\r\n                                        $status = $student['status'];\r\n                                        $badge_class = 'bg-secondary';\r\n                                        if ($status == 'Enrolled') $badge_class = 'bg-success';\r\n                                        else if ($status == 'Pending') $badge_class = 'bg-warning text-dark';\r\n                                        else if ($status == 'Dropped') $badge_class = 'bg-danger';\r\n                                ?>\r\n                                    <tr>\r\n                                        <td><?= htmlspecialchars($student['student_number']) ?></td>\r\n                                        <td><?= htmlspecialchars($student['full_name']) ?></td>\r\n                                        <td><?= htmlspecialchars($student['year_level']) ?></td>\r\n                                        <td><?= htmlspecialchars($student['course']) ?></td>\r\n                                        <td><span class=\"badge <?= $badge_class ?>\"><?= htmlspecialchars($status) ?></span></td>\r\n                                    </tr>\r\n                                <?php\r\n                                    endwhile;\r\n                                    $recent_students->free();\r\n                                } else {\r\n                                    echo '<tr><td colspan=\"5\" class=\"text-center\">No recent students found.</td></tr>';\r\n                                }\r\n                                ?>\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n</div>\r\n\r\n<script>\r\nconst ctx = document.getElementById('enrollmentChart').getContext('2d');\r\n\r\nconst courseLabels = <?= json_encode(array_column($course_data, 'course')) ?>;\r\nconst courseCounts = <?= json_encode(array_column($course_data, 'total')) ?>;\r\n\r\nnew Chart(ctx, {\r\n    type: 'bar',\r\n    data: {\r\n        labels: courseLabels,\r\n        datasets: [{\r\n            label: 'Students per Program',\r\n            data: courseCounts,\r\n            backgroundColor: 'rgba(75, 192, 192, 0.7)',\r\n            borderColor: 'rgba(75, 192, 192, 1)',\r\n            borderWidth: 1,\r\n            borderRadius: 5\r\n        }]\r\n    },\r\n    options: {\r\n        responsive: true,\r\n        scales: {\r\n            y: {\r\n                beginAtZero: true,\r\n                ticks: { stepSize: 1 }\r\n            }\r\n        },\r\n        plugins: {\r\n            legend: { display: true },\r\n            tooltip: { enabled: true }\r\n        }\r\n    }\r\n});\r\n</script>\r\n\r\n</body>\r\n</html>\r\n"
        }
    ]
}