{
    "sourceFile": "ADMIN/admin-dashboard-new.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1749401983109,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1749402016801,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -181,9 +181,8 @@\n             <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\n                 <ul class=\"navbar-nav ms-auto\">\n                     <li class=\"nav-item dropdown\">\n                         <a class=\"nav-link dropdown-toggle d-flex align-items-center\" href=\"#\" role=\"button\" data-bs-toggle=\"dropdown\">\n-                            <img src=\"<?= htmlspecialchars($admin['picture/tlgc.jpg']) ?>\" \n                                  alt=\"Admin\" class=\"rounded-circle me-2\" width=\"32\" height=\"32\">\n                             <?= htmlspecialchars($admin['name']) ?>\n                         </a>\n                         <ul class=\"dropdown-menu\">\n"
                },
                {
                    "date": 1749402023057,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -181,8 +181,9 @@\n             <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\n                 <ul class=\"navbar-nav ms-auto\">\n                     <li class=\"nav-item dropdown\">\n                         <a class=\"nav-link dropdown-toggle d-flex align-items-center\" href=\"#\" role=\"button\" data-bs-toggle=\"dropdown\">\n+                            <img src=\"<?= htmlspecialchars($admin['']) ?>\" \n                                  alt=\"Admin\" class=\"rounded-circle me-2\" width=\"32\" height=\"32\">\n                             <?= htmlspecialchars($admin['name']) ?>\n                         </a>\n                         <ul class=\"dropdown-menu\">\n"
                }
            ],
            "date": 1749401983109,
            "name": "Commit-0",
            "content": "<?php\nsession_start();\ninclude '../db.php';\n\n// Check if database connection exists\nif (!$conn) {\n    die(\"Database connection failed. Please check your database configuration.\");\n}\n\n// Check admin authentication\nif (!isset($_SESSION['admin_logged_in']) || $_SESSION['admin_logged_in'] !== true) {\n    header(\"Location: ../logregfor/admin-login.php\");\n    exit();\n}\n\n// Get admin info with error handling\n$admin = [\n    'name' => $_SESSION['admin_username'] ?? 'Admin',\n    'username' => $_SESSION['admin_username'] ?? 'admin',\n    'role' => $_SESSION['admin_role'] ?? 'admin',\n    'image' => '../img/default_admin.png'\n];\n\n// Get dashboard statistics\n$stats = [];\n\n// Enrollment statistics\n$stmt = $conn->prepare(\"SELECT status, COUNT(*) as count FROM enrollments GROUP BY status\");\n$stmt->execute();\n$result = $stmt->get_result();\n$stats['enrollments'] = [];\nwhile ($row = $result->fetch_assoc()) {\n    $stats['enrollments'][$row['status']] = $row['count'];\n}\n\n// Student statistics\n$stmt = $conn->prepare(\"SELECT COUNT(*) as total FROM students WHERE status = 'Active'\");\n$stmt->execute();\n$result = $stmt->get_result();\n$stats['total_students'] = $result->fetch_assoc()['total'] ?? 0;\n\n// Subject statistics\n$stmt = $conn->prepare(\"SELECT COUNT(*) as total FROM subjects WHERE status = 'Active'\");\n$stmt->execute();\n$result = $stmt->get_result();\n$stats['total_subjects'] = $result->fetch_assoc()['total'] ?? 0;\n\n// Recent enrollments - CORRECTED QUERY\n$recentEnrollments = [];\n$stmt = $conn->prepare(\"\n    SELECT \n        e.id,\n        e.student_id,\n        COALESCE(CONCAT(s.first_name, ' ', s.last_name), CONCAT('Student ID: ', e.student_id)) as student_name,\n        e.program,\n        e.year_level,\n        e.status,\n        e.date_submitted\n    FROM enrollments e \n    LEFT JOIN students s ON e.student_id = s.student_id\n    ORDER BY e.date_submitted DESC \n    LIMIT 5\n\");\n$stmt->execute();\n$recentEnrollments = $stmt->get_result()->fetch_all(MYSQLI_ASSOC);\n\n// Current enrollment period\n$currentPeriod = null;\n$stmt = $conn->prepare(\"SELECT * FROM enrollment_periods WHERE status = 'active' ORDER BY id DESC LIMIT 1\");\n$stmt->execute();\n$result = $stmt->get_result();\nif ($result->num_rows > 0) {\n    $currentPeriod = $result->fetch_assoc();\n}\n\n// Monthly enrollment trends\n$stmt = $conn->prepare(\"\n    SELECT \n        DATE_FORMAT(date_submitted, '%Y-%m') as month,\n        COUNT(*) as count\n    FROM enrollments \n    WHERE date_submitted >= DATE_SUB(NOW(), INTERVAL 6 MONTH)\n    GROUP BY DATE_FORMAT(date_submitted, '%Y-%m')\n    ORDER BY month\n\");\n$stmt->execute();\n$monthlyTrends = $stmt->get_result()->fetch_all(MYSQLI_ASSOC);\n\n// Program distribution\n$stmt = $conn->prepare(\"\n    SELECT program, COUNT(*) as count \n    FROM enrollments \n    WHERE status IN ('approved', 'enrolled')\n    GROUP BY program \n    ORDER BY count DESC\n\");\n$stmt->execute();\n$programDistribution = $stmt->get_result()->fetch_all(MYSQLI_ASSOC);\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <title>Admin Dashboard - TLGC Enrollment System</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css\" rel=\"stylesheet\">\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n    <style>\n        body {\n            background: linear-gradient(135deg, #f1f8e9 0%, #e8f5e9 100%);\n            font-family: 'Segoe UI', sans-serif;\n        }\n        .navbar {\n            background: linear-gradient(135deg, #2e7d32 0%, #388e3c 100%);\n            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n        }\n        .school-logo {\n            width: 50px;\n            height: 50px;\n            object-fit: cover;\n            border-radius: 50%;\n            margin-right: 10px;\n            border: 2px solid #fff;\n        }\n        .stats-card {\n            border-radius: 15px;\n            border: none;\n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);\n            transition: transform 0.3s ease;\n            background: white;\n        }\n        .stats-card:hover {\n            transform: translateY(-5px);\n        }\n        .stats-icon {\n            width: 60px;\n            height: 60px;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 1.5rem;\n            color: white;\n        }\n        .quick-action-card {\n            border-radius: 12px;\n            border: none;\n            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);\n            transition: all 0.3s ease;\n        }\n        .quick-action-card:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);\n        }\n        .period-alert {\n            background: linear-gradient(135deg, #2e7d32 0%, #388e3c 100%);\n            border: none;\n            border-radius: 10px;\n            color: white;\n        }\n        .chart-container {\n            position: relative;\n            height: 300px;\n        }\n    </style>\n</head>\n<body>\n    <!-- Navigation -->\n    <nav class=\"navbar navbar-expand-lg navbar-dark py-3\">\n        <div class=\"container-fluid\">\n            <a class=\"navbar-brand d-flex align-items-center\" href=\"#\">\n                <img src=\"../picture/tlgc_pic.jpg\" alt=\"School Logo\" class=\"school-logo\">\n                TLGC Admin Panel\n            </a>\n            <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\">\n                <span class=\"navbar-toggler-icon\"></span>\n            </button>\n            <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\n                <ul class=\"navbar-nav ms-auto\">\n                    <li class=\"nav-item dropdown\">\n                        <a class=\"nav-link dropdown-toggle d-flex align-items-center\" href=\"#\" role=\"button\" data-bs-toggle=\"dropdown\">\n                            <img src=\"<?= htmlspecialchars($admin['picture/tlgc.jpg']) ?>\" \n                                 alt=\"Admin\" class=\"rounded-circle me-2\" width=\"32\" height=\"32\">\n                            <?= htmlspecialchars($admin['name']) ?>\n                        </a>\n                        <ul class=\"dropdown-menu\">\n                            <li><a class=\"dropdown-item\" href=\"helpdeskAdminProfileSettings/profile.php\">\n                                <i class=\"bi bi-person me-2\"></i>Profile\n                            </a></li>\n                            <li><a class=\"dropdown-item\" href=\"helpdeskAdminProfileSettings/settings.php\">\n                                <i class=\"bi bi-gear me-2\"></i>Settings\n                            </a></li>\n                            <li><hr class=\"dropdown-divider\"></li>\n                            <li><a class=\"dropdown-item\" href=\"../logregfor/admin-logout.php\">\n                                <i class=\"bi bi-box-arrow-right me-2\"></i>Logout\n                            </a></li>\n                        </ul>\n                    </li>\n                </ul>\n            </div>\n        </div>\n    </nav>\n\n    <div class=\"container-fluid py-4\">\n        <!-- Welcome Section -->\n        <div class=\"row mb-4\">\n            <div class=\"col-12\">\n                <div class=\"d-flex justify-content-between align-items-center\">\n                    <div>\n                        <h2 class=\"mb-1\">Welcome back, <?= htmlspecialchars($admin['name']) ?>!</h2>\n                        <p class=\"text-muted mb-0\">Here's what's happening with your enrollment system today.</p>\n                    </div>\n                    <div class=\"text-end\">\n                        <div class=\"small text-muted\"><?= date('l, F j, Y') ?></div>\n                        <div class=\"small text-muted\"><?= date('g:i A') ?></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Current Period Alert -->\n        <?php if ($currentPeriod): ?>\n        <div class=\"row mb-4\">\n            <div class=\"col-12\">\n                <div class=\"alert period-alert\">\n                    <div class=\"d-flex align-items-center\">\n                        <i class=\"bi bi-calendar-check me-3\" style=\"font-size: 1.5rem;\"></i>\n                        <div>\n                            <h6 class=\"mb-1\">Active Enrollment Period</h6>\n                            <p class=\"mb-0\">\n                                <?= htmlspecialchars($currentPeriod['semester']) ?> - <?= htmlspecialchars($currentPeriod['school_year']) ?>\n                                (<?= date('M d', strtotime($currentPeriod['start_date'])) ?> - <?= date('M d, Y', strtotime($currentPeriod['end_date'])) ?>)\n                            </p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <?php endif; ?>\n\n        <!-- Statistics Cards -->\n        <div class=\"row mb-4\">\n            <div class=\"col-lg-3 col-md-6 mb-3\">\n                <div class=\"card stats-card h-100\">\n                    <div class=\"card-body d-flex align-items-center\">\n                        <div class=\"stats-icon bg-warning me-3\">\n                            <i class=\"bi bi-clock-history\"></i>\n                        </div>\n                        <div>\n                            <h3 class=\"mb-1\"><?= $stats['enrollments']['pending'] ?? 0 ?></h3>\n                            <p class=\"text-muted mb-0\">Pending Enrollments</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-lg-3 col-md-6 mb-3\">\n                <div class=\"card stats-card h-100\">\n                    <div class=\"card-body d-flex align-items-center\">\n                        <div class=\"stats-icon bg-success me-3\">\n                            <i class=\"bi bi-check-circle\"></i>\n                        </div>\n                        <div>\n                            <h3 class=\"mb-1\"><?= $stats['enrollments']['approved'] ?? 0 ?></h3>\n                            <p class=\"text-muted mb-0\">Approved Enrollments</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-lg-3 col-md-6 mb-3\">\n                <div class=\"card stats-card h-100\">\n                    <div class=\"card-body d-flex align-items-center\">\n                        <div class=\"stats-icon bg-primary me-3\">\n                            <i class=\"bi bi-people\"></i>\n                        </div>\n                        <div>\n                            <h3 class=\"mb-1\"><?= $stats['total_students'] ?></h3>\n                            <p class=\"text-muted mb-0\">Total Students</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-lg-3 col-md-6 mb-3\">\n                <div class=\"card stats-card h-100\">\n                    <div class=\"card-body d-flex align-items-center\">\n                        <div class=\"stats-icon bg-info me-3\">\n                            <i class=\"bi bi-book\"></i>\n                        </div>\n                        <div>\n                            <h3 class=\"mb-1\"><?= $stats['total_subjects'] ?></h3>\n                            <p class=\"text-muted mb-0\">Active Subjects</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Quick Actions -->\n        <div class=\"row mb-4\">\n            <div class=\"col-12\">\n                <h4 class=\"mb-3\">Quick Actions</h4>\n            </div>\n            <div class=\"col-lg-2 col-md-4 col-sm-6 mb-3\">\n                <a href=\"Enrollment_Management/pending-enrollments.php\" class=\"text-decoration-none\">\n                    <div class=\"card quick-action-card h-100 text-center\">\n                        <div class=\"card-body\">\n                            <i class=\"bi bi-list-check text-warning\" style=\"font-size: 2rem;\"></i>\n                            <h6 class=\"mt-2 mb-0\">Pending Enrollments</h6>\n                        </div>\n                    </div>\n                </a>\n            </div>\n            <div class=\"col-lg-2 col-md-4 col-sm-6 mb-3\">\n                <a href=\"Academic_Management/manage-subjects.php\" class=\"text-decoration-none\">\n                    <div class=\"card quick-action-card h-100 text-center\">\n                        <div class=\"card-body\">\n                            <i class=\"bi bi-book text-primary\" style=\"font-size: 2rem;\"></i>\n                            <h6 class=\"mt-2 mb-0\">Manage Subjects</h6>\n                        </div>\n                    </div>\n                </a>\n            </div>\n            <div class=\"col-lg-2 col-md-4 col-sm-6 mb-3\">\n                <a href=\"Academic_Management/assign-sections-subjects.php\" class=\"text-decoration-none\">\n                    <div class=\"card quick-action-card h-100 text-center\">\n                        <div class=\"card-body\">\n                            <i class=\"bi bi-person-plus text-success\" style=\"font-size: 2rem;\"></i>\n                            <h6 class=\"mt-2 mb-0\">Assign Students</h6>\n                        </div>\n                    </div>\n                </a>\n            </div>\n            <div class=\"col-lg-2 col-md-4 col-sm-6 mb-3\">\n                <a href=\"Student_Management/view-all-students.php\" class=\"text-decoration-none\">\n                    <div class=\"card quick-action-card h-100 text-center\">\n                        <div class=\"card-body\">\n                            <i class=\"bi bi-people text-info\" style=\"font-size: 2rem;\"></i>\n                            <h6 class=\"mt-2 mb-0\">View Students</h6>\n                        </div>\n                    </div>\n                </a>\n            </div>\n            <div class=\"col-lg-2 col-md-4 col-sm-6 mb-3\">\n                <a href=\"Settings/set-enrollment-period.php\" class=\"text-decoration-none\">\n                    <div class=\"card quick-action-card h-100 text-center\">\n                        <div class=\"card-body\">\n                            <i class=\"bi bi-calendar-event text-danger\" style=\"font-size: 2rem;\"></i>\n                            <h6 class=\"mt-2 mb-0\">Set Period</h6>\n                        </div>\n                    </div>\n                </a>\n            </div>\n            <div class=\"col-lg-2 col-md-4 col-sm-6 mb-3\">\n                <a href=\"Reports/download-student-lists.php\" class=\"text-decoration-none\">\n                    <div class=\"card quick-action-card h-100 text-center\">\n                        <div class=\"card-body\">\n                            <i class=\"bi bi-download text-secondary\" style=\"font-size: 2rem;\"></i>\n                            <h6 class=\"mt-2 mb-0\">Reports</h6>\n                        </div>\n                    </div>\n                </a>\n            </div>\n        </div>\n\n        <!-- Recent Enrollments -->\n        <div class=\"row\">\n            <div class=\"col-12\">\n                <div class=\"card\">\n                    <div class=\"card-header d-flex justify-content-between align-items-center\">\n                        <h5 class=\"mb-0\">Recent Enrollments</h5>\n                        <a href=\"Enrollment_Management/pending-enrollments.php\" class=\"btn btn-sm btn-outline-primary\">View All</a>\n                    </div>\n                    <div class=\"card-body p-0\">\n                        <?php if (empty($recentEnrollments)): ?>\n                            <div class=\"text-center py-4\">\n                                <p class=\"text-muted\">No recent enrollments found.</p>\n                            </div>\n                        <?php else: ?>\n                            <div class=\"table-responsive\">\n                                <table class=\"table table-hover mb-0\">\n                                    <thead class=\"table-light\">\n                                        <tr>\n                                            <th>Student</th>\n                                            <th>Program</th>\n                                            <th>Year Level</th>\n                                            <th>Status</th>\n                                            <th>Date Submitted</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                        <?php foreach ($recentEnrollments as $enrollment): ?>\n                                        <tr>\n                                            <td><?= htmlspecialchars($enrollment['student_name']) ?></td>\n                                            <td><span class=\"badge bg-primary\"><?= htmlspecialchars($enrollment['program']) ?></span></td>\n                                            <td><?= htmlspecialchars($enrollment['year_level']) ?></td>\n                                            <td>\n                                                <?php\n                                                $statusClass = [\n                                                    'pending' => 'warning',\n                                                    'approved' => 'success',\n                                                    'rejected' => 'danger',\n                                                    'missing_documents' => 'info'\n                                                ];\n                                                $class = $statusClass[$enrollment['status']] ?? 'secondary';\n                                                ?>\n                                                <span class=\"badge bg-<?= $class ?>\"><?= ucfirst(str_replace('_', ' ', $enrollment['status'])) ?></span>\n                                            </td>\n                                            <td><?= date('M d, Y g:i A', strtotime($enrollment['date_submitted'])) ?></td>\n                                        </tr>\n                                        <?php endforeach; ?>\n                                    </tbody>\n                                </table>\n                            </div>\n                        <?php endif; ?>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        // Simple placeholder for charts if needed\n        console.log('Dashboard loaded successfully');\n    </script>\n</body>\n</html>\n"
        }
    ]
}