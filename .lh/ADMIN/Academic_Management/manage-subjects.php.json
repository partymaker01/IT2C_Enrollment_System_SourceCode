{
    "sourceFile": "ADMIN/Academic_Management/manage-subjects.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1749402257176,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1749404418367,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -144,8 +144,9 @@\n     <title>Manage Subjects - Admin Panel</title>\n     <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n     <link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css\" rel=\"stylesheet\">\n     <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\n+    <link rel=\"icon\" href=\"../picture/tlgc_pic.jpg\" type=\"image/x-icon\">\n     <style>\n         body {\n             background: linear-gradient(135deg, #f1f8e9 0%, #e8f5e9 100%);\n             font-family: 'Segoe UI', sans-serif;\n"
                }
            ],
            "date": 1749402257176,
            "name": "Commit-0",
            "content": "<?php\nsession_start();\ninclude '../../db.php';\n\n// Check admin authentication\nif (!isset($_SESSION['admin_id'])) {\n    header(\"Location: ../../logregfor/admin-login.php\");\n    exit();\n}\n\n$message = '';\n$messageType = '';\n\n// Handle form submissions\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    $action = $_POST['action'] ?? '';\n    \n    if ($action === 'add' || $action === 'edit') {\n        $subjectCode = trim($_POST['subject_code'] ?? '');\n        $subjectTitle = trim($_POST['subject_title'] ?? '');\n        $description = trim($_POST['description'] ?? '');\n        $units = floatval($_POST['units'] ?? 0);\n        $lectureHours = floatval($_POST['lecture_hours'] ?? 0);\n        $labHours = floatval($_POST['laboratory_hours'] ?? 0);\n        $instructor = trim($_POST['instructor'] ?? '');\n        $program = trim($_POST['program'] ?? '');\n        $yearLevel = trim($_POST['year_level'] ?? '');\n        $semester = trim($_POST['semester'] ?? '');\n        $schoolYear = trim($_POST['school_year'] ?? '');\n        $courseType = trim($_POST['course_type'] ?? '');\n        $prerequisites = trim($_POST['prerequisites'] ?? '');\n        $day = trim($_POST['day'] ?? '');\n        $time = trim($_POST['time'] ?? '');\n        $room = trim($_POST['room'] ?? '');\n        \n        try {\n            if ($action === 'add') {\n                $stmt = $conn->prepare(\"INSERT INTO subjects (subject_code, subject_title, description, units, lecture_hours, laboratory_hours, instructor, program, year_level, semester, school_year, course_type, prerequisites, day, time, room, created_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, NOW())\");\n                $stmt->bind_param(\"sssdddssssssssss\", $subjectCode, $subjectTitle, $description, $units, $lectureHours, $labHours, $instructor, $program, $yearLevel, $semester, $schoolYear, $courseType, $prerequisites, $day, $time, $room);\n                \n                if ($stmt->execute()) {\n                    $message = \"Subject added successfully!\";\n                    $messageType = \"success\";\n                } else {\n                    throw new Exception(\"Failed to add subject\");\n                }\n            } else {\n                $subjectId = intval($_POST['subject_id']);\n                $stmt = $conn->prepare(\"UPDATE subjects SET subject_code=?, subject_title=?, description=?, units=?, lecture_hours=?, laboratory_hours=?, instructor=?, program=?, year_level=?, semester=?, school_year=?, course_type=?, prerequisites=?, day=?, time=?, room=? WHERE id=?\");\n                $stmt->bind_param(\"sssdddsssssssssi\", $subjectCode, $subjectTitle, $description, $units, $lectureHours, $labHours, $instructor, $program, $yearLevel, $semester, $schoolYear, $courseType, $prerequisites, $day, $time, $room, $subjectId);\n                \n                if ($stmt->execute()) {\n                    $message = \"Subject updated successfully!\";\n                    $messageType = \"success\";\n                } else {\n                    throw new Exception(\"Failed to update subject\");\n                }\n            }\n        } catch (Exception $e) {\n            $message = \"Error: \" . $e->getMessage();\n            $messageType = \"danger\";\n        }\n    } elseif ($action === 'delete') {\n        $subjectId = intval($_POST['subject_id']);\n        try {\n            $stmt = $conn->prepare(\"DELETE FROM subjects WHERE id = ?\");\n            $stmt->bind_param(\"i\", $subjectId);\n            if ($stmt->execute()) {\n                $message = \"Subject deleted successfully!\";\n                $messageType = \"success\";\n            } else {\n                throw new Exception(\"Failed to delete subject\");\n            }\n        } catch (Exception $e) {\n            $message = \"Error: \" . $e->getMessage();\n            $messageType = \"danger\";\n        }\n    }\n}\n\n// Fetch all subjects with pagination\n$page = intval($_GET['page'] ?? 1);\n$limit = 10;\n$offset = ($page - 1) * $limit;\n\n$searchTerm = $_GET['search'] ?? '';\n$filterProgram = $_GET['program'] ?? '';\n$filterYear = $_GET['year'] ?? '';\n\n$whereClause = \"WHERE 1=1\";\n$params = [];\n$types = \"\";\n\nif ($searchTerm) {\n    $whereClause .= \" AND (subject_code LIKE ? OR subject_title LIKE ? OR instructor LIKE ?)\";\n    $searchParam = \"%$searchTerm%\";\n    $params = array_merge($params, [$searchParam, $searchParam, $searchParam]);\n    $types .= \"sss\";\n}\n\nif ($filterProgram) {\n    $whereClause .= \" AND program = ?\";\n    $params[] = $filterProgram;\n    $types .= \"s\";\n}\n\nif ($filterYear) {\n    $whereClause .= \" AND year_level = ?\";\n    $params[] = $filterYear;\n    $types .= \"s\";\n}\n\n// Get total count\n$countQuery = \"SELECT COUNT(*) as total FROM subjects $whereClause\";\n$stmt = $conn->prepare($countQuery);\nif ($params) {\n    $stmt->bind_param($types, ...$params);\n}\n$stmt->execute();\n$totalSubjects = $stmt->get_result()->fetch_assoc()['total'];\n$totalPages = ceil($totalSubjects / $limit);\n\n// Get subjects\n$query = \"SELECT * FROM subjects $whereClause ORDER BY program, year_level, subject_code LIMIT ? OFFSET ?\";\n$params[] = $limit;\n$params[] = $offset;\n$types .= \"ii\";\n\n$stmt = $conn->prepare($query);\n$stmt->bind_param($types, ...$params);\n$stmt->execute();\n$subjects = $stmt->get_result()->fetch_all(MYSQLI_ASSOC);\n\n// Get programs for filter\n$programs = ['IT', 'HRMT', 'ECT', 'HST', 'ET', 'TVET'];\n$yearLevels = ['1st Year', '2nd Year', '3rd Year'];\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <title>Manage Subjects - Admin Panel</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css\" rel=\"stylesheet\">\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\n    <style>\n        body {\n            background: linear-gradient(135deg, #f1f8e9 0%, #e8f5e9 100%);\n            font-family: 'Segoe UI', sans-serif;\n        }\n        .navbar {\n            background: linear-gradient(135deg, #2e7d32 0%, #388e3c 100%);\n            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n        }\n        .main-card {\n            border-radius: 15px;\n            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);\n            border: none;\n        }\n        .school-logo {\n            width: 50px;\n            height: 50px;\n            object-fit: cover;\n            border-radius: 50%;\n            margin-right: 10px;\n            border: 2px solid #fff;\n        }\n        .btn-action {\n            padding: 5px 10px;\n            margin: 2px;\n            border-radius: 5px;\n        }\n        .subject-card {\n            transition: transform 0.2s ease;\n            border-radius: 10px;\n        }\n        .subject-card:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);\n        }\n    </style>\n</head>\n<body>\n    <nav class=\"navbar navbar-expand-lg navbar-dark py-3\">\n        <div class=\"container-fluid\">\n            <a class=\"navbar-brand d-flex align-items-center\" href=\"#\">\n                <img src=\"../../picture/tlgc_pic.jpg\" alt=\"School Logo\" class=\"school-logo\">\n                Admin Panel\n            </a>\n            <div class=\"navbar-nav ms-auto\">\n                <a class=\"nav-link\" href=\"../admin-dashboard.php\">\n                    <i class=\"bi bi-arrow-left\"></i> Back to Dashboard\n                </a>\n            </div>\n        </div>\n    </nav>\n\n    <div class=\"container py-4\">\n        <div class=\"d-flex justify-content-between align-items-center mb-4\">\n            <h2><i class=\"bi bi-book me-2\"></i>Manage Subjects</h2>\n            <button class=\"btn btn-success\" data-bs-toggle=\"modal\" data-bs-target=\"#subjectModal\" onclick=\"openAddModal()\">\n                <i class=\"bi bi-plus-circle me-1\"></i>Add New Subject\n            </button>\n        </div>\n\n        <?php if ($message): ?>\n            <div class=\"alert alert-<?= $messageType ?> alert-dismissible fade show\">\n                <?= $message ?>\n                <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>\n            </div>\n        <?php endif; ?>\n\n        <!-- Filters -->\n        <div class=\"card main-card mb-4\">\n            <div class=\"card-body\">\n                <form method=\"GET\" class=\"row g-3\">\n                    <div class=\"col-md-4\">\n                        <input type=\"text\" class=\"form-control\" name=\"search\" placeholder=\"Search subjects...\" value=\"<?= htmlspecialchars($searchTerm) ?>\">\n                    </div>\n                    <div class=\"col-md-3\">\n                        <select class=\"form-select\" name=\"program\">\n                            <option value=\"\">All Programs</option>\n                            <?php foreach ($programs as $prog): ?>\n                                <option value=\"<?= $prog ?>\" <?= $filterProgram === $prog ? 'selected' : '' ?>><?= $prog ?></option>\n                            <?php endforeach; ?>\n                        </select>\n                    </div>\n                    <div class=\"col-md-3\">\n                        <select class=\"form-select\" name=\"year\">\n                            <option value=\"\">All Year Levels</option>\n                            <?php foreach ($yearLevels as $year): ?>\n                                <option value=\"<?= $year ?>\" <?= $filterYear === $year ? 'selected' : '' ?>><?= $year ?></option>\n                            <?php endforeach; ?>\n                        </select>\n                    </div>\n                    <div class=\"col-md-2\">\n                        <button type=\"submit\" class=\"btn btn-primary w-100\">\n                            <i class=\"bi bi-search\"></i> Filter\n                        </button>\n                    </div>\n                </form>\n            </div>\n        </div>\n\n        <!-- Subjects List -->\n        <div class=\"card main-card\">\n            <div class=\"card-header bg-success text-white\">\n                <h5 class=\"mb-0\">Subjects List (<?= $totalSubjects ?> total)</h5>\n            </div>\n            <div class=\"card-body p-0\">\n                <?php if (empty($subjects)): ?>\n                    <div class=\"text-center py-5\">\n                        <i class=\"bi bi-inbox text-muted\" style=\"font-size: 3rem;\"></i>\n                        <p class=\"text-muted mt-2\">No subjects found.</p>\n                    </div>\n                <?php else: ?>\n                    <div class=\"table-responsive\">\n                        <table class=\"table table-hover mb-0\">\n                            <thead class=\"table-light\">\n                                <tr>\n                                    <th>Subject Code</th>\n                                    <th>Subject Title</th>\n                                    <th>Program</th>\n                                    <th>Year Level</th>\n                                    <th>Units</th>\n                                    <th>Instructor</th>\n                                    <th>Schedule</th>\n                                    <th>Actions</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                <?php foreach ($subjects as $subject): ?>\n                                <tr>\n                                    <td><strong><?= htmlspecialchars($subject['subject_code']) ?></strong></td>\n                                    <td><?= htmlspecialchars($subject['subject_title']) ?></td>\n                                    <td><span class=\"badge bg-primary\"><?= htmlspecialchars($subject['program']) ?></span></td>\n                                    <td><?= htmlspecialchars($subject['year_level']) ?></td>\n                                    <td><?= $subject['units'] ?></td>\n                                    <td><?= htmlspecialchars($subject['instructor']) ?></td>\n                                    <td>\n                                        <small>\n                                            <?= htmlspecialchars($subject['day']) ?><br>\n                                            <?= htmlspecialchars($subject['time']) ?><br>\n                                            <?= htmlspecialchars($subject['room']) ?>\n                                        </small>\n                                    </td>\n                                    <td>\n                                        <button class=\"btn btn-sm btn-outline-primary btn-action\" onclick=\"editSubject(<?= htmlspecialchars(json_encode($subject)) ?>)\">\n                                            <i class=\"bi bi-pencil\"></i>\n                                        </button>\n                                        <button class=\"btn btn-sm btn-outline-danger btn-action\" onclick=\"deleteSubject(<?= $subject['id'] ?>, '<?= htmlspecialchars($subject['subject_code']) ?>')\">\n                                            <i class=\"bi bi-trash\"></i>\n                                        </button>\n                                    </td>\n                                </tr>\n                                <?php endforeach; ?>\n                            </tbody>\n                        </table>\n                    </div>\n\n                    <!-- Pagination -->\n                    <?php if ($totalPages > 1): ?>\n                    <div class=\"card-footer\">\n                        <nav>\n                            <ul class=\"pagination justify-content-center mb-0\">\n                                <?php for ($i = 1; $i <= $totalPages; $i++): ?>\n                                    <li class=\"page-item <?= $i === $page ? 'active' : '' ?>\">\n                                        <a class=\"page-link\" href=\"?page=<?= $i ?>&search=<?= urlencode($searchTerm) ?>&program=<?= urlencode($filterProgram) ?>&year=<?= urlencode($filterYear) ?>\"><?= $i ?></a>\n                                    </li>\n                                <?php endfor; ?>\n                            </ul>\n                        </nav>\n                    </div>\n                    <?php endif; ?>\n                <?php endif; ?>\n            </div>\n        </div>\n    </div>\n\n    <!-- Subject Modal -->\n    <div class=\"modal fade\" id=\"subjectModal\" tabindex=\"-1\">\n        <div class=\"modal-dialog modal-lg\">\n            <div class=\"modal-content\">\n                <form method=\"POST\" id=\"subjectForm\">\n                    <div class=\"modal-header bg-success text-white\">\n                        <h5 class=\"modal-title\" id=\"modalTitle\">Add New Subject</h5>\n                        <button type=\"button\" class=\"btn-close btn-close-white\" data-bs-dismiss=\"modal\"></button>\n                    </div>\n                    <div class=\"modal-body\">\n                        <input type=\"hidden\" name=\"action\" id=\"formAction\" value=\"add\">\n                        <input type=\"hidden\" name=\"subject_id\" id=\"subjectId\">\n                        \n                        <div class=\"row g-3\">\n                            <div class=\"col-md-6\">\n                                <label class=\"form-label\">Subject Code *</label>\n                                <input type=\"text\" class=\"form-control\" name=\"subject_code\" id=\"subjectCode\" required>\n                            </div>\n                            <div class=\"col-md-6\">\n                                <label class=\"form-label\">Units *</label>\n                                <input type=\"number\" class=\"form-control\" name=\"units\" id=\"units\" step=\"0.5\" min=\"0\" max=\"10\" required>\n                            </div>\n                            <div class=\"col-12\">\n                                <label class=\"form-label\">Subject Title *</label>\n                                <input type=\"text\" class=\"form-control\" name=\"subject_title\" id=\"subjectTitle\" required>\n                            </div>\n                            <div class=\"col-12\">\n                                <label class=\"form-label\">Description</label>\n                                <textarea class=\"form-control\" name=\"description\" id=\"description\" rows=\"3\"></textarea>\n                            </div>\n                            <div class=\"col-md-4\">\n                                <label class=\"form-label\">Lecture Hours</label>\n                                <input type=\"number\" class=\"form-control\" name=\"lecture_hours\" id=\"lectureHours\" step=\"0.5\" min=\"0\">\n                            </div>\n                            <div class=\"col-md-4\">\n                                <label class=\"form-label\">Laboratory Hours</label>\n                                <input type=\"number\" class=\"form-control\" name=\"laboratory_hours\" id=\"labHours\" step=\"0.5\" min=\"0\">\n                            </div>\n                            <div class=\"col-md-4\">\n                                <label class=\"form-label\">Course Type</label>\n                                <select class=\"form-select\" name=\"course_type\" id=\"courseType\">\n                                    <option value=\"major\">Major</option>\n                                    <option value=\"minor\">Minor</option>\n                                    <option value=\"general_education\">General Education</option>\n                                    <option value=\"elective\">Elective</option>\n                                </select>\n                            </div>\n                            <div class=\"col-md-6\">\n                                <label class=\"form-label\">Program *</label>\n                                <select class=\"form-select\" name=\"program\" id=\"program\" required>\n                                    <option value=\"\">Select Program</option>\n                                    <?php foreach ($programs as $prog): ?>\n                                        <option value=\"<?= $prog ?>\"><?= $prog ?></option>\n                                    <?php endforeach; ?>\n                                </select>\n                            </div>\n                            <div class=\"col-md-6\">\n                                <label class=\"form-label\">Year Level *</label>\n                                <select class=\"form-select\" name=\"year_level\" id=\"yearLevel\" required>\n                                    <option value=\"\">Select Year Level</option>\n                                    <?php foreach ($yearLevels as $year): ?>\n                                        <option value=\"<?= $year ?>\"><?= $year ?></option>\n                                    <?php endforeach; ?>\n                                </select>\n                            </div>\n                            <div class=\"col-md-6\">\n                                <label class=\"form-label\">Semester</label>\n                                <select class=\"form-select\" name=\"semester\" id=\"semester\">\n                                    <option value=\"\">Select Semester</option>\n                                    <option value=\"1st Semester\">1st Semester</option>\n                                    <option value=\"2nd Semester\">2nd Semester</option>\n                                    <option value=\"Summer\">Summer</option>\n                                </select>\n                            </div>\n                            <div class=\"col-md-6\">\n                                <label class=\"form-label\">School Year</label>\n                                <input type=\"text\" class=\"form-control\" name=\"school_year\" id=\"schoolYear\" placeholder=\"2024-2025\">\n                            </div>\n                            <div class=\"col-md-12\">\n                                <label class=\"form-label\">Instructor</label>\n                                <input type=\"text\" class=\"form-control\" name=\"instructor\" id=\"instructor\">\n                            </div>\n                            <div class=\"col-md-4\">\n                                <label class=\"form-label\">Day</label>\n                                <input type=\"text\" class=\"form-control\" name=\"day\" id=\"day\" placeholder=\"Mon,Wed,Fri\">\n                            </div>\n                            <div class=\"col-md-4\">\n                                <label class=\"form-label\">Time</label>\n                                <input type=\"text\" class=\"form-control\" name=\"time\" id=\"time\" placeholder=\"8:00-9:30 AM\">\n                            </div>\n                            <div class=\"col-md-4\">\n                                <label class=\"form-label\">Room</label>\n                                <input type=\"text\" class=\"form-control\" name=\"room\" id=\"room\" placeholder=\"Room 101\">\n                            </div>\n                            <div class=\"col-12\">\n                                <label class=\"form-label\">Prerequisites</label>\n                                <textarea class=\"form-control\" name=\"prerequisites\" id=\"prerequisites\" rows=\"2\" placeholder=\"List prerequisite subjects\"></textarea>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"modal-footer\">\n                        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Cancel</button>\n                        <button type=\"submit\" class=\"btn btn-success\" id=\"submitBtn\">Save Subject</button>\n                    </div>\n                </form>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        function openAddModal() {\n            document.getElementById('modalTitle').textContent = 'Add New Subject';\n            document.getElementById('formAction').value = 'add';\n            document.getElementById('submitBtn').textContent = 'Add Subject';\n            document.getElementById('subjectForm').reset();\n        }\n\n        function editSubject(subject) {\n            document.getElementById('modalTitle').textContent = 'Edit Subject';\n            document.getElementById('formAction').value = 'edit';\n            document.getElementById('submitBtn').textContent = 'Update Subject';\n            \n            // Populate form fields\n            document.getElementById('subjectId').value = subject.id;\n            document.getElementById('subjectCode').value = subject.subject_code;\n            document.getElementById('subjectTitle').value = subject.subject_title;\n            document.getElementById('description').value = subject.description || '';\n            document.getElementById('units').value = subject.units;\n            document.getElementById('lectureHours').value = subject.lecture_hours || '';\n            document.getElementById('labHours').value = subject.laboratory_hours || '';\n            document.getElementById('courseType').value = subject.course_type || 'major';\n            document.getElementById('program').value = subject.program;\n            document.getElementById('yearLevel').value = subject.year_level;\n            document.getElementById('semester').value = subject.semester || '';\n            document.getElementById('schoolYear').value = subject.school_year || '';\n            document.getElementById('instructor').value = subject.instructor || '';\n            document.getElementById('day').value = subject.day || '';\n            document.getElementById('time').value = subject.time || '';\n            document.getElementById('room').value = subject.room || '';\n            document.getElementById('prerequisites').value = subject.prerequisites || '';\n            \n            new bootstrap.Modal(document.getElementById('subjectModal')).show();\n        }\n\n        function deleteSubject(id, code) {\n            if (confirm(`Are you sure you want to delete subject \"${code}\"?`)) {\n                const form = document.createElement('form');\n                form.method = 'POST';\n                form.innerHTML = `\n                    <input type=\"hidden\" name=\"action\" value=\"delete\">\n                    <input type=\"hidden\" name=\"subject_id\" value=\"${id}\">\n                `;\n                document.body.appendChild(form);\n                form.submit();\n            }\n        }\n    </script>\n</body>\n</html>\n"
        }
    ]
}