{
    "sourceFile": "logregfor/admin-login.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1749394398656,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1749394446403,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -212,11 +212,8 @@\n                 <i class=\"bi bi-box-arrow-in-right me-2\"></i> Sign In\n             </button>\n         </form>\n \n-        <a href=\"../index.php\" class=\"back-link\">\n-            <i class=\"bi bi-arrow-left\"></i> Back to Main Page\n-        </a>\n     </div>\n \n     <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\n </body>\n"
                },
                {
                    "date": 1749394463788,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -211,9 +211,8 @@\n             <button type=\"submit\" class=\"btn-login\">\n                 <i class=\"bi bi-box-arrow-in-right me-2\"></i> Sign In\n             </button>\n         </form>\n-\n     </div>\n \n     <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\n </body>\n"
                }
            ],
            "date": 1749394398656,
            "name": "Commit-0",
            "content": "<?php\nsession_start();\n\n// Redirect if already logged in\nif (isset($_SESSION['admin_logged_in']) && $_SESSION['admin_logged_in'] === true) {\n    header(\"Location: ../ADMIN/admin-dashboard.php\");\n    exit;\n}\n\nrequire_once '../db.php';\n\n$error = '';\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    $email = trim($_POST['email'] ?? '');\n    $password = $_POST['password'] ?? '';\n\n    if (empty($email) || empty($password)) {\n        $error = \"Please enter both email and password.\";\n    } else {\n        try {\n            // Check in admin_settings table first\n            $stmt = $pdo->prepare(\"SELECT id, username, email, password, name, role FROM admin_settings WHERE email = ? OR username = ?\");\n            $stmt->execute([$email, $email]);\n            $admin = $stmt->fetch();\n\n            if ($admin && password_verify($password, $admin['password'])) {\n                // Set session variables\n                $_SESSION['admin_logged_in'] = true;\n                $_SESSION['admin_id'] = $admin['id'];\n                $_SESSION['admin_email'] = $admin['email'];\n                $_SESSION['admin_username'] = $admin['username'];\n                $_SESSION['admin_name'] = $admin['name'];\n                $_SESSION['admin_role'] = $admin['role'];\n                $_SESSION['last_activity'] = time();\n                \n                header(\"Location: ../ADMIN/admin-dashboard.php\");\n                exit;\n            } else {\n                $error = \"Invalid email/username or password.\";\n            }\n        } catch (PDOException $e) {\n            $error = \"Login failed. Please try again.\";\n            error_log(\"Admin login error: \" . $e->getMessage());\n        }\n    }\n}\n?>\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Admin Login - Enrollment System</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css\">\n    <link rel=\"icon\" href=\"../picture/tlgc_pic.jpg\" type=\"image/x-icon\">\n    <style>\n        :root {\n            --primary-green: rgb(60, 109, 61);\n            --light-green: #e8f5e9;\n            --accent-green: #43a047;\n            --hover-green: #c8e6c9;\n            --dark-green: #1b5e20;\n        }\n\n        body {\n            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);\n            min-height: 100vh;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n        }\n\n        .login-container {\n            background: rgba(255, 255, 255, 0.95);\n            border-radius: 20px;\n            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);\n            width: 100%;\n            max-width: 450px;\n            padding: 2.5rem;\n        }\n\n        .school-header {\n            text-align: center;\n            margin-bottom: 2rem;\n        }\n\n        .school-logo {\n            width: 80px;\n            height: 80px;\n            object-fit: cover;\n            border-radius: 50%;\n            border: 4px solid var(--accent-green);\n            margin-bottom: 1rem;\n        }\n\n        .school-name {\n            color: var(--primary-green);\n            font-weight: 700;\n            font-size: 1.5rem;\n            margin-bottom: 0.5rem;\n        }\n\n        .school-subtitle {\n            color: #666;\n            font-size: 0.9rem;\n        }\n\n        .form-title {\n            color: var(--primary-green);\n            font-weight: 700;\n            font-size: 1.8rem;\n            margin-bottom: 1.5rem;\n            text-align: center;\n        }\n\n        .form-control {\n            border: 2px solid #e0e0e0;\n            border-radius: 10px;\n            padding: 12px 15px;\n            transition: all 0.3s ease;\n            background-color: #fafafa;\n        }\n\n        .form-control:focus {\n            border-color: var(--accent-green);\n            box-shadow: 0 0 0 0.25rem rgba(67, 160, 71, 0.25);\n            background-color: #fff;\n        }\n\n        .btn-login {\n            background: linear-gradient(135deg, var(--accent-green) 0%, var(--primary-green) 100%);\n            border: none;\n            color: white;\n            font-weight: 600;\n            padding: 12px 30px;\n            border-radius: 10px;\n            transition: all 0.3s ease;\n            width: 100%;\n        }\n\n        .btn-login:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 8px 20px rgba(67, 160, 71, 0.4);\n            color: white;\n        }\n\n        .input-group {\n            position: relative;\n            margin-bottom: 1.5rem;\n        }\n\n        .input-group i {\n            position: absolute;\n            left: 15px;\n            top: 50%;\n            transform: translateY(-50%);\n            color: #666;\n            z-index: 10;\n        }\n\n        .input-group .form-control {\n            padding-left: 45px;\n        }\n\n        .back-link {\n            display: block;\n            text-align: center;\n            margin-top: 1.5rem;\n            color: var(--accent-green);\n            text-decoration: none;\n            font-size: 0.9rem;\n        }\n\n        .back-link:hover {\n            text-decoration: underline;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"login-container\">\n        <div class=\"school-header\">\n            <img src=\"../picture/tlgc_pic.jpg\" alt=\"School Logo\" class=\"school-logo\">\n            <div class=\"school-name\">Top Link Global College</div>\n            <div class=\"school-subtitle\">Admin Portal</div>\n        </div>\n\n        <?php if ($error): ?>\n            <div class=\"alert alert-danger alert-dismissible fade show\" role=\"alert\">\n                <i class=\"bi bi-exclamation-triangle-fill me-2\"></i>\n                <?= htmlspecialchars($error) ?>\n                <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>\n            </div>\n        <?php endif; ?>\n\n        <h3 class=\"form-title\">Admin Login</h3>\n        <form method=\"POST\" action=\"\">\n            <div class=\"input-group\">\n                <i class=\"bi bi-envelope\"></i>\n                <input type=\"text\" class=\"form-control\" name=\"email\" placeholder=\"Email or Username\" required>\n            </div>\n\n            <div class=\"input-group\">\n                <i class=\"bi bi-lock\"></i>\n                <input type=\"password\" class=\"form-control\" name=\"password\" placeholder=\"Password\" required>\n            </div>\n\n            <button type=\"submit\" class=\"btn-login\">\n                <i class=\"bi bi-box-arrow-in-right me-2\"></i> Sign In\n            </button>\n        </form>\n\n        <a href=\"../index.php\" class=\"back-link\">\n            <i class=\"bi bi-arrow-left\"></i> Back to Main Page\n        </a>\n    </div>\n\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\n</body>\n</html>\n"
        }
    ]
}