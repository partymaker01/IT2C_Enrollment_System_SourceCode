{
    "sourceFile": "database/enrollment_system.sql",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1749414602210,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1749414602210,
            "name": "Commit-0",
            "content": "-- Students Table\r\nCREATE TABLE students (\r\n    id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,\r\n    student_id VARCHAR(20) NOT NULL UNIQUE,\r\n    username VARCHAR(50) UNIQUE NOT NULL,\r\n    first_name VARCHAR(50) NOT NULL,\r\n    middle_name VARCHAR(50),\r\n    last_name VARCHAR(50) NOT NULL,\r\n    email VARCHAR(100) UNIQUE NOT NULL,\r\n    contact_number VARCHAR(30),\r\n    password VARCHAR(255) NOT NULL,\r\n    dob DATE,\r\n    gender ENUM('Male', 'Female', 'Other') NOT NULL,\r\n    address VARCHAR(255),\r\n    program VARCHAR(100),\r\n    course VARCHAR(100),\r\n    school_year VARCHAR(20),\r\n    year_level VARCHAR(20),\r\n    section VARCHAR(10),\r\n    full_name VARCHAR(255),\r\n    photo VARCHAR(255) DEFAULT 'uploads/ran.jpg',\r\n    status VARCHAR(20) DEFAULT 'Pending',\r\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n);\r\n\r\n-- Registrar Staff Table\r\nCREATE TABLE registrar_staff (\r\n    id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,\r\n    staff_number VARCHAR(50) UNIQUE NOT NULL,\r\n    username VARCHAR(50) UNIQUE NOT NULL,\r\n    first_name VARCHAR(50) NOT NULL,\r\n    last_name VARCHAR(50) NOT NULL,\r\n    email VARCHAR(100) UNIQUE NOT NULL,\r\n    password VARCHAR(255) NOT NULL,\r\n    position VARCHAR(50),\r\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n);\r\n\r\n-- Admin Settings Table\r\nCREATE TABLE admin_settings (\r\n    id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,\r\n    name VARCHAR(255) NOT NULL,\r\n    username VARCHAR(50) UNIQUE NOT NULL,\r\n    email VARCHAR(100) UNIQUE NOT NULL,\r\n    password VARCHAR(255) NOT NULL,\r\n    email_notify TINYINT(1) DEFAULT 0,\r\n    image VARCHAR(255) DEFAULT 'img/default_admin.png',\r\n    sms_notify TINYINT(1) DEFAULT 0,\r\n    maintenance_mode TINYINT(1) DEFAULT 0,\r\n    auto_backup TINYINT(1) DEFAULT 0,\r\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n);\r\n\r\n-- Sample Admin Insert\r\nINSERT INTO admin_settings (email, password, username)\r\nVALUES (\r\n    'admin@example.com',\r\n    '$2y$10$ZTg9kZyD945c94f7m3vEquCDZ5wZGuwLBv4mitSX2dS...', -- use your generated hash\r\n    'admin'\r\n);\r\n\r\n-- Enrollments Table\r\n-- Fixed Enrollments Table\r\nCREATE TABLE enrollments (\r\n    id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,\r\n    student_id VARCHAR(20) NOT NULL,\r\n    status ENUM('pending', 'approved', 'rejected', 'not_enrolled') DEFAULT 'pending',\r\n    semester VARCHAR(20) NOT NULL,\r\n    school_year VARCHAR(20) NOT NULL,\r\n    program VARCHAR(100) NOT NULL,\r\n    year_level VARCHAR(50),\r\n    rejection_reason VARCHAR(255),\r\n    section VARCHAR(20),\r\n    remarks VARCHAR(255),\r\n    notification TEXT,\r\n    date_submitted DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n    FOREIGN KEY (student_id) REFERENCES students(student_id) ON DELETE CASCADE,\r\n    UNIQUE KEY uniq_enrollment (student_id, semester, school_year), -- âœ… allows multiple terms\r\n    INDEX idx_student_id (student_id)\r\n);\r\n\r\n-- Subjects Table\r\nCREATE TABLE subjects (\r\n    id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,\r\n    student_id VARCHAR(20) NOT NULL UNIQUE,\r\n    subject_code VARCHAR(20) NOT NULL UNIQUE,\r\n    subject_title VARCHAR(100) NOT NULL,\r\n    description VARCHAR(100),\r\n    units DECIMAL(3,1),\r\n    instructor VARCHAR(100),\r\n    day VARCHAR(50),\r\n    time VARCHAR(50),\r\n    room VARCHAR(50)\r\n);\r\n\r\n-- Enrollment Subjects Table (junction for enrollments and subjects)\r\nCREATE TABLE enrollment_subjects (\r\n    id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,\r\n\r\n    enrollment_id INT UNSIGNED NOT NULL,\r\n    subject_code VARCHAR(20) NOT NULL,\r\n    subject_description VARCHAR(255),\r\n    instructor VARCHAR(255),\r\n    grade DECIMAL(4,2),\r\n    remarks VARCHAR(50),\r\n    FOREIGN KEY (enrollment_id) REFERENCES enrollments(id) ON DELETE CASCADE,\r\n    FOREIGN KEY (subject_code) REFERENCES subjects(subject_code) ON DELETE CASCADE,\r\n    INDEX idx_enrollment_id (enrollment_id)\r\n);\r\n\r\n-- Student Subjects Table (for direct assignment)\r\nCREATE TABLE student_subjects (\r\n    id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,\r\n    student_id VARCHAR(20) NOT NULL UNIQUE,\r\n    subject_id INT UNSIGNED NOT NULL,\r\n    status VARCHAR(20) DEFAULT 'Confirmed',\r\n    FOREIGN KEY (student_id) REFERENCES students(student_id) ON DELETE CASCADE,\r\n    FOREIGN KEY (subject_id) REFERENCES subjects(id) ON DELETE CASCADE,\r\n    INDEX idx_student_id (student_id)\r\n);\r\n\r\n-- Enrollment Periods Table\r\nCREATE TABLE enrollment_periods (\r\n    id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,\r\n    student_id VARCHAR(20) NOT NULL UNIQUE,\r\n    start_date DATE NOT NULL,\r\n    end_date DATE NOT NULL,\r\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n);\r\n\r\n-- Tickets Table\r\nCREATE TABLE tickets (\r\n    ticket_id VARCHAR(20) PRIMARY KEY,\r\n    student_id VARCHAR(20) NOT NULL UNIQUE,\r\n    student_name VARCHAR(100) NOT NULL,\r\n    category VARCHAR(100) NOT NULL,\r\n    priority ENUM('Low', 'Medium', 'High') NOT NULL DEFAULT 'Low',\r\n    status ENUM('Open', 'In Progress', 'Resolved', 'Closed') NOT NULL DEFAULT 'Open',\r\n    date_submitted DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\r\n    message TEXT NOT NULL\r\n);\r\n\r\n-- Conversations Table\r\nCREATE TABLE conversations (\r\n    id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,\r\n    ticket_id VARCHAR(20) NOT NULL,\r\n    sender VARCHAR(100) NOT NULL,\r\n    message TEXT NOT NULL,\r\n    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,\r\n    FOREIGN KEY (ticket_id) REFERENCES tickets(ticket_id) ON DELETE CASCADE,\r\n    INDEX idx_ticket_id (ticket_id)\r\n);\r\n\r\n-- Password Resets Table\r\nCREATE TABLE password_resets (\r\n    id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,\r\n    student_id VARCHAR(20) NOT NULL,\r\n    token VARCHAR(255) NOT NULL UNIQUE,\r\n    expires_at DATETIME NOT NULL,\r\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\r\n    FOREIGN KEY (student_id) REFERENCES students(student_id) ON DELETE CASCADE,\r\n    INDEX idx_student_id (student_id)\r\n);\r\n\r\n-- Uploaded Documents Table\r\nCREATE TABLE uploaded_documents (\r\n    id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,\r\n    student_id VARCHAR(20) NOT NULL UNIQUE,\r\n    document_name VARCHAR(100) NOT NULL,\r\n    file_path VARCHAR(255) NOT NULL,\r\n    upload_date DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n    status ENUM('Uploaded', 'Verified', 'Rejected', 'Pending') DEFAULT 'Uploaded',\r\n    remarks VARCHAR(255) DEFAULT 'Waiting for verification',\r\n    can_reupload TINYINT(1) DEFAULT 0,\r\n    view_link VARCHAR(255),\r\n    FOREIGN KEY (student_id) REFERENCES students(student_id) ON DELETE CASCADE,\r\n    INDEX idx_student_id (student_id)\r\n);\r\n\r\n\r\n"
        }
    ]
}